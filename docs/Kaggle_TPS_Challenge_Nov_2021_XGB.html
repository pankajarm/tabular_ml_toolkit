---

title: Kaggle TPS Challenge (Nov 2021)


keywords: fastai
sidebar: home_sidebar

summary: "A Tutorial to showcase usage of Tabular_ML_Toolkit library on Kaggle TPS Challenge Nov 2021"
description: "A Tutorial to showcase usage of Tabular_ML_Toolkit library on Kaggle TPS Challenge Nov 2021"
nb_path: "04_Kaggle_TPS_Challenge_Nov_2021_XGB.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 04_Kaggle_TPS_Challenge_Nov_2021_XGB.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">tabular_ml_toolkit.MLPipeline</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_auc_score</span><span class="p">,</span><span class="n">accuracy_score</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Build-MLPipeline-Class-with-Kaggle-TPS-Challenge-data">Build MLPipeline Class with Kaggle TPS Challenge data<a class="anchor-link" href="#Build-MLPipeline-Class-with-Kaggle-TPS-Challenge-data"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>*You can use MLPipeline to quickly train any model which supports scikit-lear fit and transform methods.</p>
<p>For example, Here we are using LogisticRegression from Scikit-Learn, on  <a href="https://www.kaggle.com/c/tabular-playground-series-nov-2021/data">Kaggle TPS Challenge (Nov 2021) data</a>*</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DIRECTORY_PATH</span> <span class="o">=</span> <span class="s2">&quot;/Users/pankajmathur/kaggle_datasets/tps_nov_2021/&quot;</span>
<span class="n">TRAIN_FILE</span> <span class="o">=</span> <span class="s2">&quot;train.csv&quot;</span>
<span class="n">TEST_FILE</span> <span class="o">=</span> <span class="s2">&quot;test.csv&quot;</span>
<span class="n">SAMPLE_SUB_FILE</span> <span class="o">=</span> <span class="s2">&quot;sample_submission.csv&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Let's-Use-XGBosst-on-MLPipeline">Let's Use XGBosst on MLPipeline<a class="anchor-link" href="#Let's-Use-XGBosst-on-MLPipeline"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>You can also use MLPipeline with XGBoost model, Make sure to install XGBooost depending upon your OS.</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>For example, Here we are using LogisticRegression from Scikit-Learn, on  <a href="https://www.kaggle.com/c/tabular-playground-series-nov-2021/data">Kaggle TPS Challenge (Nov 2021) data</a></em></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># !conda install -c conda-forge xgboost</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xgb_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
    <span class="s1">&#39;booster&#39;</span><span class="p">:</span> <span class="s1">&#39;gbtree&#39;</span><span class="p">,</span>
    <span class="s1">&#39;eval_metric&#39;</span><span class="p">:</span> <span class="s1">&#39;auc&#39;</span><span class="p">,</span>
<span class="c1">#     &#39;tree_method&#39;: &#39;gpu_hist&#39;,</span>
<span class="c1">#     &#39;predictor&#39;: &#39;gpu_predictor&#39;,</span>
    <span class="s1">&#39;use_label_encoder&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="mi">42</span>
<span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="c1"># create xgb Classifier model</span>
<span class="n">xgb_model</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="o">**</span><span class="n">xgb_params</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xgb_ml_pl</span> <span class="o">=</span> <span class="n">MLPipeline</span><span class="p">()</span><span class="o">.</span><span class="n">prepare_data_for_training</span><span class="p">(</span>
    <span class="n">train_file_path</span><span class="o">=</span> <span class="n">DIRECTORY_PATH</span> <span class="o">+</span> <span class="n">TRAIN_FILE</span><span class="p">,</span>
    <span class="n">test_file_path</span><span class="o">=</span> <span class="n">DIRECTORY_PATH</span> <span class="o">+</span> <span class="n">TEST_FILE</span><span class="p">,</span>
    <span class="n">idx_col</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span>
    <span class="n">target</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="n">xgb_model</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
    <span class="n">valid_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;X_train shape is </span><span class="si">{</span><span class="n">xgb_ml_pl</span><span class="o">.</span><span class="n">dataframeloader</span><span class="o">.</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;X_valid shape is </span><span class="si">{</span><span class="n">xgb_ml_pl</span><span class="o">.</span><span class="n">dataframeloader</span><span class="o">.</span><span class="n">X_valid</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;y_train shape is </span><span class="si">{</span><span class="n">xgb_ml_pl</span><span class="o">.</span><span class="n">dataframeloader</span><span class="o">.</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;y_valid shape is </span><span class="si">{</span><span class="n">xgb_ml_pl</span><span class="o">.</span><span class="n">dataframeloader</span><span class="o">.</span><span class="n">y_valid</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xgb_ml_pl</span><span class="o">.</span><span class="n">scikit_pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">xgb_ml_pl</span><span class="o">.</span><span class="n">dataframeloader</span><span class="o">.</span><span class="n">X_train</span><span class="p">,</span>
                              <span class="n">xgb_ml_pl</span><span class="o">.</span><span class="n">dataframeloader</span><span class="o">.</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">xgb_ml_pl</span><span class="o">.</span><span class="n">scikit_pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">xgb_ml_pl</span><span class="o">.</span><span class="n">dataframeloader</span><span class="o">.</span><span class="n">X_valid</span><span class="p">)</span>
<span class="n">preds_probs</span> <span class="o">=</span> <span class="n">xgb_ml_pl</span><span class="o">.</span><span class="n">scikit_pipeline</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">xgb_ml_pl</span><span class="o">.</span><span class="n">dataframeloader</span><span class="o">.</span><span class="n">X_valid</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;preds shape is </span><span class="si">{</span><span class="n">preds</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;preds_probs shape is </span><span class="si">{</span><span class="n">preds_probs</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">xgb_ml_pl</span><span class="o">.</span><span class="n">dataframeloader</span><span class="o">.</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds_probs</span><span class="p">)</span>
<span class="n">acc</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">xgb_ml_pl</span><span class="o">.</span><span class="n">dataframeloader</span><span class="o">.</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AUC is : </span><span class="si">{</span><span class="n">auc</span><span class="si">}</span><span class="s2"> while Accuracy is : </span><span class="si">{</span><span class="n">acc</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Let's-do-Cross-Validation-for-XGB-Model-on-our-MLPipeline">Let's do Cross Validation for XGB Model on our MLPipeline<a class="anchor-link" href="#Let's-do-Cross-Validation-for-XGB-Model-on-our-MLPipeline"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># xgb_ml_pl = MLPipeline().prepare_data_for_cv(train_file_path= &quot;input/home_data/train.csv&quot;,</span>
<span class="c1">#                                              test_file_path= &quot;input/home_data/test.csv&quot;,</span>
<span class="c1">#                                              idx_col=&quot;Id&quot;, target=&quot;SalePrice&quot;,</span>
<span class="c1">#                                              model=xgb_model,random_state=42,</span>
<span class="c1">#                                              cv_cols_type = &quot;all&quot;) #cv_cols_type = all|num|cat</span>
<span class="c1"># # Now fit and predict</span>
<span class="c1"># scores = xgb_ml_pl.cross_validation(estimator=xgb_ml_pl.scikit_pipeline, cv=5,</span>
<span class="c1">#                                     scoring=&#39;neg_mean_absolute_error&#39;)</span>
<span class="c1"># print(&quot;scores:&quot;, scores)</span>
<span class="c1"># print(&quot;Average MAE score:&quot;, scores.mean())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># # run the script to build </span>

<span class="c1"># from nbdev.export import notebook2script; notebook2script()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Create-Kaggle-Predictions">Create Kaggle Predictions<a class="anchor-link" href="#Create-Kaggle-Predictions"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_preds_probs</span> <span class="o">=</span> <span class="n">sci_ml_pl</span><span class="o">.</span><span class="n">scikit_pipeline</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">sci_ml_pl</span><span class="o">.</span><span class="n">dataframeloader</span><span class="o">.</span><span class="n">X_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;X_train shape is </span><span class="si">{</span><span class="n">sci_ml_pl</span><span class="o">.</span><span class="n">dataframeloader</span><span class="o">.</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;test_preds_probs shape is </span><span class="si">{</span><span class="n">test_preds_probs</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sub</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">DIRECTORY_PATH</span> <span class="o">+</span> <span class="n">SAMPLE_SUB_FILE</span><span class="p">)</span>
<span class="n">sub</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_preds_probs</span>
<span class="n">sub</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;submission.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

