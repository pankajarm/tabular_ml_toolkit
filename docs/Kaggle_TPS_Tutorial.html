---

title: Getting Started Kaggle TPS Challenge with Tabular ML Toolkit


keywords: fastai
sidebar: home_sidebar

summary: "A Tutorial to showcase usage of tabular_ml_toolkit (tmlt) library on Kaggle TPS Challenge Nov 2021."
description: "A Tutorial to showcase usage of tabular_ml_toolkit (tmlt) library on Kaggle TPS Challenge Nov 2021."
nb_path: "13_Kaggle_TPS_Tutorial.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 13_Kaggle_TPS_Tutorial.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install">Install<a class="anchor-link" href="#Install"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>pip install -U tabular_ml_toolkit</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="How-to-Best-Use-tabular_ml_toolkit">How to Best Use tabular_ml_toolkit<a class="anchor-link" href="#How-to-Best-Use-tabular_ml_toolkit"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Start with your favorite model and then just simply create <strong>tmlt</strong> with one API.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>Here we are using XGBClassifier, on  <a href="https://www.kaggle.com/c/tabular-playground-series-nov-2021/data">Kaggle TPS Challenge (Nov 2021) data</a></em></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">tabular_ml_toolkit.tmlt</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/Users/pankajmathur/anaconda3/envs/nbdev_env/lib/python3.9/site-packages/redis/connection.py:77: UserWarning: redis-py works best with hiredis. Please consider installing
  warnings.warn(msg)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">accuracy_score</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DIRECTORY_PATH</span> <span class="o">=</span> <span class="s2">&quot;/Users/pankajmathur/kaggle_datasets/tps_nov_2021/&quot;</span>
<span class="n">TRAIN_FILE</span> <span class="o">=</span> <span class="s2">&quot;train.csv&quot;</span>
<span class="n">TEST_FILE</span> <span class="o">=</span> <span class="s2">&quot;test.csv&quot;</span>
<span class="n">SAMPLE_SUB_FILE</span> <span class="o">=</span> <span class="s2">&quot;sample_submission.csv&quot;</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="s2">&quot;kaggle_tps_output/&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Just-point-tmlt-in-the-direction-of-your-data">Just point tmlt in the direction of your data<a class="anchor-link" href="#Just-point-tmlt-in-the-direction-of-your-data"> </a></h4><h4 id="Let-it-know-what-are-idx-and-target-columns-in-your-tabular-data">Let it know what are idx and target columns in your tabular data<a class="anchor-link" href="#Let-it-know-what-are-idx-and-target-columns-in-your-tabular-data"> </a></h4><h4 id="what-kind-of-problem-type-you-are-trying-to-resolve?">what kind of problem type you are trying to resolve?<a class="anchor-link" href="#what-kind-of-problem-type-you-are-trying-to-resolve?"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmlt</span> <span class="o">=</span> <span class="n">TMLT</span><span class="p">()</span><span class="o">.</span><span class="n">prepare_data</span><span class="p">(</span>
    <span class="n">train_file_path</span><span class="o">=</span> <span class="n">DIRECTORY_PATH</span> <span class="o">+</span> <span class="n">TRAIN_FILE</span><span class="p">,</span>
    <span class="n">test_file_path</span><span class="o">=</span> <span class="n">DIRECTORY_PATH</span> <span class="o">+</span> <span class="n">TEST_FILE</span><span class="p">,</span>
    <span class="c1">#make sure to use right index and target columns</span>
    <span class="n">idx_col</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span>
    <span class="n">target</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
    <span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;binary_classification&quot;</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">4000</span><span class="p">)</span>


<span class="c1"># supports only task type</span>
<span class="c1"># &quot;binary_classification&quot;</span>
<span class="c1"># &quot;multi_label_classification&quot;</span>
<span class="c1"># &quot;multi_class_classification&quot;</span>
<span class="c1"># &quot;regression&quot;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 23:20:08,236 INFO 8 cores found, model and data parallel processing should worked!
2021-12-06 23:20:08,350 INFO DataFrame Memory usage decreased to 0.80 Mb (74.4% reduction)
2021-12-06 23:20:08,457 INFO DataFrame Memory usage decreased to 0.79 Mb (74.3% reduction)
2021-12-06 23:20:08,502 INFO PreProcessing will include target(s) encoding!
2021-12-06 23:20:08,503 INFO categorical columns are None, Preprocessing will done accordingly!
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
(4000, 100)
&lt;class &#39;numpy.ndarray&#39;&gt;
(4000,)
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
(4000, 100)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>f0</th>
      <th>f1</th>
      <th>f2</th>
      <th>f3</th>
      <th>f4</th>
      <th>f5</th>
      <th>f6</th>
      <th>f7</th>
      <th>f8</th>
      <th>f9</th>
      <th>...</th>
      <th>f90</th>
      <th>f91</th>
      <th>f92</th>
      <th>f93</th>
      <th>f94</th>
      <th>f95</th>
      <th>f96</th>
      <th>f97</th>
      <th>f98</th>
      <th>f99</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.106628</td>
      <td>3.593750</td>
      <td>132.750000</td>
      <td>3.183594</td>
      <td>0.081970</td>
      <td>1.188477</td>
      <td>3.732422</td>
      <td>2.265625</td>
      <td>2.099609</td>
      <td>0.012329</td>
      <td>...</td>
      <td>0.010742</td>
      <td>1.098633</td>
      <td>0.013329</td>
      <td>-0.011719</td>
      <td>0.052765</td>
      <td>0.065430</td>
      <td>4.210938</td>
      <td>1.978516</td>
      <td>0.085999</td>
      <td>0.240479</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.125000</td>
      <td>1.673828</td>
      <td>76.562500</td>
      <td>3.378906</td>
      <td>0.099426</td>
      <td>5.093750</td>
      <td>1.275391</td>
      <td>-0.471436</td>
      <td>4.546875</td>
      <td>0.037720</td>
      <td>...</td>
      <td>0.135864</td>
      <td>3.460938</td>
      <td>0.017059</td>
      <td>0.124878</td>
      <td>0.154053</td>
      <td>0.606934</td>
      <td>-0.267822</td>
      <td>2.578125</td>
      <td>-0.020874</td>
      <td>0.024719</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.036316</td>
      <td>1.497070</td>
      <td>233.500000</td>
      <td>2.195312</td>
      <td>0.026917</td>
      <td>3.126953</td>
      <td>5.058594</td>
      <td>3.849609</td>
      <td>1.801758</td>
      <td>0.057007</td>
      <td>...</td>
      <td>0.117310</td>
      <td>4.882812</td>
      <td>0.085205</td>
      <td>0.032410</td>
      <td>0.116089</td>
      <td>-0.001689</td>
      <td>-0.520020</td>
      <td>2.140625</td>
      <td>0.124451</td>
      <td>0.148193</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.014076</td>
      <td>0.245972</td>
      <td>780.000000</td>
      <td>1.890625</td>
      <td>0.006947</td>
      <td>1.531250</td>
      <td>2.697266</td>
      <td>4.515625</td>
      <td>4.503906</td>
      <td>0.123474</td>
      <td>...</td>
      <td>-0.015350</td>
      <td>3.474609</td>
      <td>-0.017105</td>
      <td>-0.008102</td>
      <td>0.062012</td>
      <td>0.041199</td>
      <td>0.511719</td>
      <td>1.968750</td>
      <td>0.040009</td>
      <td>0.044861</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.003260</td>
      <td>3.714844</td>
      <td>156.125000</td>
      <td>2.148438</td>
      <td>0.018280</td>
      <td>2.097656</td>
      <td>4.156250</td>
      <td>-0.038239</td>
      <td>3.371094</td>
      <td>0.034180</td>
      <td>...</td>
      <td>0.013779</td>
      <td>1.910156</td>
      <td>-0.042938</td>
      <td>0.105591</td>
      <td>0.125122</td>
      <td>0.037506</td>
      <td>1.043945</td>
      <td>1.075195</td>
      <td>-0.012817</td>
      <td>0.072815</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3995</th>
      <td>0.242188</td>
      <td>2.324219</td>
      <td>-19.109375</td>
      <td>0.984375</td>
      <td>0.036438</td>
      <td>0.424561</td>
      <td>2.269531</td>
      <td>3.621094</td>
      <td>4.062500</td>
      <td>1.197266</td>
      <td>...</td>
      <td>-0.002506</td>
      <td>3.064453</td>
      <td>0.112427</td>
      <td>0.100220</td>
      <td>0.036530</td>
      <td>0.451172</td>
      <td>1.316406</td>
      <td>4.625000</td>
      <td>0.056183</td>
      <td>0.029724</td>
    </tr>
    <tr>
      <th>3996</th>
      <td>0.138306</td>
      <td>0.679199</td>
      <td>37.125000</td>
      <td>2.736328</td>
      <td>-0.043549</td>
      <td>0.514648</td>
      <td>4.542969</td>
      <td>3.132812</td>
      <td>4.972656</td>
      <td>0.097961</td>
      <td>...</td>
      <td>0.060730</td>
      <td>4.125000</td>
      <td>-0.031433</td>
      <td>0.059143</td>
      <td>0.164673</td>
      <td>0.058075</td>
      <td>-0.237427</td>
      <td>2.123047</td>
      <td>-0.049316</td>
      <td>0.050842</td>
    </tr>
    <tr>
      <th>3997</th>
      <td>0.025436</td>
      <td>1.316406</td>
      <td>250.375000</td>
      <td>3.689453</td>
      <td>0.015312</td>
      <td>2.490234</td>
      <td>1.983398</td>
      <td>3.556641</td>
      <td>4.164062</td>
      <td>0.156860</td>
      <td>...</td>
      <td>0.038269</td>
      <td>4.667969</td>
      <td>0.157593</td>
      <td>0.102234</td>
      <td>1.055664</td>
      <td>0.031769</td>
      <td>1.661133</td>
      <td>1.484375</td>
      <td>-0.027924</td>
      <td>0.098083</td>
    </tr>
    <tr>
      <th>3998</th>
      <td>0.109253</td>
      <td>2.169922</td>
      <td>123.062500</td>
      <td>3.279297</td>
      <td>0.018204</td>
      <td>3.630859</td>
      <td>4.636719</td>
      <td>4.507812</td>
      <td>3.585938</td>
      <td>0.037140</td>
      <td>...</td>
      <td>0.083191</td>
      <td>3.623047</td>
      <td>0.108765</td>
      <td>0.111877</td>
      <td>0.020645</td>
      <td>0.125122</td>
      <td>2.648438</td>
      <td>2.753906</td>
      <td>0.012726</td>
      <td>0.035583</td>
    </tr>
    <tr>
      <th>3999</th>
      <td>-0.032227</td>
      <td>1.616211</td>
      <td>171.875000</td>
      <td>3.207031</td>
      <td>-0.008675</td>
      <td>2.208984</td>
      <td>4.097656</td>
      <td>1.391602</td>
      <td>2.486328</td>
      <td>0.121643</td>
      <td>...</td>
      <td>0.074463</td>
      <td>0.529785</td>
      <td>0.002768</td>
      <td>0.098877</td>
      <td>0.148682</td>
      <td>0.056061</td>
      <td>4.210938</td>
      <td>0.759766</td>
      <td>0.063538</td>
      <td>0.097046</td>
    </tr>
  </tbody>
</table>
<p>4000 rows Ã— 100 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Training">Training<a class="anchor-link" href="#Training"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="create-train-valid-dataframes-for-quick-preprocessing-and-training">create train valid dataframes for quick preprocessing and training<a class="anchor-link" href="#create-train-valid-dataframes-for-quick-preprocessing-and-training"> </a></h5>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1"># create train, valid split to evaulate model on valid dataset</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_valid</span><span class="p">,</span>  <span class="n">y_train</span><span class="p">,</span> <span class="n">y_valid</span> <span class="o">=</span>  <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">create_train_valid</span><span class="p">(</span><span class="n">valid_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 5.46 ms, sys: 1.46 ms, total: 6.92 ms
Wall time: 6.05 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_valid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_valid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># print(X_train.columns.to_list())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(3200, 100)
(3200,)
(800, 100)
(800,)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Now-PreProcess-X_train,-X_valid">Now PreProcess X_train, X_valid<a class="anchor-link" href="#Now-PreProcess-X_train,-X_valid"> </a></h5><p>NOTE: Preprocessing gives back numpy arrays for pandas dataframe</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">X_train_np</span><span class="p">,</span>  <span class="n">X_valid_np</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">pp_fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_valid</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">X_train_np</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_train_np</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1"># print(X_train_np)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">X_valid_np</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_valid_np</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1"># print(X_valid_np)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">y_valid</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">y_train</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;numpy.ndarray&#39;&gt;
(3200, 100)
&lt;class &#39;numpy.ndarray&#39;&gt;
(800, 100)
&lt;class &#39;numpy.ndarray&#39;&gt;
&lt;class &#39;numpy.ndarray&#39;&gt;
CPU times: user 24.3 ms, sys: 1.71 ms, total: 26 ms
Wall time: 24.7 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Create-a-base-xgb-classifier-model-with-your-best-guess-params">Create a base xgb classifier model with your best guess params<a class="anchor-link" href="#Create-a-base-xgb-classifier-model-with-your-best-guess-params"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xgb_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># your best guess params</span>
    <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="s1">&#39;eval_metric&#39;</span><span class="p">:</span><span class="s1">&#39;auc&#39;</span><span class="p">,</span>
    <span class="c1"># must for xgb classifier otherwise warning will be shown</span>
    <span class="s1">&#39;use_label_encoder&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
    <span class="c1"># because 42 is the answer for all the randomness of this universe</span>
    <span class="s1">&#39;random_state&#39;</span><span class="p">:</span><span class="mi">42</span><span class="p">,</span>
    <span class="c1">#for GPU</span>
    <span class="c1">#&#39;tree_method&#39;: &#39;gpu_hist&#39;,</span>
    <span class="c1">#&#39;predictor&#39;: &#39;gpu_predictor&#39;,</span>
<span class="p">}</span>

<span class="n">xgb_model</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="o">**</span><span class="n">xgb_params</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1"># Now do model training</span>
<span class="n">xgb_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_np</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
              <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="c1">#detect &amp; avoid overfitting</span>
              <span class="n">eval_set</span><span class="o">=</span><span class="p">[(</span><span class="n">X_train_np</span><span class="p">,</span> <span class="n">y_train</span><span class="p">),</span> <span class="p">(</span><span class="n">X_valid_np</span><span class="p">,</span> <span class="n">y_valid</span><span class="p">)],</span>
              <span class="n">eval_metric</span><span class="o">=</span><span class="s2">&quot;auc&quot;</span><span class="p">,</span>
              <span class="n">early_stopping_rounds</span><span class="o">=</span><span class="mi">300</span>
             <span class="p">)</span>

<span class="c1">#predict</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">xgb_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_valid_np</span><span class="p">)</span>
<span class="n">preds_probs</span> <span class="o">=</span> <span class="n">xgb_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_valid_np</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="c1"># Metrics</span>
<span class="n">auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds_probs</span><span class="p">)</span>
<span class="n">acc</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AUC is : </span><span class="si">{</span><span class="n">auc</span><span class="si">}</span><span class="s2"> while Accuracy is : </span><span class="si">{</span><span class="n">acc</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>AUC is : 0.6142302819132088 while Accuracy is : 0.6175 
CPU times: user 10.9 s, sys: 167 ms, total: 11.1 s
Wall time: 1.73 s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="For-Meta-Ensemble-Models-Training">For Meta Ensemble Models Training<a class="anchor-link" href="#For-Meta-Ensemble-Models-Training"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Make-sure-to-PreProcess-the-data">Make sure to PreProcess the data<a class="anchor-link" href="#Make-sure-to-PreProcess-the-data"> </a></h5>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">X_np</span><span class="p">,</span> <span class="n">X_test_np</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">pp_fit_transform</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_np</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 273 ms, sys: 19.2 ms, total: 292 ms
Wall time: 45.2 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Base-Model-1:-linear-SVM-model">Base Model 1: linear SVM model<a class="anchor-link" href="#Base-Model-1:-linear-SVM-model"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">LinearSVC</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>

<span class="c1"># OOF training and prediction on both train and test dataset by a given model</span>
<span class="c1">#choose model</span>
<span class="n">linear_oof_model</span> <span class="o">=</span> <span class="n">LinearSVC</span><span class="p">(</span><span class="n">tol</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">,</span> <span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span> <span class="n">dual</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1">#fit and predict</span>
<span class="n">linear_oof_model_preds</span><span class="p">,</span> <span class="n">linear_oof_model_test_preds</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">do_oof_kfold_train_preds</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                                                                    <span class="n">oof_model</span><span class="o">=</span><span class="n">linear_oof_model</span><span class="p">,</span>
                                                                                    <span class="n">X</span> <span class="o">=</span> <span class="n">X_np</span><span class="p">,</span>
                                                                                    <span class="n">y</span> <span class="o">=</span> <span class="n">y_np</span><span class="p">,</span>
                                                                                    <span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test_np</span><span class="p">)</span>

<span class="k">if</span> <span class="n">linear_oof_model_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">linear_oof_model_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="k">if</span> <span class="n">linear_oof_model_test_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>    
    <span class="nb">print</span><span class="p">(</span><span class="n">linear_oof_model_test_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 23:20:10,385 INFO Training Started!
2021-12-06 23:20:10,418 INFO Training Finished!
2021-12-06 23:20:10,421 INFO fold: 1 OOF Model ROC AUC: 0.7257962604771115!
2021-12-06 23:20:10,426 INFO Training Started!
2021-12-06 23:20:10,453 INFO Training Finished!
2021-12-06 23:20:10,456 INFO fold: 2 OOF Model ROC AUC: 0.6957833655705996!
2021-12-06 23:20:10,461 INFO Training Started!
2021-12-06 23:20:10,492 INFO Training Finished!
2021-12-06 23:20:10,495 INFO fold: 3 OOF Model ROC AUC: 0.6616956802063185!
2021-12-06 23:20:10,500 INFO Training Started!
2021-12-06 23:20:10,538 INFO Training Finished!
2021-12-06 23:20:10,541 INFO fold: 4 OOF Model ROC AUC: 0.7076379002699064!
2021-12-06 23:20:10,546 INFO Training Started!
2021-12-06 23:20:10,580 INFO Training Finished!
2021-12-06 23:20:10,584 INFO fold: 5 OOF Model ROC AUC: 0.7227243154104317!
2021-12-06 23:20:10,588 INFO Mean OOF Model ROC AUC: 0.7027275043868735!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000,)
(4000,)
CPU times: user 793 ms, sys: 186 ms, total: 979 ms
Wall time: 206 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Base-Model-2:-Logistic-Regression-Model">Base Model 2: Logistic Regression Model<a class="anchor-link" href="#Base-Model-2:-Logistic-Regression-Model"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>

<span class="c1"># OOF training and prediction on both train and test dataset by a given model</span>

<span class="c1">#choose model</span>
<span class="n">log_oof_model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1">#fit and predict</span>
<span class="n">log_oof_model_preds</span><span class="p">,</span> <span class="n">log_oof_model_test_preds</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">do_oof_kfold_train_preds</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                                                                    <span class="n">oof_model</span><span class="o">=</span><span class="n">log_oof_model</span><span class="p">,</span>
                                                                                    <span class="n">X</span> <span class="o">=</span> <span class="n">X_np</span><span class="p">,</span>
                                                                                    <span class="n">y</span> <span class="o">=</span> <span class="n">y_np</span><span class="p">,</span>
                                                                                    <span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test_np</span><span class="p">)</span>
<span class="k">if</span> <span class="n">log_oof_model_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">log_oof_model_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="k">if</span> <span class="n">log_oof_model_test_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>    
    <span class="nb">print</span><span class="p">(</span><span class="n">log_oof_model_test_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 23:20:10,605 INFO Training Started!
2021-12-06 23:20:10,630 INFO Training Finished!
2021-12-06 23:20:10,633 INFO fold: 1 OOF Model ROC AUC: 0.7271695680206318!
2021-12-06 23:20:10,637 INFO Training Started!
2021-12-06 23:20:10,665 INFO Training Finished!
2021-12-06 23:20:10,667 INFO fold: 2 OOF Model ROC AUC: 0.694622823984526!
2021-12-06 23:20:10,672 INFO Training Started!
2021-12-06 23:20:10,699 INFO Training Finished!
2021-12-06 23:20:10,703 INFO fold: 3 OOF Model ROC AUC: 0.662114764667956!
2021-12-06 23:20:10,707 INFO Training Started!
2021-12-06 23:20:10,730 INFO Training Finished!
2021-12-06 23:20:10,733 INFO fold: 4 OOF Model ROC AUC: 0.7080501678057705!
2021-12-06 23:20:10,737 INFO Training Started!
2021-12-06 23:20:10,762 INFO Training Finished!
2021-12-06 23:20:10,764 INFO fold: 5 OOF Model ROC AUC: 0.7226276902067136!
2021-12-06 23:20:10,768 INFO Mean OOF Model ROC AUC: 0.7029170029371196!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000,)
(4000,)
CPU times: user 503 ms, sys: 116 ms, total: 618 ms
Wall time: 167 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Base-Model-3:-SKLearn-MLP">Base Model 3: SKLearn MLP<a class="anchor-link" href="#Base-Model-3:-SKLearn-MLP"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.neural_network</span> <span class="kn">import</span> <span class="n">MLPClassifier</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>

<span class="c1"># OOF training and prediction on both train and test dataset by a given model</span>

<span class="c1">#choose model</span>
<span class="n">mlp_oof_model</span> <span class="o">=</span> <span class="n">MLPClassifier</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">early_stopping</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#update the model on sklearn pipeline</span>
<span class="c1"># tmlt = tmlt.update_model(mlp_oof_model)</span>

<span class="c1"># # lets see updated sklearn pipeline with new model</span>
<span class="c1"># tmlt.spl</span>

<span class="c1">#fit and predict</span>
<span class="n">mlp_oof_model_preds</span><span class="p">,</span> <span class="n">mlp_oof_model_test_preds</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">do_oof_kfold_train_preds</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                                                                    <span class="n">oof_model</span><span class="o">=</span><span class="n">mlp_oof_model</span><span class="p">,</span>
                                                                                    <span class="n">X</span> <span class="o">=</span> <span class="n">X_np</span><span class="p">,</span>
                                                                                    <span class="n">y</span> <span class="o">=</span> <span class="n">y_np</span><span class="p">,</span>
                                                                                    <span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test_np</span><span class="p">)</span>
<span class="k">if</span> <span class="n">mlp_oof_model_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">mlp_oof_model_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="k">if</span> <span class="n">mlp_oof_model_test_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>    
    <span class="nb">print</span><span class="p">(</span><span class="n">mlp_oof_model_test_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 23:20:10,782 INFO Training Started!
2021-12-06 23:20:11,064 INFO Training Finished!
2021-12-06 23:20:11,067 INFO fold: 1 OOF Model ROC AUC: 0.7153836234687297!
2021-12-06 23:20:11,076 INFO Training Started!
2021-12-06 23:20:11,294 INFO Training Finished!
2021-12-06 23:20:11,297 INFO fold: 2 OOF Model ROC AUC: 0.6823726627981948!
2021-12-06 23:20:11,306 INFO Training Started!
2021-12-06 23:20:11,476 INFO Training Finished!
2021-12-06 23:20:11,479 INFO fold: 3 OOF Model ROC AUC: 0.6245067698259188!
2021-12-06 23:20:11,487 INFO Training Started!
2021-12-06 23:20:11,916 INFO Training Finished!
2021-12-06 23:20:11,920 INFO fold: 4 OOF Model ROC AUC: 0.6928606857812791!
2021-12-06 23:20:11,928 INFO Training Started!
2021-12-06 23:20:12,115 INFO Training Finished!
2021-12-06 23:20:12,119 INFO fold: 5 OOF Model ROC AUC: 0.6891696029992462!
2021-12-06 23:20:12,127 INFO Mean OOF Model ROC AUC: 0.6808586689746737!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000,)
(4000,)
CPU times: user 4.5 s, sys: 730 ms, total: 5.23 s
Wall time: 1.35 s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Base-Model-4:-TabNet">Base Model 4: TabNet<a class="anchor-link" href="#Base-Model-4:-TabNet"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pytorch_tabnet.tab_model</span> <span class="kn">import</span> <span class="n">TabNetClassifier</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>

<span class="c1"># OOF training and prediction on both train and test dataset by a given model</span>

<span class="c1">#choose model</span>
<span class="n">tabnet_oof_model</span> <span class="o">=</span> <span class="n">TabNetClassifier</span><span class="p">(</span><span class="n">optimizer_params</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">lr</span><span class="o">=</span><span class="mf">0.02</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1">#fit and predict</span>
<span class="n">tabnet_oof_model_preds</span><span class="p">,</span> <span class="n">tabnet_oof_model_test_preds</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">do_oof_kfold_train_preds</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                                                                    <span class="n">oof_model</span><span class="o">=</span><span class="n">tabnet_oof_model</span><span class="p">,</span>
                                                                                    <span class="n">X</span> <span class="o">=</span> <span class="n">X_np</span><span class="p">,</span>
                                                                                    <span class="n">y</span> <span class="o">=</span> <span class="n">y_np</span><span class="p">,</span>
                                                                                    <span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test_np</span><span class="p">)</span>

<span class="k">if</span> <span class="n">tabnet_oof_model_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">tabnet_oof_model_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="k">if</span> <span class="n">tabnet_oof_model_test_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">tabnet_oof_model_test_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 23:20:12,142 INFO Training Started!
2021-12-06 23:20:20,277 INFO Training Finished!
2021-12-06 23:20:20,308 INFO fold: 1 OOF Model ROC AUC: 0.558401031592521!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Stop training because you reached max_epochs = 50 with best_epoch = 44 and best_val_0_auc = 0.5584
Best weights from best epoch are automatically used!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 23:20:20,423 INFO Training Started!
2021-12-06 23:20:22,374 INFO Training Finished!
2021-12-06 23:20:22,405 INFO fold: 2 OOF Model ROC AUC: 0.6584655061250806!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
Early stopping occurred at epoch 11 with best_epoch = 1 and best_val_0_auc = 0.65847
Best weights from best epoch are automatically used!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 23:20:22,518 INFO Training Started!
2021-12-06 23:20:24,393 INFO Training Finished!
2021-12-06 23:20:24,425 INFO fold: 3 OOF Model ROC AUC: 0.6677756286266925!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
Early stopping occurred at epoch 10 with best_epoch = 0 and best_val_0_auc = 0.66778
Best weights from best epoch are automatically used!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 23:20:24,539 INFO Training Started!
2021-12-06 23:20:26,372 INFO Training Finished!
2021-12-06 23:20:26,403 INFO fold: 4 OOF Model ROC AUC: 0.6324828168179388!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
Early stopping occurred at epoch 10 with best_epoch = 0 and best_val_0_auc = 0.63248
Best weights from best epoch are automatically used!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 23:20:26,520 INFO Training Started!
2021-12-06 23:20:28,385 INFO Training Finished!
2021-12-06 23:20:28,416 INFO fold: 5 OOF Model ROC AUC: 0.6354975231739447!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
Early stopping occurred at epoch 10 with best_epoch = 0 and best_val_0_auc = 0.6355
Best weights from best epoch are automatically used!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 23:20:28,533 INFO Mean OOF Model ROC AUC: 0.6305245012672356!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000,)
(4000,)
CPU times: user 17.6 s, sys: 5.93 s, total: 23.6 s
Wall time: 16.4 s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Now-add-back-based-models-predictions-to-X-and-X_test">Now add back based models predictions to X and X_test<a class="anchor-link" href="#Now-add-back-based-models-predictions-to-X-and-X_test"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;linear_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linear_oof_model_preds</span>
<span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;linear_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linear_oof_model_test_preds</span>

<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000, 101)
(4000, 101)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;log_reg_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_oof_model_preds</span>
<span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;log_reg_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_oof_model_test_preds</span>

<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000, 102)
(4000, 102)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;mlp_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mlp_oof_model_preds</span>
<span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;mlp_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mlp_oof_model_test_preds</span>

<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000, 103)
(4000, 103)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;tabnet_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tabnet_oof_model_preds</span>
<span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;tabnet_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tabnet_oof_model_test_preds</span>

<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000, 104)
(4000, 104)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmlt</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">update_dfl</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">X_test</span><span class="o">=</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 23:20:28,605 INFO categorical columns are None, Preprocessing will done accordingly!
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="For-META-Model-Training">For META Model Training<a class="anchor-link" href="#For-META-Model-Training"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="create-train-valid-dataframes-for-quick-preprocessing-and-training">create train valid dataframes for quick preprocessing and training<a class="anchor-link" href="#create-train-valid-dataframes-for-quick-preprocessing-and-training"> </a></h5>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1"># create train, valid split to evaulate model on valid dataset</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_valid</span><span class="p">,</span>  <span class="n">y_train</span><span class="p">,</span> <span class="n">y_valid</span> <span class="o">=</span>  <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">create_train_valid</span><span class="p">(</span><span class="n">valid_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_valid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_valid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># print(X_train.columns.to_list())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(3200, 104)
(3200,)
(800, 104)
(800,)
CPU times: user 6.7 ms, sys: 1.61 ms, total: 8.31 ms
Wall time: 7.1 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Now-PreProcess-X_train,-X_valid">Now PreProcess X_train, X_valid<a class="anchor-link" href="#Now-PreProcess-X_train,-X_valid"> </a></h5><p>NOTE: Preprocessing gives back numpy arrays for pandas dataframe</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">X_train_np</span><span class="p">,</span>  <span class="n">X_valid_np</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">pp_fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_valid</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">X_train_np</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_train_np</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1"># print(X_train_np)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">X_valid_np</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_valid_np</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1"># print(X_valid_np)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">y_valid</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">y_train</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;numpy.ndarray&#39;&gt;
(3200, 104)
&lt;class &#39;numpy.ndarray&#39;&gt;
(800, 104)
&lt;class &#39;numpy.ndarray&#39;&gt;
&lt;class &#39;numpy.ndarray&#39;&gt;
CPU times: user 40 ms, sys: 3.39 ms, total: 43.4 ms
Wall time: 42.7 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#     &#39;objective&#39;: &#39;binary:logistic&#39;, </span>
<span class="c1">#     &#39;use_label_encoder&#39;: False,</span>
<span class="c1">#     &#39;n_estimators&#39;: 40000,</span>
<span class="c1">#     &#39;learning_rate&#39;: 0.18515462875481553,</span>
<span class="c1">#     &#39;subsample&#39;: 0.97, </span>
<span class="c1">#     &#39;colsample_bytree&#39;: 0.32,</span>
<span class="c1">#     &#39;max_depth&#39;: 1,</span>
<span class="c1">#     &#39;booster&#39;: &#39;gbtree&#39;,</span>
<span class="c1">#     &#39;gamma&#39;: 0.2, </span>
<span class="c1">#     &#39;tree_method&#39;: &#39;gpu_hist&#39;,</span>
<span class="c1">#     &#39;reg_lambda&#39;: 0.11729916523488974, </span>
<span class="c1">#     &#39;reg_alpha&#39;: 0.6318827156945853,</span>
<span class="c1">#     &#39;random_state&#39;: 42,</span>
<span class="c1">#     &#39;n_jobs&#39;: 4, </span>
<span class="c1">#     &#39;min_child_weight&#39;: 256,</span>
<span class="c1">#     #for GPU</span>
<span class="c1"># #     &#39;tree_method&#39;: &#39;gpu_hist&#39;,</span>
<span class="c1"># #     &#39;predictor&#39;: &#39;gpu_predictor&#39;,</span>
<span class="c1">#     }</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1"># Now do model training</span>
<span class="n">xgb_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_np</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
              <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="c1">#detect &amp; avoid overfitting</span>
              <span class="n">eval_set</span><span class="o">=</span><span class="p">[(</span><span class="n">X_train_np</span><span class="p">,</span> <span class="n">y_train</span><span class="p">),</span> <span class="p">(</span><span class="n">X_valid_np</span><span class="p">,</span> <span class="n">y_valid</span><span class="p">)],</span>
              <span class="n">eval_metric</span><span class="o">=</span><span class="s2">&quot;auc&quot;</span><span class="p">,</span>
              <span class="n">early_stopping_rounds</span><span class="o">=</span><span class="mi">300</span>
             <span class="p">)</span>

<span class="c1">#predict</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">xgb_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_valid_np</span><span class="p">)</span>
<span class="n">preds_probs</span> <span class="o">=</span> <span class="n">xgb_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_valid_np</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="c1"># Metrics</span>
<span class="n">auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds_probs</span><span class="p">)</span>
<span class="n">acc</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AUC is : </span><span class="si">{</span><span class="n">auc</span><span class="si">}</span><span class="s2"> while Accuracy is : </span><span class="si">{</span><span class="n">acc</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>AUC is : 0.6986887604265654 while Accuracy is : 0.6825 
CPU times: user 11 s, sys: 121 ms, total: 11.1 s
Wall time: 1.56 s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="WOW!!!!">WOW!!!!<a class="anchor-link" href="#WOW!!!!"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="For-Meta-Model,-Let's-do-Optuna-based-HyperParameter-search-to-get-best-params-for-fit">For Meta Model, Let's do Optuna based HyperParameter search to get best params for fit<a class="anchor-link" href="#For-Meta-Model,-Let's-do-Optuna-based-HyperParameter-search-to-get-best-params-for-fit"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">study</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">do_xgb_optuna_optimization</span><span class="p">(</span><span class="n">optuna_db_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">,</span> <span class="n">opt_timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">study</span><span class="o">.</span><span class="n">best_trial</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 23:20:30,245 INFO Optimization Direction is: maximize
<span class="ansi-green-fg">[I 2021-12-06 23:20:30,307]</span> Using an existing study with name &#39;tmlt_autoxgb&#39; instead of creating a new one.
2021-12-06 23:20:30,497 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[23:20:30] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { colsample_bytree, early_stopping_rounds, eval_set, max_depth, subsample, tree_method } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 23:20:37,693 INFO Training Ended!
2021-12-06 23:20:37,706 INFO roc_auc_score: 0.7720541653468482
2021-12-06 23:20:37,706 INFO log_loss: 0.5504097771365195
2021-12-06 23:20:37,707 INFO accuracy_score: 0.72375
2021-12-06 23:20:37,707 INFO f1_score: 0.6285714285714287
2021-12-06 23:20:37,708 INFO precision_score: 0.6515679442508711
2021-12-06 23:20:37,708 INFO recall_score: 0.6071428571428571
<span class="ansi-green-fg">[I 2021-12-06 23:20:37,741]</span> Trial 35 finished with value: 0.7720541653468482 and parameters: {&#39;learning_rate&#39;: 0.06917055652243276, &#39;n_estimators&#39;: 7000, &#39;reg_lambda&#39;: 0.0005717720260170862, &#39;reg_alpha&#39;: 6.546458405891649e-07, &#39;subsample&#39;: 0.6290090458891053, &#39;colsample_bytree&#39;: 0.9155898469768312, &#39;max_depth&#39;: 7, &#39;early_stopping_rounds&#39;: 139, &#39;tree_method&#39;: &#39;approx&#39;, &#39;booster&#39;: &#39;gblinear&#39;}. Best is trial 18 with value: 0.7734399746594869.
2021-12-06 23:20:37,923 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[23:20:37] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { early_stopping_rounds, eval_set } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 23:21:17,526 INFO Training Ended!
2021-12-06 23:21:17,594 INFO roc_auc_score: 0.6885426565304614
2021-12-06 23:21:17,595 INFO log_loss: 0.6858780123793986
2021-12-06 23:21:17,595 INFO accuracy_score: 0.66875
2021-12-06 23:21:17,595 INFO f1_score: 0.5190562613430126
2021-12-06 23:21:17,596 INFO precision_score: 0.588477366255144
2021-12-06 23:21:17,596 INFO recall_score: 0.4642857142857143
<span class="ansi-green-fg">[I 2021-12-06 23:21:17,637]</span> Trial 36 finished with value: 0.6885426565304614 and parameters: {&#39;learning_rate&#39;: 0.02265165070501582, &#39;n_estimators&#39;: 7000, &#39;reg_lambda&#39;: 2.624192127564028e-07, &#39;reg_alpha&#39;: 0.00036391611478680695, &#39;subsample&#39;: 0.5915030624370501, &#39;colsample_bytree&#39;: 0.23237799890226452, &#39;max_depth&#39;: 9, &#39;early_stopping_rounds&#39;: 164, &#39;tree_method&#39;: &#39;hist&#39;, &#39;booster&#39;: &#39;gbtree&#39;, &#39;gamma&#39;: 0.740465140416424, &#39;grow_policy&#39;: &#39;depthwise&#39;}. Best is trial 18 with value: 0.7734399746594869.
2021-12-06 23:21:17,776 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[23:21:17] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { colsample_bytree, early_stopping_rounds, eval_set, max_depth, subsample, tree_method } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 23:21:32,413 INFO Training Ended!
2021-12-06 23:21:32,425 INFO roc_auc_score: 0.7444303663815859
2021-12-06 23:21:32,426 INFO log_loss: 0.5777584500750527
2021-12-06 23:21:32,426 INFO accuracy_score: 0.7
2021-12-06 23:21:32,427 INFO f1_score: 0.574468085106383
2021-12-06 23:21:32,428 INFO precision_score: 0.6328125
2021-12-06 23:21:32,428 INFO recall_score: 0.525974025974026
<span class="ansi-green-fg">[I 2021-12-06 23:21:32,452]</span> Trial 37 finished with value: 0.7444303663815859 and parameters: {&#39;learning_rate&#39;: 0.056158497794197924, &#39;n_estimators&#39;: 20000, &#39;reg_lambda&#39;: 0.010294961570250994, &#39;reg_alpha&#39;: 1.7037741384478345e-05, &#39;subsample&#39;: 0.4147626780645989, &#39;colsample_bytree&#39;: 0.397278539868545, &#39;max_depth&#39;: 6, &#39;early_stopping_rounds&#39;: 185, &#39;tree_method&#39;: &#39;approx&#39;, &#39;booster&#39;: &#39;gblinear&#39;}. Best is trial 18 with value: 0.7734399746594869.
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>FrozenTrial(number=18, values=[0.7734399746594869], datetime_start=datetime.datetime(2021, 12, 6, 21, 57, 0, 88637), datetime_complete=datetime.datetime(2021, 12, 6, 21, 57, 4, 336934), params={&#39;booster&#39;: &#39;gblinear&#39;, &#39;colsample_bytree&#39;: 0.1027132584989078, &#39;early_stopping_rounds&#39;: 171, &#39;learning_rate&#39;: 0.21761562020600114, &#39;max_depth&#39;: 6, &#39;n_estimators&#39;: 7000, &#39;reg_alpha&#39;: 9.583579660175245e-06, &#39;reg_lambda&#39;: 9.238315962782784e-05, &#39;subsample&#39;: 0.4464473710560276, &#39;tree_method&#39;: &#39;approx&#39;}, distributions={&#39;booster&#39;: CategoricalDistribution(choices=(&#39;gbtree&#39;, &#39;gblinear&#39;)), &#39;colsample_bytree&#39;: UniformDistribution(high=1.0, low=0.1), &#39;early_stopping_rounds&#39;: IntUniformDistribution(high=500, low=100, step=1), &#39;learning_rate&#39;: LogUniformDistribution(high=0.25, low=0.01), &#39;max_depth&#39;: IntUniformDistribution(high=9, low=1, step=1), &#39;n_estimators&#39;: CategoricalDistribution(choices=(7000, 15000, 20000)), &#39;reg_alpha&#39;: LogUniformDistribution(high=100.0, low=1e-08), &#39;reg_lambda&#39;: LogUniformDistribution(high=100.0, low=1e-08), &#39;subsample&#39;: UniformDistribution(high=1.0, low=0.1), &#39;tree_method&#39;: CategoricalDistribution(choices=(&#39;exact&#39;, &#39;approx&#39;, &#39;hist&#39;))}, user_attrs={}, system_attrs={}, intermediate_values={}, trial_id=19, state=TrialState.COMPLETE, value=None)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="now-update-the-meta-model-with-best-params-from-study-and-then-update-the-sklearn-pipeline-with-this-new-model">now update the meta model with best params from study and then update the sklearn pipeline with this new model<a class="anchor-link" href="#now-update-the-meta-model-with-best-params-from-study-and-then-update-the-sklearn-pipeline-with-this-new-model"> </a></h5>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xgb_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">study</span><span class="o">.</span><span class="n">best_trial</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;xgb_params&quot;</span><span class="p">,</span> <span class="n">xgb_params</span><span class="p">)</span>
<span class="n">updated_xgb_model</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="o">**</span><span class="n">xgb_params</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>xgb_params {&#39;learning_rate&#39;: 0.21761562020600114, &#39;eval_metric&#39;: &#39;auc&#39;, &#39;use_label_encoder&#39;: False, &#39;random_state&#39;: 42, &#39;booster&#39;: &#39;gblinear&#39;, &#39;colsample_bytree&#39;: 0.1027132584989078, &#39;early_stopping_rounds&#39;: 171, &#39;max_depth&#39;: 6, &#39;n_estimators&#39;: 7000, &#39;reg_alpha&#39;: 9.583579660175245e-06, &#39;reg_lambda&#39;: 9.238315962782784e-05, &#39;subsample&#39;: 0.4464473710560276, &#39;tree_method&#39;: &#39;approx&#39;}
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Let's-Use-K-Fold-Training-with-best-params">Let's Use K-Fold Training with best params<a class="anchor-link" href="#Let's-Use-K-Fold-Training-with-best-params"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">X_np</span><span class="p">,</span> <span class="n">X_test_np</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">pp_fit_transform</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_np</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 493 ms, sys: 43.3 ms, total: 536 ms
Wall time: 83.6 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1"># k-fold training</span>
<span class="n">xgb_model_metrics_score</span><span class="p">,</span> <span class="n">xgb_model_test_preds</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">do_kfold_training</span><span class="p">(</span><span class="n">X_np</span><span class="p">,</span>
                                                                       <span class="n">y_np</span><span class="p">,</span>
                                                                       <span class="n">X_test</span><span class="o">=</span><span class="n">X_test_np</span><span class="p">,</span>
                                                                       <span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                                                       <span class="n">model</span><span class="o">=</span><span class="n">updated_xgb_model</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 23:21:32,574 INFO  model class:&lt;class &#39;xgboost.sklearn.XGBClassifier&#39;&gt;
2021-12-06 23:21:32,578 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[23:21:32] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { colsample_bytree, early_stopping_rounds, max_depth, subsample, tree_method } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 23:21:42,349 INFO Training Finished!
2021-12-06 23:21:42,350 INFO Predicting Val Probablities!
2021-12-06 23:21:42,352 INFO Predicting Val Score!
2021-12-06 23:21:42,360 INFO fold: 1 roc_auc_score : 0.7861895551257254
2021-12-06 23:21:42,361 INFO fold: 1 log_loss : 0.5517830674474681
2021-12-06 23:21:42,361 INFO fold: 1 accuracy_score : 0.72125
2021-12-06 23:21:42,362 INFO fold: 1 f1_score : 0.6626323751891074
2021-12-06 23:21:42,363 INFO fold: 1 precision_score : 0.6616314199395771
2021-12-06 23:21:42,363 INFO fold: 1 recall_score : 0.6636363636363637
2021-12-06 23:21:42,364 INFO Predicting Test Probablities!
2021-12-06 23:21:42,370 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[23:21:42] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { colsample_bytree, early_stopping_rounds, max_depth, subsample, tree_method } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 23:21:51,670 INFO Training Finished!
2021-12-06 23:21:51,670 INFO Predicting Val Probablities!
2021-12-06 23:21:51,672 INFO Predicting Val Score!
2021-12-06 23:21:51,679 INFO fold: 2 roc_auc_score : 0.7962733720180528
2021-12-06 23:21:51,680 INFO fold: 2 log_loss : 0.5342360259930138
2021-12-06 23:21:51,680 INFO fold: 2 accuracy_score : 0.74125
2021-12-06 23:21:51,681 INFO fold: 2 f1_score : 0.6532663316582914
2021-12-06 23:21:51,682 INFO fold: 2 precision_score : 0.7303370786516854
2021-12-06 23:21:51,682 INFO fold: 2 recall_score : 0.5909090909090909
2021-12-06 23:21:51,683 INFO Predicting Test Probablities!
2021-12-06 23:21:51,688 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[23:21:51] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { colsample_bytree, early_stopping_rounds, max_depth, subsample, tree_method } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 23:22:01,036 INFO Training Finished!
2021-12-06 23:22:01,037 INFO Predicting Val Probablities!
2021-12-06 23:22:01,038 INFO Predicting Val Score!
/Users/pankajmathur/anaconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/metrics/_classification.py:2403: RuntimeWarning: divide by zero encountered in log
  loss = -(transformed_labels * np.log(y_pred)).sum(axis=1)
2021-12-06 23:22:01,047 INFO fold: 3 roc_auc_score : 0.7733784655061251
2021-12-06 23:22:01,048 INFO fold: 3 log_loss : inf
2021-12-06 23:22:01,048 INFO fold: 3 accuracy_score : 0.72
2021-12-06 23:22:01,049 INFO fold: 3 f1_score : 0.643312101910828
2021-12-06 23:22:01,049 INFO fold: 3 precision_score : 0.6778523489932886
2021-12-06 23:22:01,050 INFO fold: 3 recall_score : 0.6121212121212121
2021-12-06 23:22:01,050 INFO Predicting Test Probablities!
2021-12-06 23:22:01,056 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[23:22:01] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { colsample_bytree, early_stopping_rounds, max_depth, subsample, tree_method } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 23:22:09,796 INFO Training Finished!
2021-12-06 23:22:09,797 INFO Predicting Val Probablities!
2021-12-06 23:22:09,799 INFO Predicting Val Score!
2021-12-06 23:22:09,806 INFO fold: 4 roc_auc_score : 0.789911040395777
2021-12-06 23:22:09,807 INFO fold: 4 log_loss : 0.5406639995649312
2021-12-06 23:22:09,808 INFO fold: 4 accuracy_score : 0.7425
2021-12-06 23:22:09,808 INFO fold: 4 f1_score : 0.6644951140065146
2021-12-06 23:22:09,809 INFO fold: 4 precision_score : 0.7208480565371025
2021-12-06 23:22:09,810 INFO fold: 4 recall_score : 0.6163141993957704
2021-12-06 23:22:09,810 INFO Predicting Test Probablities!
2021-12-06 23:22:09,816 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[23:22:09] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { colsample_bytree, early_stopping_rounds, max_depth, subsample, tree_method } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 23:22:19,205 INFO Training Finished!
2021-12-06 23:22:19,205 INFO Predicting Val Probablities!
2021-12-06 23:22:19,207 INFO Predicting Val Score!
2021-12-06 23:22:19,215 INFO fold: 5 roc_auc_score : 0.7993287769181713
2021-12-06 23:22:19,215 INFO fold: 5 log_loss : 0.5347861251386348
2021-12-06 23:22:19,216 INFO fold: 5 accuracy_score : 0.73375
2021-12-06 23:22:19,216 INFO fold: 5 f1_score : 0.6490939044481056
2021-12-06 23:22:19,217 INFO fold: 5 precision_score : 0.7137681159420289
2021-12-06 23:22:19,217 INFO fold: 5 recall_score : 0.595166163141994
2021-12-06 23:22:19,218 INFO Predicting Test Probablities!
2021-12-06 23:22:19,224 INFO  Mean Metrics Results from all Folds are: {&#39;roc_auc_score&#39;: 0.7890162419927703, &#39;log_loss&#39;: inf, &#39;accuracy_score&#39;: 0.7317499999999999, &#39;f1_score&#39;: 0.6545599654425693, &#39;precision_score&#39;: 0.7008874040127365, &#39;recall_score&#39;: 0.6156294058408863}
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 5min 36s, sys: 6.25 s, total: 5min 43s
Wall time: 46.7 s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">xgb_model_test_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">xgb_model_test_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000,)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># final_preds = ((0.45 * sci_model_preds) + (0.55* xgb_model_test_preds)) / 2</span>
<span class="c1"># print(final_preds.shape)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Create-Kaggle-Predictions">Create Kaggle Predictions<a class="anchor-link" href="#Create-Kaggle-Predictions"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># sub[&#39;target&#39;] = final_preds</span>
<span class="c1"># sub.to_csv(&#39;submission.csv&#39;, index=False)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># # run the script to build </span>

<span class="c1"># from nbdev.export import notebook2script; notebook2script()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

