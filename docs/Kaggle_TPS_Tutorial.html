---

title: Getting Started Kaggle TPS Challenge with Tabular ML Toolkit


keywords: fastai
sidebar: home_sidebar

summary: "A Tutorial to showcase usage of tabular_ml_toolkit (tmlt) library on Kaggle TPS Challenge Nov 2021."
description: "A Tutorial to showcase usage of tabular_ml_toolkit (tmlt) library on Kaggle TPS Challenge Nov 2021."
nb_path: "13_Kaggle_TPS_Tutorial.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 13_Kaggle_TPS_Tutorial.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install">Install<a class="anchor-link" href="#Install"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>pip install -U tabular_ml_toolkit</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="How-to-Best-Use-tabular_ml_toolkit">How to Best Use tabular_ml_toolkit<a class="anchor-link" href="#How-to-Best-Use-tabular_ml_toolkit"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Start with your favorite model and then just simply create <strong>tmlt</strong> with one API.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>Here we are using XGBClassifier, on  <a href="https://www.kaggle.com/c/tabular-playground-series-nov-2021/data">Kaggle TPS Challenge (Nov 2021) data</a></em></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">tabular_ml_toolkit.tmlt</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/Users/pankajmathur/anaconda3/envs/nbdev_env/lib/python3.9/site-packages/redis/connection.py:77: UserWarning: redis-py works best with hiredis. Please consider installing
  warnings.warn(msg)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">accuracy_score</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DIRECTORY_PATH</span> <span class="o">=</span> <span class="s2">&quot;/Users/pankajmathur/kaggle_datasets/tps_nov_2021/&quot;</span>
<span class="n">TRAIN_FILE</span> <span class="o">=</span> <span class="s2">&quot;train.csv&quot;</span>
<span class="n">TEST_FILE</span> <span class="o">=</span> <span class="s2">&quot;test.csv&quot;</span>
<span class="n">SAMPLE_SUB_FILE</span> <span class="o">=</span> <span class="s2">&quot;sample_submission.csv&quot;</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="s2">&quot;kaggle_tps_output/&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Just-point-tmlt-in-the-direction-of-your-data">Just point tmlt in the direction of your data<a class="anchor-link" href="#Just-point-tmlt-in-the-direction-of-your-data"> </a></h4><h4 id="Let-it-know-what-are-idx-and-target-columns-in-your-tabular-data">Let it know what are idx and target columns in your tabular data<a class="anchor-link" href="#Let-it-know-what-are-idx-and-target-columns-in-your-tabular-data"> </a></h4><h4 id="what-kind-of-problem-type-you-are-trying-to-resolve?">what kind of problem type you are trying to resolve?<a class="anchor-link" href="#what-kind-of-problem-type-you-are-trying-to-resolve?"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmlt</span> <span class="o">=</span> <span class="n">TMLT</span><span class="p">()</span><span class="o">.</span><span class="n">prepare_data</span><span class="p">(</span>
    <span class="n">train_file_path</span><span class="o">=</span> <span class="n">DIRECTORY_PATH</span> <span class="o">+</span> <span class="n">TRAIN_FILE</span><span class="p">,</span>
    <span class="n">test_file_path</span><span class="o">=</span> <span class="n">DIRECTORY_PATH</span> <span class="o">+</span> <span class="n">TEST_FILE</span><span class="p">,</span>
    <span class="c1">#make sure to use right index and target columns</span>
    <span class="n">idx_col</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span>
    <span class="n">target</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
    <span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;binary_classification&quot;</span><span class="p">,</span>
    <span class="n">nrows</span><span class="o">=</span><span class="mi">4000</span>
<span class="p">)</span>


<span class="c1"># supports only task type</span>
<span class="c1"># &quot;binary_classification&quot;</span>
<span class="c1"># &quot;multi_label_classification&quot;</span>
<span class="c1"># &quot;multi_class_classification&quot;</span>
<span class="c1"># &quot;regression&quot;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-09 23:58:19,951 INFO 8 cores found, model and data parallel processing should worked!
2021-12-09 23:58:20,069 INFO DataFrame Memory usage decreased to 0.80 Mb (74.4% reduction)
2021-12-09 23:58:20,176 INFO DataFrame Memory usage decreased to 0.79 Mb (74.3% reduction)
2021-12-09 23:58:20,222 INFO PreProcessing will include target(s) encoding!
2021-12-09 23:58:20,222 INFO categorical columns are None, Preprocessing will done accordingly!
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
(4000, 100)
&lt;class &#39;numpy.ndarray&#39;&gt;
(4000,)
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
(4000, 100)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>f0</th>
      <th>f1</th>
      <th>f2</th>
      <th>f3</th>
      <th>f4</th>
      <th>f5</th>
      <th>f6</th>
      <th>f7</th>
      <th>f8</th>
      <th>f9</th>
      <th>...</th>
      <th>f90</th>
      <th>f91</th>
      <th>f92</th>
      <th>f93</th>
      <th>f94</th>
      <th>f95</th>
      <th>f96</th>
      <th>f97</th>
      <th>f98</th>
      <th>f99</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.106628</td>
      <td>3.593750</td>
      <td>132.750000</td>
      <td>3.183594</td>
      <td>0.081970</td>
      <td>1.188477</td>
      <td>3.732422</td>
      <td>2.265625</td>
      <td>2.099609</td>
      <td>0.012329</td>
      <td>...</td>
      <td>0.010742</td>
      <td>1.098633</td>
      <td>0.013329</td>
      <td>-0.011719</td>
      <td>0.052765</td>
      <td>0.065430</td>
      <td>4.210938</td>
      <td>1.978516</td>
      <td>0.085999</td>
      <td>0.240479</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.125000</td>
      <td>1.673828</td>
      <td>76.562500</td>
      <td>3.378906</td>
      <td>0.099426</td>
      <td>5.093750</td>
      <td>1.275391</td>
      <td>-0.471436</td>
      <td>4.546875</td>
      <td>0.037720</td>
      <td>...</td>
      <td>0.135864</td>
      <td>3.460938</td>
      <td>0.017059</td>
      <td>0.124878</td>
      <td>0.154053</td>
      <td>0.606934</td>
      <td>-0.267822</td>
      <td>2.578125</td>
      <td>-0.020874</td>
      <td>0.024719</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.036316</td>
      <td>1.497070</td>
      <td>233.500000</td>
      <td>2.195312</td>
      <td>0.026917</td>
      <td>3.126953</td>
      <td>5.058594</td>
      <td>3.849609</td>
      <td>1.801758</td>
      <td>0.057007</td>
      <td>...</td>
      <td>0.117310</td>
      <td>4.882812</td>
      <td>0.085205</td>
      <td>0.032410</td>
      <td>0.116089</td>
      <td>-0.001689</td>
      <td>-0.520020</td>
      <td>2.140625</td>
      <td>0.124451</td>
      <td>0.148193</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.014076</td>
      <td>0.245972</td>
      <td>780.000000</td>
      <td>1.890625</td>
      <td>0.006947</td>
      <td>1.531250</td>
      <td>2.697266</td>
      <td>4.515625</td>
      <td>4.503906</td>
      <td>0.123474</td>
      <td>...</td>
      <td>-0.015350</td>
      <td>3.474609</td>
      <td>-0.017105</td>
      <td>-0.008102</td>
      <td>0.062012</td>
      <td>0.041199</td>
      <td>0.511719</td>
      <td>1.968750</td>
      <td>0.040009</td>
      <td>0.044861</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.003260</td>
      <td>3.714844</td>
      <td>156.125000</td>
      <td>2.148438</td>
      <td>0.018280</td>
      <td>2.097656</td>
      <td>4.156250</td>
      <td>-0.038239</td>
      <td>3.371094</td>
      <td>0.034180</td>
      <td>...</td>
      <td>0.013779</td>
      <td>1.910156</td>
      <td>-0.042938</td>
      <td>0.105591</td>
      <td>0.125122</td>
      <td>0.037506</td>
      <td>1.043945</td>
      <td>1.075195</td>
      <td>-0.012817</td>
      <td>0.072815</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3995</th>
      <td>0.242188</td>
      <td>2.324219</td>
      <td>-19.109375</td>
      <td>0.984375</td>
      <td>0.036438</td>
      <td>0.424561</td>
      <td>2.269531</td>
      <td>3.621094</td>
      <td>4.062500</td>
      <td>1.197266</td>
      <td>...</td>
      <td>-0.002506</td>
      <td>3.064453</td>
      <td>0.112427</td>
      <td>0.100220</td>
      <td>0.036530</td>
      <td>0.451172</td>
      <td>1.316406</td>
      <td>4.625000</td>
      <td>0.056183</td>
      <td>0.029724</td>
    </tr>
    <tr>
      <th>3996</th>
      <td>0.138306</td>
      <td>0.679199</td>
      <td>37.125000</td>
      <td>2.736328</td>
      <td>-0.043549</td>
      <td>0.514648</td>
      <td>4.542969</td>
      <td>3.132812</td>
      <td>4.972656</td>
      <td>0.097961</td>
      <td>...</td>
      <td>0.060730</td>
      <td>4.125000</td>
      <td>-0.031433</td>
      <td>0.059143</td>
      <td>0.164673</td>
      <td>0.058075</td>
      <td>-0.237427</td>
      <td>2.123047</td>
      <td>-0.049316</td>
      <td>0.050842</td>
    </tr>
    <tr>
      <th>3997</th>
      <td>0.025436</td>
      <td>1.316406</td>
      <td>250.375000</td>
      <td>3.689453</td>
      <td>0.015312</td>
      <td>2.490234</td>
      <td>1.983398</td>
      <td>3.556641</td>
      <td>4.164062</td>
      <td>0.156860</td>
      <td>...</td>
      <td>0.038269</td>
      <td>4.667969</td>
      <td>0.157593</td>
      <td>0.102234</td>
      <td>1.055664</td>
      <td>0.031769</td>
      <td>1.661133</td>
      <td>1.484375</td>
      <td>-0.027924</td>
      <td>0.098083</td>
    </tr>
    <tr>
      <th>3998</th>
      <td>0.109253</td>
      <td>2.169922</td>
      <td>123.062500</td>
      <td>3.279297</td>
      <td>0.018204</td>
      <td>3.630859</td>
      <td>4.636719</td>
      <td>4.507812</td>
      <td>3.585938</td>
      <td>0.037140</td>
      <td>...</td>
      <td>0.083191</td>
      <td>3.623047</td>
      <td>0.108765</td>
      <td>0.111877</td>
      <td>0.020645</td>
      <td>0.125122</td>
      <td>2.648438</td>
      <td>2.753906</td>
      <td>0.012726</td>
      <td>0.035583</td>
    </tr>
    <tr>
      <th>3999</th>
      <td>-0.032227</td>
      <td>1.616211</td>
      <td>171.875000</td>
      <td>3.207031</td>
      <td>-0.008675</td>
      <td>2.208984</td>
      <td>4.097656</td>
      <td>1.391602</td>
      <td>2.486328</td>
      <td>0.121643</td>
      <td>...</td>
      <td>0.074463</td>
      <td>0.529785</td>
      <td>0.002768</td>
      <td>0.098877</td>
      <td>0.148682</td>
      <td>0.056061</td>
      <td>4.210938</td>
      <td>0.759766</td>
      <td>0.063538</td>
      <td>0.097046</td>
    </tr>
  </tbody>
</table>
<p>4000 rows Ã— 100 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Training">Training<a class="anchor-link" href="#Training"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="create-train-valid-dataframes-for-quick-preprocessing-and-training">create train valid dataframes for quick preprocessing and training<a class="anchor-link" href="#create-train-valid-dataframes-for-quick-preprocessing-and-training"> </a></h5>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1"># create train, valid split to evaulate model on valid dataset</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_valid</span><span class="p">,</span>  <span class="n">y_train</span><span class="p">,</span> <span class="n">y_valid</span> <span class="o">=</span>  <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">create_train_valid</span><span class="p">(</span><span class="n">valid_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 6.41 ms, sys: 1.83 ms, total: 8.24 ms
Wall time: 6.76 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_valid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_valid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># print(X_train.columns.to_list())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(3200, 100)
(3200,)
(800, 100)
(800,)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Now-PreProcess-X_train,-X_valid">Now PreProcess X_train, X_valid<a class="anchor-link" href="#Now-PreProcess-X_train,-X_valid"> </a></h5><p>NOTE: Preprocessing gives back numpy arrays for pandas dataframe</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">X_train_np</span><span class="p">,</span>  <span class="n">X_valid_np</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">pp_fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_valid</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">X_train_np</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_train_np</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1"># print(X_train_np)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">X_valid_np</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_valid_np</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1"># print(X_valid_np)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">y_valid</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">y_train</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;numpy.ndarray&#39;&gt;
(3200, 100)
&lt;class &#39;numpy.ndarray&#39;&gt;
(800, 100)
&lt;class &#39;numpy.ndarray&#39;&gt;
&lt;class &#39;numpy.ndarray&#39;&gt;
CPU times: user 24.3 ms, sys: 1.62 ms, total: 25.9 ms
Wall time: 24.7 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Create-a-base-xgb-classifier-model-with-your-best-guess-params">Create a base xgb classifier model with your best guess params<a class="anchor-link" href="#Create-a-base-xgb-classifier-model-with-your-best-guess-params"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xgb_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># your best guess params</span>
    <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="s1">&#39;eval_metric&#39;</span><span class="p">:</span><span class="s1">&#39;auc&#39;</span><span class="p">,</span>
    <span class="c1"># must for xgb classifier otherwise warning will be shown</span>
    <span class="s1">&#39;use_label_encoder&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
    <span class="c1"># because 42 is the answer for all the randomness of this universe</span>
    <span class="s1">&#39;random_state&#39;</span><span class="p">:</span><span class="mi">42</span><span class="p">,</span>
    <span class="c1">#for GPU</span>
    <span class="c1">#&#39;tree_method&#39;: &#39;gpu_hist&#39;,</span>
    <span class="c1">#&#39;predictor&#39;: &#39;gpu_predictor&#39;,</span>
<span class="p">}</span>

<span class="n">xgb_model</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="o">**</span><span class="n">xgb_params</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1"># Now do model training</span>
<span class="n">xgb_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_np</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
              <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="c1">#detect &amp; avoid overfitting</span>
              <span class="n">eval_set</span><span class="o">=</span><span class="p">[(</span><span class="n">X_train_np</span><span class="p">,</span> <span class="n">y_train</span><span class="p">),</span> <span class="p">(</span><span class="n">X_valid_np</span><span class="p">,</span> <span class="n">y_valid</span><span class="p">)],</span>
              <span class="n">eval_metric</span><span class="o">=</span><span class="s2">&quot;auc&quot;</span><span class="p">,</span>
              <span class="n">early_stopping_rounds</span><span class="o">=</span><span class="mi">300</span>
             <span class="p">)</span>

<span class="c1">#predict</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">xgb_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_valid_np</span><span class="p">)</span>
<span class="n">preds_probs</span> <span class="o">=</span> <span class="n">xgb_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_valid_np</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="c1"># Metrics</span>
<span class="n">auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds_probs</span><span class="p">)</span>
<span class="n">acc</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AUC is : </span><span class="si">{</span><span class="n">auc</span><span class="si">}</span><span class="s2"> while Accuracy is : </span><span class="si">{</span><span class="n">acc</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>AUC is : 0.6142302819132088 while Accuracy is : 0.6175 
CPU times: user 10.6 s, sys: 123 ms, total: 10.8 s
Wall time: 1.51 s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="For-Meta-Ensemble-Models-Training">For Meta Ensemble Models Training<a class="anchor-link" href="#For-Meta-Ensemble-Models-Training"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Make-sure-to-PreProcess-the-data">Make sure to PreProcess the data<a class="anchor-link" href="#Make-sure-to-PreProcess-the-data"> </a></h5>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">X_np</span><span class="p">,</span> <span class="n">X_test_np</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">pp_fit_transform</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_np</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 270 ms, sys: 23.6 ms, total: 293 ms
Wall time: 46.9 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Base-Model-1:-linear-SVM-model">Base Model 1: linear SVM model<a class="anchor-link" href="#Base-Model-1:-linear-SVM-model"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">LinearSVC</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>

<span class="c1"># OOF training and prediction on both train and test dataset by a given model</span>
<span class="c1">#choose model</span>
<span class="n">linear_oof_model</span> <span class="o">=</span> <span class="n">LinearSVC</span><span class="p">(</span><span class="n">tol</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">,</span> <span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span> <span class="n">dual</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1">#fit and predict</span>
<span class="n">linear_oof_model_preds</span><span class="p">,</span> <span class="n">linear_oof_model_test_preds</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">do_oof_kfold_train_preds</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                                                                    <span class="n">oof_model</span><span class="o">=</span><span class="n">linear_oof_model</span><span class="p">,</span>
                                                                                    <span class="n">X</span> <span class="o">=</span> <span class="n">X_np</span><span class="p">,</span>
                                                                                    <span class="n">y</span> <span class="o">=</span> <span class="n">y_np</span><span class="p">,</span>
                                                                                    <span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test_np</span><span class="p">)</span>

<span class="k">if</span> <span class="n">linear_oof_model_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">linear_oof_model_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="k">if</span> <span class="n">linear_oof_model_test_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>    
    <span class="nb">print</span><span class="p">(</span><span class="n">linear_oof_model_test_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-09 23:58:25,808 INFO Training Started!
2021-12-09 23:58:25,840 INFO Training Finished!
2021-12-09 23:58:25,844 INFO fold: 1 OOF Model ROC AUC: 0.7257962604771115!
2021-12-09 23:58:25,848 INFO Training Started!
2021-12-09 23:58:25,881 INFO Training Finished!
2021-12-09 23:58:25,884 INFO fold: 2 OOF Model ROC AUC: 0.6957833655705996!
2021-12-09 23:58:25,890 INFO Training Started!
2021-12-09 23:58:25,920 INFO Training Finished!
2021-12-09 23:58:25,923 INFO fold: 3 OOF Model ROC AUC: 0.6616956802063185!
2021-12-09 23:58:25,928 INFO Training Started!
2021-12-09 23:58:25,963 INFO Training Finished!
2021-12-09 23:58:25,965 INFO fold: 4 OOF Model ROC AUC: 0.7076379002699064!
2021-12-09 23:58:25,969 INFO Training Started!
2021-12-09 23:58:25,994 INFO Training Finished!
2021-12-09 23:58:25,996 INFO fold: 5 OOF Model ROC AUC: 0.7227243154104317!
2021-12-09 23:58:26,000 INFO Mean OOF Model ROC AUC: 0.7027275043868735!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000,)
(4000,)
CPU times: user 501 ms, sys: 114 ms, total: 615 ms
Wall time: 194 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Base-Model-2:-Logistic-Regression-Model">Base Model 2: Logistic Regression Model<a class="anchor-link" href="#Base-Model-2:-Logistic-Regression-Model"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>

<span class="c1"># OOF training and prediction on both train and test dataset by a given model</span>

<span class="c1">#choose model</span>
<span class="n">log_oof_model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1">#fit and predict</span>
<span class="n">log_oof_model_preds</span><span class="p">,</span> <span class="n">log_oof_model_test_preds</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">do_oof_kfold_train_preds</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                                                                    <span class="n">oof_model</span><span class="o">=</span><span class="n">log_oof_model</span><span class="p">,</span>
                                                                                    <span class="n">X</span> <span class="o">=</span> <span class="n">X_np</span><span class="p">,</span>
                                                                                    <span class="n">y</span> <span class="o">=</span> <span class="n">y_np</span><span class="p">,</span>
                                                                                    <span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test_np</span><span class="p">)</span>
<span class="k">if</span> <span class="n">log_oof_model_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">log_oof_model_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="k">if</span> <span class="n">log_oof_model_test_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>    
    <span class="nb">print</span><span class="p">(</span><span class="n">log_oof_model_test_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-09 23:58:27,128 INFO Training Started!
2021-12-09 23:58:27,157 INFO Training Finished!
2021-12-09 23:58:27,160 INFO fold: 1 OOF Model ROC AUC: 0.7271695680206318!
2021-12-09 23:58:27,165 INFO Training Started!
2021-12-09 23:58:27,196 INFO Training Finished!
2021-12-09 23:58:27,199 INFO fold: 2 OOF Model ROC AUC: 0.694622823984526!
2021-12-09 23:58:27,204 INFO Training Started!
2021-12-09 23:58:27,233 INFO Training Finished!
2021-12-09 23:58:27,236 INFO fold: 3 OOF Model ROC AUC: 0.662114764667956!
2021-12-09 23:58:27,241 INFO Training Started!
2021-12-09 23:58:27,264 INFO Training Finished!
2021-12-09 23:58:27,267 INFO fold: 4 OOF Model ROC AUC: 0.7080501678057705!
2021-12-09 23:58:27,271 INFO Training Started!
2021-12-09 23:58:27,298 INFO Training Finished!
2021-12-09 23:58:27,301 INFO fold: 5 OOF Model ROC AUC: 0.7226276902067136!
2021-12-09 23:58:27,304 INFO Mean OOF Model ROC AUC: 0.7029170029371196!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000,)
(4000,)
CPU times: user 469 ms, sys: 102 ms, total: 571 ms
Wall time: 179 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Base-Model-3:-SKLearn-MLP">Base Model 3: SKLearn MLP<a class="anchor-link" href="#Base-Model-3:-SKLearn-MLP"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.neural_network</span> <span class="kn">import</span> <span class="n">MLPClassifier</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>

<span class="c1"># OOF training and prediction on both train and test dataset by a given model</span>

<span class="c1">#choose model</span>
<span class="n">mlp_oof_model</span> <span class="o">=</span> <span class="n">MLPClassifier</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">early_stopping</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#update the model on sklearn pipeline</span>
<span class="c1"># tmlt = tmlt.update_model(mlp_oof_model)</span>

<span class="c1"># # lets see updated sklearn pipeline with new model</span>
<span class="c1"># tmlt.spl</span>

<span class="c1">#fit and predict</span>
<span class="n">mlp_oof_model_preds</span><span class="p">,</span> <span class="n">mlp_oof_model_test_preds</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">do_oof_kfold_train_preds</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                                                                    <span class="n">oof_model</span><span class="o">=</span><span class="n">mlp_oof_model</span><span class="p">,</span>
                                                                                    <span class="n">X</span> <span class="o">=</span> <span class="n">X_np</span><span class="p">,</span>
                                                                                    <span class="n">y</span> <span class="o">=</span> <span class="n">y_np</span><span class="p">,</span>
                                                                                    <span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test_np</span><span class="p">)</span>
<span class="k">if</span> <span class="n">mlp_oof_model_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">mlp_oof_model_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="k">if</span> <span class="n">mlp_oof_model_test_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>    
    <span class="nb">print</span><span class="p">(</span><span class="n">mlp_oof_model_test_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-09 23:58:30,843 INFO Training Started!
2021-12-09 23:58:31,114 INFO Training Finished!
2021-12-09 23:58:31,118 INFO fold: 1 OOF Model ROC AUC: 0.7148613797549968!
2021-12-09 23:58:31,127 INFO Training Started!
2021-12-09 23:58:31,448 INFO Training Finished!
2021-12-09 23:58:31,452 INFO fold: 2 OOF Model ROC AUC: 0.6774081237911025!
2021-12-09 23:58:31,460 INFO Training Started!
2021-12-09 23:58:31,653 INFO Training Finished!
2021-12-09 23:58:31,656 INFO fold: 3 OOF Model ROC AUC: 0.6363958736299162!
2021-12-09 23:58:31,665 INFO Training Started!
2021-12-09 23:58:31,868 INFO Training Finished!
2021-12-09 23:58:31,871 INFO fold: 4 OOF Model ROC AUC: 0.6835524578230986!
2021-12-09 23:58:31,880 INFO Training Started!
2021-12-09 23:58:32,085 INFO Training Finished!
2021-12-09 23:58:32,088 INFO fold: 5 OOF Model ROC AUC: 0.6923646764021928!
2021-12-09 23:58:32,097 INFO Mean OOF Model ROC AUC: 0.6809165022802615!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000,)
(4000,)
CPU times: user 4.09 s, sys: 708 ms, total: 4.8 s
Wall time: 1.26 s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Base-Model-4:-TabNet">Base Model 4: TabNet<a class="anchor-link" href="#Base-Model-4:-TabNet"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pytorch_tabnet.tab_model</span> <span class="kn">import</span> <span class="n">TabNetClassifier</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>

<span class="c1"># OOF training and prediction on both train and test dataset by a given model</span>

<span class="c1">#choose model</span>
<span class="n">tabnet_oof_model</span> <span class="o">=</span> <span class="n">TabNetClassifier</span><span class="p">(</span><span class="n">optimizer_params</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">lr</span><span class="o">=</span><span class="mf">0.02</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1">#fit and predict</span>
<span class="n">tabnet_oof_model_preds</span><span class="p">,</span> <span class="n">tabnet_oof_model_test_preds</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">do_oof_kfold_train_preds</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                                                                    <span class="n">oof_model</span><span class="o">=</span><span class="n">tabnet_oof_model</span><span class="p">,</span>
                                                                                    <span class="n">X</span> <span class="o">=</span> <span class="n">X_np</span><span class="p">,</span>
                                                                                    <span class="n">y</span> <span class="o">=</span> <span class="n">y_np</span><span class="p">,</span>
                                                                                    <span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test_np</span><span class="p">)</span>

<span class="k">if</span> <span class="n">tabnet_oof_model_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">tabnet_oof_model_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="k">if</span> <span class="n">tabnet_oof_model_test_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">tabnet_oof_model_test_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-09 23:58:34,242 INFO Training Started!
2021-12-09 23:58:42,305 INFO Training Finished!
2021-12-09 23:58:42,335 INFO fold: 1 OOF Model ROC AUC: 0.558401031592521!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Stop training because you reached max_epochs = 50 with best_epoch = 44 and best_val_0_auc = 0.5584
Best weights from best epoch are automatically used!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-09 23:58:42,448 INFO Training Started!
2021-12-09 23:58:44,406 INFO Training Finished!
2021-12-09 23:58:44,437 INFO fold: 2 OOF Model ROC AUC: 0.6584655061250806!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
Early stopping occurred at epoch 11 with best_epoch = 1 and best_val_0_auc = 0.65847
Best weights from best epoch are automatically used!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-09 23:58:44,547 INFO Training Started!
2021-12-09 23:58:46,455 INFO Training Finished!
2021-12-09 23:58:46,487 INFO fold: 3 OOF Model ROC AUC: 0.6677756286266925!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
Early stopping occurred at epoch 10 with best_epoch = 0 and best_val_0_auc = 0.66778
Best weights from best epoch are automatically used!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-09 23:58:46,604 INFO Training Started!
2021-12-09 23:58:48,428 INFO Training Finished!
2021-12-09 23:58:48,458 INFO fold: 4 OOF Model ROC AUC: 0.6324828168179388!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
Early stopping occurred at epoch 10 with best_epoch = 0 and best_val_0_auc = 0.63248
Best weights from best epoch are automatically used!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-09 23:58:48,572 INFO Training Started!
2021-12-09 23:58:50,446 INFO Training Finished!
2021-12-09 23:58:50,477 INFO fold: 5 OOF Model ROC AUC: 0.6354975231739447!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
Early stopping occurred at epoch 10 with best_epoch = 0 and best_val_0_auc = 0.6355
Best weights from best epoch are automatically used!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-09 23:58:50,592 INFO Mean OOF Model ROC AUC: 0.6305245012672356!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000,)
(4000,)
CPU times: user 17.5 s, sys: 5.88 s, total: 23.4 s
Wall time: 16.4 s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Now-add-back-based-models-predictions-to-X-and-X_test">Now add back based models predictions to X and X_test<a class="anchor-link" href="#Now-add-back-based-models-predictions-to-X-and-X_test"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;linear_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linear_oof_model_preds</span>
<span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;linear_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linear_oof_model_test_preds</span>

<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000, 101)
(4000, 101)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;log_reg_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_oof_model_preds</span>
<span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;log_reg_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_oof_model_test_preds</span>

<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000, 102)
(4000, 102)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;mlp_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mlp_oof_model_preds</span>
<span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;mlp_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mlp_oof_model_test_preds</span>

<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000, 103)
(4000, 103)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;tabnet_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tabnet_oof_model_preds</span>
<span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;tabnet_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tabnet_oof_model_test_preds</span>

<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000, 104)
(4000, 104)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmlt</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">update_dfl</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">X_test</span><span class="o">=</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-09 23:59:07,293 INFO categorical columns are None, Preprocessing will done accordingly!
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="For-META-Model-Training">For META Model Training<a class="anchor-link" href="#For-META-Model-Training"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="create-train-valid-dataframes-for-quick-preprocessing-and-training">create train valid dataframes for quick preprocessing and training<a class="anchor-link" href="#create-train-valid-dataframes-for-quick-preprocessing-and-training"> </a></h5>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1"># create train, valid split to evaulate model on valid dataset</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_valid</span><span class="p">,</span>  <span class="n">y_train</span><span class="p">,</span> <span class="n">y_valid</span> <span class="o">=</span>  <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">create_train_valid</span><span class="p">(</span><span class="n">valid_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_valid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_valid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># print(X_train.columns.to_list())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(3200, 104)
(3200,)
(800, 104)
(800,)
CPU times: user 7.03 ms, sys: 1.77 ms, total: 8.81 ms
Wall time: 7.15 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Now-PreProcess-X_train,-X_valid">Now PreProcess X_train, X_valid<a class="anchor-link" href="#Now-PreProcess-X_train,-X_valid"> </a></h5><p>NOTE: Preprocessing gives back numpy arrays for pandas dataframe</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">X_train_np</span><span class="p">,</span>  <span class="n">X_valid_np</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">pp_fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_valid</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">X_train_np</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_train_np</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1"># print(X_train_np)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">X_valid_np</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_valid_np</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1"># print(X_valid_np)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">y_valid</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">y_train</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;numpy.ndarray&#39;&gt;
(3200, 104)
&lt;class &#39;numpy.ndarray&#39;&gt;
(800, 104)
&lt;class &#39;numpy.ndarray&#39;&gt;
&lt;class &#39;numpy.ndarray&#39;&gt;
CPU times: user 47.8 ms, sys: 4.4 ms, total: 52.2 ms
Wall time: 50.6 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#     &#39;objective&#39;: &#39;binary:logistic&#39;, </span>
<span class="c1">#     &#39;use_label_encoder&#39;: False,</span>
<span class="c1">#     &#39;n_estimators&#39;: 40000,</span>
<span class="c1">#     &#39;learning_rate&#39;: 0.18515462875481553,</span>
<span class="c1">#     &#39;subsample&#39;: 0.97, </span>
<span class="c1">#     &#39;colsample_bytree&#39;: 0.32,</span>
<span class="c1">#     &#39;max_depth&#39;: 1,</span>
<span class="c1">#     &#39;booster&#39;: &#39;gbtree&#39;,</span>
<span class="c1">#     &#39;gamma&#39;: 0.2, </span>
<span class="c1">#     &#39;tree_method&#39;: &#39;gpu_hist&#39;,</span>
<span class="c1">#     &#39;reg_lambda&#39;: 0.11729916523488974, </span>
<span class="c1">#     &#39;reg_alpha&#39;: 0.6318827156945853,</span>
<span class="c1">#     &#39;random_state&#39;: 42,</span>
<span class="c1">#     &#39;n_jobs&#39;: 4, </span>
<span class="c1">#     &#39;min_child_weight&#39;: 256,</span>
<span class="c1">#     #for GPU</span>
<span class="c1"># #     &#39;tree_method&#39;: &#39;gpu_hist&#39;,</span>
<span class="c1"># #     &#39;predictor&#39;: &#39;gpu_predictor&#39;,</span>
<span class="c1">#     }</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xgb_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="mf">0.21761562020600114</span><span class="p">,</span>
    <span class="s1">&#39;eval_metric&#39;</span><span class="p">:</span> <span class="s1">&#39;auc&#39;</span><span class="p">,</span>
    <span class="s1">&#39;use_label_encoder&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
    <span class="s1">&#39;booster&#39;</span><span class="p">:</span> <span class="s1">&#39;gblinear&#39;</span><span class="p">,</span>
    <span class="s1">&#39;colsample_bytree&#39;</span><span class="p">:</span> <span class="mf">0.1027132584989078</span><span class="p">,</span>
    <span class="s1">&#39;early_stopping_rounds&#39;</span><span class="p">:</span> <span class="mi">171</span><span class="p">,</span>
    <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">7000</span><span class="p">,</span>
    <span class="s1">&#39;reg_alpha&#39;</span><span class="p">:</span> <span class="mf">9.583579660175245e-06</span><span class="p">,</span>
    <span class="s1">&#39;reg_lambda&#39;</span><span class="p">:</span> <span class="mf">9.238315962782784e-05</span><span class="p">,</span>
    <span class="s1">&#39;subsample&#39;</span><span class="p">:</span> <span class="mf">0.4464473710560276</span><span class="p">,</span>
    <span class="s1">&#39;tree_method&#39;</span><span class="p">:</span> <span class="s1">&#39;approx&#39;</span><span class="p">,</span>
    <span class="c1">#for GPU</span>
<span class="c1">#     &#39;tree_method&#39;: &#39;gpu_hist&#39;,</span>
<span class="c1">#     &#39;predictor&#39;: &#39;gpu_predictor&#39;,</span>
<span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1"># Now do model training</span>
<span class="n">xgb_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_np</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
              <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="c1">#detect &amp; avoid overfitting</span>
              <span class="n">eval_set</span><span class="o">=</span><span class="p">[(</span><span class="n">X_train_np</span><span class="p">,</span> <span class="n">y_train</span><span class="p">),</span> <span class="p">(</span><span class="n">X_valid_np</span><span class="p">,</span> <span class="n">y_valid</span><span class="p">)],</span>
              <span class="n">eval_metric</span><span class="o">=</span><span class="s2">&quot;auc&quot;</span><span class="p">,</span>
              <span class="n">early_stopping_rounds</span><span class="o">=</span><span class="mi">300</span>
             <span class="p">)</span>

<span class="c1">#predict</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">xgb_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_valid_np</span><span class="p">)</span>
<span class="n">preds_probs</span> <span class="o">=</span> <span class="n">xgb_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_valid_np</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="c1"># Metrics</span>
<span class="n">auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds_probs</span><span class="p">)</span>
<span class="n">acc</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AUC is : </span><span class="si">{</span><span class="n">auc</span><span class="si">}</span><span class="s2"> while Accuracy is : </span><span class="si">{</span><span class="n">acc</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>AUC is : 0.6933467954809418 while Accuracy is : 0.67625 
CPU times: user 10.9 s, sys: 95.7 ms, total: 11 s
Wall time: 1.48 s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="WOW!!!!">WOW!!!!<a class="anchor-link" href="#WOW!!!!"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="For-Meta-Model,-Let's-do-Optuna-based-HyperParameter-search-to-get-best-params-for-fit">For Meta Model, Let's do Optuna based HyperParameter search to get best params for fit<a class="anchor-link" href="#For-Meta-Model,-Let's-do-Optuna-based-HyperParameter-search-to-get-best-params-for-fit"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">study</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">do_xgb_optuna_optimization</span><span class="p">(</span><span class="n">optuna_db_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">,</span> <span class="n">opt_timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">study</span><span class="o">.</span><span class="n">best_trial</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-09 23:59:37,980 INFO Optimization Direction is: maximize
<span class="ansi-green-fg">[I 2021-12-09 23:59:38,032]</span> Using an existing study with name &#39;tmlt_autoxgb&#39; instead of creating a new one.
2021-12-09 23:59:38,210 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[23:59:38] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { colsample_bytree, early_stopping_rounds, eval_set, max_depth, subsample, tree_method } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-09 23:59:47,028 INFO Training Ended!
2021-12-09 23:59:47,033 INFO roc_auc_score: 0.7741592756836658
2021-12-09 23:59:47,034 INFO accuracy_score: 0.72625
<span class="ansi-green-fg">[I 2021-12-09 23:59:47,072]</span> Trial 38 finished with value: 0.7741592756836658 and parameters: {&#39;learning_rate&#39;: 0.07948707900984789, &#39;n_estimators&#39;: 15000, &#39;reg_lambda&#39;: 7.984356925605064e-06, &#39;reg_alpha&#39;: 2.5216595944303144e-06, &#39;subsample&#39;: 0.9949361731336916, &#39;colsample_bytree&#39;: 0.30017155189532796, &#39;max_depth&#39;: 5, &#39;early_stopping_rounds&#39;: 268, &#39;tree_method&#39;: &#39;approx&#39;, &#39;booster&#39;: &#39;gblinear&#39;}. Best is trial 38 with value: 0.7741592756836658.
2021-12-09 23:59:47,269 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[23:59:47] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { early_stopping_rounds, eval_set } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-10 00:00:17,929 INFO Training Ended!
2021-12-10 00:00:17,953 INFO roc_auc_score: 0.6579558652729384
2021-12-10 00:00:17,954 INFO accuracy_score: 0.65375
<span class="ansi-green-fg">[I 2021-12-10 00:00:17,995]</span> Trial 39 finished with value: 0.6579558652729384 and parameters: {&#39;learning_rate&#39;: 0.08007436447328488, &#39;n_estimators&#39;: 15000, &#39;reg_lambda&#39;: 5.254743398476762e-06, &#39;reg_alpha&#39;: 6.9699386536621e-08, &#39;subsample&#39;: 0.9322044962669489, &#39;colsample_bytree&#39;: 0.5785734419018447, &#39;max_depth&#39;: 5, &#39;early_stopping_rounds&#39;: 333, &#39;tree_method&#39;: &#39;hist&#39;, &#39;booster&#39;: &#39;gbtree&#39;, &#39;gamma&#39;: 0.034707793715938046, &#39;grow_policy&#39;: &#39;depthwise&#39;}. Best is trial 38 with value: 0.7741592756836658.
2021-12-10 00:00:18,141 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[00:00:18] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { colsample_bytree, early_stopping_rounds, eval_set, max_depth, subsample, tree_method } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-10 00:00:27,180 INFO Training Ended!
2021-12-10 00:00:27,185 INFO roc_auc_score: 0.7741064829479463
2021-12-10 00:00:27,186 INFO accuracy_score: 0.72625
<span class="ansi-green-fg">[I 2021-12-10 00:00:27,209]</span> Trial 40 finished with value: 0.7741064829479463 and parameters: {&#39;learning_rate&#39;: 0.03198809904064819, &#39;n_estimators&#39;: 15000, &#39;reg_lambda&#39;: 1.7499374468232044e-07, &#39;reg_alpha&#39;: 2.6296423826705236e-06, &#39;subsample&#39;: 0.8688234611344541, &#39;colsample_bytree&#39;: 0.32645970885560793, &#39;max_depth&#39;: 5, &#39;early_stopping_rounds&#39;: 219, &#39;tree_method&#39;: &#39;approx&#39;, &#39;booster&#39;: &#39;gblinear&#39;}. Best is trial 38 with value: 0.7741592756836658.
2021-12-10 00:00:27,385 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[00:00:27] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { colsample_bytree, early_stopping_rounds, eval_set, max_depth, subsample, tree_method } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-10 00:00:37,591 INFO Training Ended!
2021-12-10 00:00:37,596 INFO roc_auc_score: 0.7740338929363321
2021-12-10 00:00:37,596 INFO accuracy_score: 0.72625
<span class="ansi-green-fg">[I 2021-12-10 00:00:37,618]</span> Trial 41 finished with value: 0.7740338929363321 and parameters: {&#39;learning_rate&#39;: 0.028897229702683155, &#39;n_estimators&#39;: 15000, &#39;reg_lambda&#39;: 1.1888881323452074e-07, &#39;reg_alpha&#39;: 2.6601366349662993e-06, &#39;subsample&#39;: 0.9680189654657809, &#39;colsample_bytree&#39;: 0.32353956611499696, &#39;max_depth&#39;: 5, &#39;early_stopping_rounds&#39;: 220, &#39;tree_method&#39;: &#39;approx&#39;, &#39;booster&#39;: &#39;gblinear&#39;}. Best is trial 38 with value: 0.7741592756836658.
2021-12-10 00:00:37,778 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[00:00:37] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { colsample_bytree, early_stopping_rounds, eval_set, max_depth, subsample, tree_method } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-10 00:00:47,908 INFO Training Ended!
2021-12-10 00:00:47,912 INFO roc_auc_score: 0.7739876992925773
2021-12-10 00:00:47,912 INFO accuracy_score: 0.72625
<span class="ansi-green-fg">[I 2021-12-10 00:00:47,937]</span> Trial 42 finished with value: 0.7739876992925773 and parameters: {&#39;learning_rate&#39;: 0.025719759580870857, &#39;n_estimators&#39;: 15000, &#39;reg_lambda&#39;: 4.475205533321173e-08, &#39;reg_alpha&#39;: 1.8902434023049325e-06, &#39;subsample&#39;: 0.9801702965579114, &#39;colsample_bytree&#39;: 0.2874747934370655, &#39;max_depth&#39;: 5, &#39;early_stopping_rounds&#39;: 216, &#39;tree_method&#39;: &#39;approx&#39;, &#39;booster&#39;: &#39;gblinear&#39;}. Best is trial 38 with value: 0.7741592756836658.
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>FrozenTrial(number=38, values=[0.7741592756836658], datetime_start=datetime.datetime(2021, 12, 9, 23, 59, 38, 76564), datetime_complete=datetime.datetime(2021, 12, 9, 23, 59, 47, 35226), params={&#39;booster&#39;: &#39;gblinear&#39;, &#39;colsample_bytree&#39;: 0.30017155189532796, &#39;early_stopping_rounds&#39;: 268, &#39;learning_rate&#39;: 0.07948707900984789, &#39;max_depth&#39;: 5, &#39;n_estimators&#39;: 15000, &#39;reg_alpha&#39;: 2.5216595944303144e-06, &#39;reg_lambda&#39;: 7.984356925605064e-06, &#39;subsample&#39;: 0.9949361731336916, &#39;tree_method&#39;: &#39;approx&#39;}, distributions={&#39;booster&#39;: CategoricalDistribution(choices=(&#39;gbtree&#39;, &#39;gblinear&#39;)), &#39;colsample_bytree&#39;: UniformDistribution(high=1.0, low=0.1), &#39;early_stopping_rounds&#39;: IntUniformDistribution(high=500, low=100, step=1), &#39;learning_rate&#39;: LogUniformDistribution(high=0.25, low=0.01), &#39;max_depth&#39;: IntUniformDistribution(high=9, low=1, step=1), &#39;n_estimators&#39;: CategoricalDistribution(choices=(7000, 15000, 20000)), &#39;reg_alpha&#39;: LogUniformDistribution(high=100.0, low=1e-08), &#39;reg_lambda&#39;: LogUniformDistribution(high=100.0, low=1e-08), &#39;subsample&#39;: UniformDistribution(high=1.0, low=0.1), &#39;tree_method&#39;: CategoricalDistribution(choices=(&#39;exact&#39;, &#39;approx&#39;, &#39;hist&#39;))}, user_attrs={}, system_attrs={}, intermediate_values={}, trial_id=39, state=TrialState.COMPLETE, value=None)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="now-update-the-meta-model-with-best-params-from-study-and-then-update-the-sklearn-pipeline-with-this-new-model">now update the meta model with best params from study and then update the sklearn pipeline with this new model<a class="anchor-link" href="#now-update-the-meta-model-with-best-params-from-study-and-then-update-the-sklearn-pipeline-with-this-new-model"> </a></h5>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xgb_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">study</span><span class="o">.</span><span class="n">best_trial</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;xgb_params&quot;</span><span class="p">,</span> <span class="n">xgb_params</span><span class="p">)</span>
<span class="n">updated_xgb_model</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="o">**</span><span class="n">xgb_params</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>xgb_params {&#39;learning_rate&#39;: 0.07948707900984789, &#39;eval_metric&#39;: &#39;auc&#39;, &#39;use_label_encoder&#39;: False, &#39;random_state&#39;: 42, &#39;booster&#39;: &#39;gblinear&#39;, &#39;colsample_bytree&#39;: 0.30017155189532796, &#39;early_stopping_rounds&#39;: 268, &#39;max_depth&#39;: 5, &#39;n_estimators&#39;: 15000, &#39;reg_alpha&#39;: 2.5216595944303144e-06, &#39;reg_lambda&#39;: 7.984356925605064e-06, &#39;subsample&#39;: 0.9949361731336916, &#39;tree_method&#39;: &#39;approx&#39;}
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Let's-Use-K-Fold-Training-with-best-params">Let's Use K-Fold Training with best params<a class="anchor-link" href="#Let's-Use-K-Fold-Training-with-best-params"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">X_np</span><span class="p">,</span> <span class="n">X_test_np</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">pp_fit_transform</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_np</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 560 ms, sys: 17.7 ms, total: 578 ms
Wall time: 78.9 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1"># k-fold training</span>
<span class="n">xgb_model_metrics_score</span><span class="p">,</span> <span class="n">xgb_model_test_preds</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">do_kfold_training</span><span class="p">(</span><span class="n">X_np</span><span class="p">,</span>
                                                                       <span class="n">y_np</span><span class="p">,</span>
                                                                       <span class="n">X_test</span><span class="o">=</span><span class="n">X_test_np</span><span class="p">,</span>
                                                                       <span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                                                       <span class="n">model</span><span class="o">=</span><span class="n">updated_xgb_model</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-10 00:51:39,405 INFO  model class:&lt;class &#39;xgboost.sklearn.XGBClassifier&#39;&gt;
2021-12-10 00:51:39,410 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[00:51:39] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { colsample_bytree, early_stopping_rounds, max_depth, subsample, tree_method } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-10 00:52:00,853 INFO Training Finished!
2021-12-10 00:52:00,854 INFO Predicting Val Probablities!
2021-12-10 00:52:00,856 INFO Predicting Val Score!
2021-12-10 00:52:00,860 INFO fold: 1 roc_auc_score : 0.7867504835589942
2021-12-10 00:52:00,861 INFO fold: 1 accuracy_score : 0.72625
2021-12-10 00:52:00,861 INFO Predicting Test Probablities!
2021-12-10 00:52:00,867 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[00:52:00] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { colsample_bytree, early_stopping_rounds, max_depth, subsample, tree_method } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">xgb_model_test_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">xgb_model_test_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000,)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># final_preds = ((0.45 * sci_model_preds) + (0.55* xgb_model_test_preds)) / 2</span>
<span class="c1"># print(final_preds.shape)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Create-Kaggle-Predictions">Create Kaggle Predictions<a class="anchor-link" href="#Create-Kaggle-Predictions"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># sub[&#39;target&#39;] = final_preds</span>
<span class="c1"># sub.to_csv(&#39;submission.csv&#39;, index=False)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># # run the script to build </span>

<span class="c1"># from nbdev.export import notebook2script; notebook2script()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

