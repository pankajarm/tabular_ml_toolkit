---

title: Getting Started Kaggle TPS Challenge with Tabular ML Toolkit


keywords: fastai
sidebar: home_sidebar

summary: "A Tutorial to showcase usage of Tabular_ML_Toolkit library on Kaggle TPS Challenge Nov 2021"
description: "A Tutorial to showcase usage of Tabular_ML_Toolkit library on Kaggle TPS Challenge Nov 2021"
nb_path: "07_Kaggle_TPS_Tutorial.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 07_Kaggle_TPS_Tutorial.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install">Install<a class="anchor-link" href="#Install"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>pip install -U tabular_ml_toolkit</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-Best-Use-tabular_ml_toolkit">How to Best Use tabular_ml_toolkit<a class="anchor-link" href="#How-to-Best-Use-tabular_ml_toolkit"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Start with your favorite model and then just simply create MLPipeline with one API.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>You can use MLPipeline to quickly train any model which supports scikit-lear fit and transform methods.</em></p>
<p><em>For example, Here we are using LogisticRegression from Scikit-Learn, on  <a href="https://www.kaggle.com/c/tabular-playground-series-nov-2021/data">Kaggle TPS Challenge (Nov 2021) data</a></em></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DIRECTORY_PATH</span> <span class="o">=</span> <span class="s2">&quot;/Users/pankajmathur/kaggle_datasets/tps_nov_2021/&quot;</span>
<span class="n">TRAIN_FILE</span> <span class="o">=</span> <span class="s2">&quot;train.csv&quot;</span>
<span class="n">TEST_FILE</span> <span class="o">=</span> <span class="s2">&quot;test.csv&quot;</span>
<span class="n">SAMPLE_SUB_FILE</span> <span class="o">=</span> <span class="s2">&quot;sample_submission.csv&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">scikit_model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sci_ml_pl</span> <span class="o">=</span> <span class="n">MLPipeline</span><span class="p">()</span><span class="o">.</span><span class="n">prepare_data_for_training</span><span class="p">(</span>
    <span class="n">train_file_path</span><span class="o">=</span> <span class="n">DIRECTORY_PATH</span> <span class="o">+</span> <span class="n">TRAIN_FILE</span><span class="p">,</span>
    <span class="n">test_file_path</span><span class="o">=</span> <span class="n">DIRECTORY_PATH</span> <span class="o">+</span> <span class="n">TEST_FILE</span><span class="p">,</span>
    <span class="c1">#make sure to use right index and target column</span>
    <span class="n">idx_col</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span>
    <span class="n">target</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="n">scikit_model</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
    <span class="n">valid_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>both high_card_cat_cols and low_card_cat_cols are None
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">set_config</span>

<span class="n">set_config</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s2">&quot;diagram&quot;</span><span class="p">)</span>
<span class="n">sci_ml_pl</span><span class="o">.</span><span class="n">spl</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<style>#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 {color: black;background-color: white;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 pre{padding: 0;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 div.sk-toggleable {background-color: white;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 div.sk-item {z-index: 1;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 div.sk-parallel-item:only-child::after {width: 0;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2 div.sk-container {display: inline-block;position: relative;}</style><div id="sk-38c8e0ad-6974-4e31-b450-9228dd7ef0f2" class"sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="bd994d57-bdfe-400b-9e79-5db69753e98c" type="checkbox" ><label class="sk-toggleable__label" for="bd994d57-bdfe-400b-9e79-5db69753e98c">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('preprocessor',
                 Pipeline(steps=[('imputer', SimpleImputer(strategy='median')),
                                 ('scaler', StandardScaler())])),
                ('model',
                 LogisticRegression(random_state=42, solver='liblinear'))])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a7933eb5-8885-4d5b-9a01-a48a23e08ece" type="checkbox" ><label class="sk-toggleable__label" for="a7933eb5-8885-4d5b-9a01-a48a23e08ece">preprocessor: Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('imputer', SimpleImputer(strategy='median')),
                ('scaler', StandardScaler())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="28b1b913-d5f1-46eb-b9dc-b6afcfd44f03" type="checkbox" ><label class="sk-toggleable__label" for="28b1b913-d5f1-46eb-b9dc-b6afcfd44f03">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='median')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="92770325-c271-4264-a6da-0e88943cda39" type="checkbox" ><label class="sk-toggleable__label" for="92770325-c271-4264-a6da-0e88943cda39">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="0fb7fec5-3e83-42cd-acf4-088b3c46c2ff" type="checkbox" ><label class="sk-toggleable__label" for="0fb7fec5-3e83-42cd-acf4-088b3c46c2ff">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(random_state=42, solver='liblinear')</pre></div></div></div></div></div></div></div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;X_train shape is </span><span class="si">{</span><span class="n">sci_ml_pl</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;X_valid shape is </span><span class="si">{</span><span class="n">sci_ml_pl</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_valid</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;y_train shape is </span><span class="si">{</span><span class="n">sci_ml_pl</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;y_valid shape is </span><span class="si">{</span><span class="n">sci_ml_pl</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y_valid</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>X_train shape is (480000, 100)
X_valid shape is (120000, 100)
y_train shape is (480000,)
y_valid shape is (120000,)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sci_ml_pl</span><span class="o">.</span><span class="n">spl</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">sci_ml_pl</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_train</span><span class="p">,</span> <span class="n">sci_ml_pl</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">sci_ml_pl</span><span class="o">.</span><span class="n">spl</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sci_ml_pl</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_valid</span><span class="p">)</span>
<span class="n">preds_probs</span> <span class="o">=</span> <span class="n">sci_ml_pl</span><span class="o">.</span><span class="n">spl</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">sci_ml_pl</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_valid</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;preds shape is </span><span class="si">{</span><span class="n">preds</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;preds_probs shape is </span><span class="si">{</span><span class="n">preds_probs</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>preds shape is (120000,)
preds_probs shape is (120000,)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">sci_ml_pl</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds_probs</span><span class="p">)</span>
<span class="n">acc</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">sci_ml_pl</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AUC is : </span><span class="si">{</span><span class="n">auc</span><span class="si">}</span><span class="s2"> while Accuracy is : </span><span class="si">{</span><span class="n">acc</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>AUC is : 0.7506636457905501 while Accuracy is : 0.7385833333333334 
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In background <code>prepare_data_for_training</code> and <code>prepare_data_for_cv</code>  methods loads your input data into Pandas DataFrame, seprates X(features) and y(target).</p>
<p>Then <code>prepare_data_for_training</code> methods split X(features) into X_train, y_train, X_valid and y_valid DataFrames.
However, <code>prepare_data_for_cv</code>  method do not split but let's cross validation split internally X and y DataFrames.</p>
<p>Then both methods preprocess all numerical and categorical type data found in these DataFrames using scikit-learn pipelines. Then it bundle preprocessed data with your given model and return an MLPipeline object, this class instance has dataframeloader, preprocessor and scikit-lean pipeline instances, so you can call fit methods on X_train and y_train and predict methods on X_valid or X_test.</p>
<p>Please check detail documentation and source code for more details.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>NOTE: If you want to customize data and preprocessing steps you can do so by using <a href="/tabular_ml_toolkit/DataFrameLoader.html#DataFrameLoader"><code>DataFrameLoader</code></a> and <code>PreProessor</code> classes. Check detail documentations for these classes for more options.</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Let's-Use-XGBosst-on-MLPipeline">Let's Use XGBosst on MLPipeline<a class="anchor-link" href="#Let's-Use-XGBosst-on-MLPipeline"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>You can also use MLPipeline with XGBoost model, Just make sure to install XGBooost first depending upon your OS.</em></p>
<p><em>After that all steps remains same. Here is example using XGBRegressor with <a href="https://www.kaggle.com/estrotococo/home-data-for-ml-course">Melbourne Home Sale price data</a></em></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># !conda install -c conda-forge xgboost</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># xgb_params = {</span>
<span class="c1">#     &#39;n_estimators&#39;: 1000,</span>
<span class="c1">#     &#39;learning_rate&#39;: 0.01,</span>
<span class="c1"># #     &#39;max_depth&#39;: 9,</span>
<span class="c1">#     &#39;booster&#39;: &#39;gbtree&#39;,</span>
<span class="c1">#     &#39;eval_metric&#39;: &#39;auc&#39;,</span>
<span class="c1"># #     &#39;tree_method&#39;: &#39;gpu_hist&#39;,</span>
<span class="c1"># #     &#39;predictor&#39;: &#39;gpu_predictor&#39;,</span>
<span class="c1">#     &#39;use_label_encoder&#39;: False,</span>
<span class="c1">#     &#39;random_state&#39;: 42</span>
<span class="c1"># }</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># # create xgb Classifier model</span>
<span class="c1"># xgb_model = XGBClassifier(**xgb_params)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># xgb_ml_pl = MLPipeline().prepare_data_for_training(</span>
<span class="c1">#     train_file_path= DIRECTORY_PATH+TRAIN_FILE,</span>
<span class="c1">#     test_file_path= DIRECTORY_PATH+TEST_FILE,</span>
<span class="c1">#     #make sure to use right index and target column</span>
<span class="c1">#     idx_col=&quot;id&quot;,</span>
<span class="c1">#     target=&quot;target&quot;,</span>
<span class="c1">#     model=xgb_model,</span>
<span class="c1">#     random_state=42,</span>
<span class="c1">#     valid_size=0.2)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># from sklearn import set_config</span>

<span class="c1"># set_config(display=&quot;diagram&quot;)</span>
<span class="c1"># xgb_ml_pl.spl</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># xgb_ml_pl.spl.fit(xgb_ml_pl.dfl.X_train,</span>
<span class="c1">#                               xgb_ml_pl.dfl.y_train)</span>
<span class="c1"># preds = xgb_ml_pl.spl.predict(xgb_ml_pl.dfl.X_valid)</span>
<span class="c1"># preds_probs = xgb_ml_pl.spl.predict_proba(xgb_ml_pl.dfl.X_valid)[:, 1]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># auc = roc_auc_score(xgb_ml_pl.dfl.y_valid, preds_probs)</span>
<span class="c1"># acc = accuracy_score(xgb_ml_pl.dfl.y_valid, preds)</span>

<span class="c1"># print(f&quot;AUC is : {auc} while Accuracy is : {acc} &quot;)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Let's-do-Grid-Search-for-HyperParameters-Tunning-for-Scikit-Model-on-our-MLPipeline">Let's do Grid Search for HyperParameters Tunning for Scikit Model on our MLPipeline<a class="anchor-link" href="#Let's-do-Grid-Search-for-HyperParameters-Tunning-for-Scikit-Model-on-our-MLPipeline"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># scikit_model = LogisticRegression(solver=&#39;liblinear&#39;, random_state=42)</span>

<span class="c1"># # createm ml pipeline for scikit-learn model</span>
<span class="c1"># sci_ml_pl = MLPipeline().prepare_data_for_training(</span>
<span class="c1">#     train_file_path= DIRECTORY_PATH+TRAIN_FILE,</span>
<span class="c1">#     test_file_path= DIRECTORY_PATH+TEST_FILE,</span>
<span class="c1">#     idx_col=&quot;id&quot;,</span>
<span class="c1">#     target=&quot;target&quot;,</span>
<span class="c1">#     model=scikit_model,</span>
<span class="c1">#     random_state=42)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># from sklearn import set_config</span>

<span class="c1"># set_config(display=&quot;diagram&quot;)</span>
<span class="c1"># sci_ml_pl.spl</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># #     &quot;preprocessor__num__imputer__strategy&quot;: [&quot;constant&quot;, &quot;mean&quot;, &quot;median&quot;],</span>
<span class="c1"># #     &quot;preprocessor__low_cad_cat__imputer__strategy&quot;: [&quot;most_frequent&quot;, &quot;constant&quot;],</span>
<span class="c1">#     &quot;model__solver&quot;: [&quot;newton-cg&quot;, &quot;lbfgs&quot;, &quot;liblinear&quot;]</span>
<span class="c1"># }</span>

<span class="c1"># grid_search = sci_ml_pl.do_grid_search(param_grid=param_grid, cv=3,</span>
<span class="c1">#                                        scoring=&#39;roc_auc&#39;)</span>

<span class="c1"># print(&quot;Best params:&quot;)</span>
<span class="c1"># print(grid_search.best_params_)</span>

<span class="c1"># print(f&quot;Internal CV Metrics score: {-1*(grid_search.best_score_):.3f}&quot;)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Let's-Use-K-Fold-Training-with-best-params-from-grid-search">Let's Use K-Fold Training with best params from grid search<a class="anchor-link" href="#Let's-Use-K-Fold-Training-with-best-params-from-grid-search"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">scikit_model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span>
                                  <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sci_ml_pl</span> <span class="o">=</span> <span class="n">MLPipeline</span><span class="p">()</span><span class="o">.</span><span class="n">prepare_data_for_training</span><span class="p">(</span>
    <span class="n">train_file_path</span><span class="o">=</span> <span class="n">DIRECTORY_PATH</span><span class="o">+</span><span class="n">TRAIN_FILE</span><span class="p">,</span>
    <span class="n">test_file_path</span><span class="o">=</span> <span class="n">DIRECTORY_PATH</span><span class="o">+</span><span class="n">TEST_FILE</span><span class="p">,</span>
    <span class="n">idx_col</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span>
    <span class="n">target</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="n">scikit_model</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>both high_card_cat_cols and low_card_cat_cols are None
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">set_config</span>

<span class="n">set_config</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s2">&quot;diagram&quot;</span><span class="p">)</span>
<span class="n">sci_ml_pl</span><span class="o">.</span><span class="n">spl</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<style>#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 {color: black;background-color: white;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 pre{padding: 0;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 div.sk-toggleable {background-color: white;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 div.sk-estimator:hover {background-color: #d4ebff;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 div.sk-item {z-index: 1;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 div.sk-parallel-item:only-child::after {width: 0;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90 div.sk-container {display: inline-block;position: relative;}</style><div id="sk-d7a0477b-5d53-4c9c-af26-35f5804fbd90" class"sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="14e55984-119a-41f7-be5a-45d84ea24ed0" type="checkbox" ><label class="sk-toggleable__label" for="14e55984-119a-41f7-be5a-45d84ea24ed0">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('preprocessor',
                 Pipeline(steps=[('imputer', SimpleImputer(strategy='median')),
                                 ('scaler', StandardScaler())])),
                ('model',
                 LogisticRegression(random_state=42, solver='liblinear'))])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b23511bc-d3f9-4f09-aab0-560430480214" type="checkbox" ><label class="sk-toggleable__label" for="b23511bc-d3f9-4f09-aab0-560430480214">preprocessor: Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('imputer', SimpleImputer(strategy='median')),
                ('scaler', StandardScaler())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f90d37d9-1b8c-4e2f-b7f8-98d0a6293eca" type="checkbox" ><label class="sk-toggleable__label" for="f90d37d9-1b8c-4e2f-b7f8-98d0a6293eca">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='median')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f6d27a4d-2e2e-484b-aa88-24fc700ee913" type="checkbox" ><label class="sk-toggleable__label" for="f6d27a4d-2e2e-484b-aa88-24fc700ee913">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="e6d47d8a-1249-4d29-b7f4-fe0885654bb7" type="checkbox" ><label class="sk-toggleable__label" for="e6d47d8a-1249-4d29-b7f4-fe0885654bb7">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(random_state=42, solver='liblinear')</pre></div></div></div></div></div></div></div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># sci_ml_pl.dfl.final_cols</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">k_fold</span><span class="p">,</span> <span class="n">metrics_score</span> <span class="o">=</span> <span class="n">sci_ml_pl</span><span class="o">.</span><span class="n">do_k_fold_training</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">roc_auc_score</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mean metrics score:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">metrics_score</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean metrics_score is : </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">metrics_score</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Create-Kaggle-Predictions">Create Kaggle Predictions<a class="anchor-link" href="#Create-Kaggle-Predictions"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preds</span> <span class="o">=</span> <span class="n">sci_ml_pl</span><span class="o">.</span><span class="n">do_k_fold_prediction</span><span class="p">(</span><span class="n">k_fold</span><span class="o">=</span><span class="n">k_fold</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sub</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">DIRECTORY_PATH</span> <span class="o">+</span> <span class="n">SAMPLE_SUB_FILE</span><span class="p">)</span>
<span class="n">sub</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preds</span>
<span class="n">sub</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;submission.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

