---

title: Getting Started Tutorial with TMLT (Tabular ML Toolkit)


keywords: fastai
sidebar: home_sidebar

summary: "A tutorial on getting started with TMLT (Tabular ML Toolkit)"
description: "A tutorial on getting started with TMLT (Tabular ML Toolkit)"
nb_path: "index.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install">Install<a class="anchor-link" href="#Install"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>pip install -U tabular_ml_toolkit</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-Best-Use-tabular_ml_toolkit">How to Best Use tabular_ml_toolkit<a class="anchor-link" href="#How-to-Best-Use-tabular_ml_toolkit"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Start with your favorite model and then just simply create tmlt with one API</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>For example, Here we are using XGBRegressor on  <a href="https://www.kaggle.com/estrotococo/home-data-for-ml-course">Melbourne Home Sale price data</a></em></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">tabular_ml_toolkit.tmlt</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBRegressor</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/Users/pankajmathur/anaconda3/envs/nbdev_env/lib/python3.9/site-packages/redis/connection.py:77: UserWarning: redis-py works best with hiredis. Please consider installing
  warnings.warn(msg)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DIRECTORY_PATH</span> <span class="o">=</span> <span class="s2">&quot;input/home_data/&quot;</span>
<span class="n">TRAIN_FILE</span> <span class="o">=</span> <span class="s2">&quot;train.csv&quot;</span>
<span class="n">TEST_FILE</span> <span class="o">=</span> <span class="s2">&quot;test.csv&quot;</span>
<span class="n">SAMPLE_SUB_FILE</span> <span class="o">=</span> <span class="s2">&quot;sample_submission.csv&quot;</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="s2">&quot;output/&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Just-point-tmlt-in-the-direction-of-your-data,-let-it-know-what-are-idx-and-target-columns-in-your-tabular-data-and-what-kind-of-problem-type-you-are-trying-to-resolve">Just point tmlt in the direction of your data, let it know what are idx and target columns in your tabular data and what kind of problem type you are trying to resolve<a class="anchor-link" href="#Just-point-tmlt-in-the-direction-of-your-data,-let-it-know-what-are-idx-and-target-columns-in-your-tabular-data-and-what-kind-of-problem-type-you-are-trying-to-resolve"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1"># tmlt</span>
<span class="n">tmlt</span> <span class="o">=</span> <span class="n">TMLT</span><span class="p">()</span><span class="o">.</span><span class="n">prepare_data</span><span class="p">(</span>
    <span class="n">train_file_path</span><span class="o">=</span> <span class="n">DIRECTORY_PATH</span><span class="o">+</span><span class="n">TRAIN_FILE</span><span class="p">,</span>
    <span class="n">test_file_path</span><span class="o">=</span> <span class="n">DIRECTORY_PATH</span><span class="o">+</span><span class="n">TEST_FILE</span><span class="p">,</span>
    <span class="n">idx_col</span><span class="o">=</span><span class="s2">&quot;Id&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;SalePrice&quot;</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
    <span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;regression&quot;</span><span class="p">)</span>

<span class="c1"># TMLT currently only supports below problem_type:</span>

<span class="c1"># &quot;binary_classification&quot;</span>
<span class="c1"># &quot;multi_label_classification&quot;</span>
<span class="c1"># &quot;multi_class_classification&quot;</span>
<span class="c1"># &quot;regression&quot;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 20:40:13,230 INFO 8 cores found, model and data parallel processing should worked!
2021-12-06 20:40:13,267 INFO DataFrame Memory usage decreased to 0.58 Mb (35.5% reduction)
2021-12-06 20:40:13,305 INFO DataFrame Memory usage decreased to 0.58 Mb (34.8% reduction)
2021-12-06 20:40:13,331 INFO Both Numerical &amp; Categorical columns found, Preprocessing will done accordingly!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 122 ms, sys: 16.6 ms, total: 139 ms
Wall time: 138 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
(1460, 79)
&lt;class &#39;numpy.ndarray&#39;&gt;
(1460,)
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
(1459, 79)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MSSubClass</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>OverallQual</th>
      <th>OverallCond</th>
      <th>YearBuilt</th>
      <th>YearRemodAdd</th>
      <th>MasVnrArea</th>
      <th>BsmtFinSF1</th>
      <th>BsmtFinSF2</th>
      <th>...</th>
      <th>GarageCond</th>
      <th>PavedDrive</th>
      <th>PoolQC</th>
      <th>Fence</th>
      <th>MiscFeature</th>
      <th>SaleType</th>
      <th>SaleCondition</th>
      <th>Neighborhood</th>
      <th>Exterior1st</th>
      <th>Exterior2nd</th>
    </tr>
    <tr>
      <th>Id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>60</td>
      <td>65.0</td>
      <td>8450</td>
      <td>7</td>
      <td>5</td>
      <td>2003</td>
      <td>2003</td>
      <td>196.0</td>
      <td>706</td>
      <td>0</td>
      <td>...</td>
      <td>TA</td>
      <td>Y</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>WD</td>
      <td>Normal</td>
      <td>CollgCr</td>
      <td>VinylSd</td>
      <td>VinylSd</td>
    </tr>
    <tr>
      <th>2</th>
      <td>20</td>
      <td>80.0</td>
      <td>9600</td>
      <td>6</td>
      <td>8</td>
      <td>1976</td>
      <td>1976</td>
      <td>0.0</td>
      <td>978</td>
      <td>0</td>
      <td>...</td>
      <td>TA</td>
      <td>Y</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>WD</td>
      <td>Normal</td>
      <td>Veenker</td>
      <td>MetalSd</td>
      <td>MetalSd</td>
    </tr>
    <tr>
      <th>3</th>
      <td>60</td>
      <td>68.0</td>
      <td>11250</td>
      <td>7</td>
      <td>5</td>
      <td>2001</td>
      <td>2002</td>
      <td>162.0</td>
      <td>486</td>
      <td>0</td>
      <td>...</td>
      <td>TA</td>
      <td>Y</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>WD</td>
      <td>Normal</td>
      <td>CollgCr</td>
      <td>VinylSd</td>
      <td>VinylSd</td>
    </tr>
    <tr>
      <th>4</th>
      <td>70</td>
      <td>60.0</td>
      <td>9550</td>
      <td>7</td>
      <td>5</td>
      <td>1915</td>
      <td>1970</td>
      <td>0.0</td>
      <td>216</td>
      <td>0</td>
      <td>...</td>
      <td>TA</td>
      <td>Y</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>WD</td>
      <td>Abnorml</td>
      <td>Crawfor</td>
      <td>Wd Sdng</td>
      <td>Wd Shng</td>
    </tr>
    <tr>
      <th>5</th>
      <td>60</td>
      <td>84.0</td>
      <td>14260</td>
      <td>8</td>
      <td>5</td>
      <td>2000</td>
      <td>2000</td>
      <td>350.0</td>
      <td>655</td>
      <td>0</td>
      <td>...</td>
      <td>TA</td>
      <td>Y</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>WD</td>
      <td>Normal</td>
      <td>NoRidge</td>
      <td>VinylSd</td>
      <td>VinylSd</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1456</th>
      <td>60</td>
      <td>62.0</td>
      <td>7917</td>
      <td>6</td>
      <td>5</td>
      <td>1999</td>
      <td>2000</td>
      <td>0.0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>TA</td>
      <td>Y</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>WD</td>
      <td>Normal</td>
      <td>Gilbert</td>
      <td>VinylSd</td>
      <td>VinylSd</td>
    </tr>
    <tr>
      <th>1457</th>
      <td>20</td>
      <td>85.0</td>
      <td>13175</td>
      <td>6</td>
      <td>6</td>
      <td>1978</td>
      <td>1988</td>
      <td>119.0</td>
      <td>790</td>
      <td>163</td>
      <td>...</td>
      <td>TA</td>
      <td>Y</td>
      <td>NaN</td>
      <td>MnPrv</td>
      <td>NaN</td>
      <td>WD</td>
      <td>Normal</td>
      <td>NWAmes</td>
      <td>Plywood</td>
      <td>Plywood</td>
    </tr>
    <tr>
      <th>1458</th>
      <td>70</td>
      <td>66.0</td>
      <td>9042</td>
      <td>7</td>
      <td>9</td>
      <td>1941</td>
      <td>2006</td>
      <td>0.0</td>
      <td>275</td>
      <td>0</td>
      <td>...</td>
      <td>TA</td>
      <td>Y</td>
      <td>NaN</td>
      <td>GdPrv</td>
      <td>Shed</td>
      <td>WD</td>
      <td>Normal</td>
      <td>Crawfor</td>
      <td>CemntBd</td>
      <td>CmentBd</td>
    </tr>
    <tr>
      <th>1459</th>
      <td>20</td>
      <td>68.0</td>
      <td>9717</td>
      <td>5</td>
      <td>6</td>
      <td>1950</td>
      <td>1996</td>
      <td>0.0</td>
      <td>49</td>
      <td>1029</td>
      <td>...</td>
      <td>TA</td>
      <td>Y</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>WD</td>
      <td>Normal</td>
      <td>NAmes</td>
      <td>MetalSd</td>
      <td>MetalSd</td>
    </tr>
    <tr>
      <th>1460</th>
      <td>20</td>
      <td>75.0</td>
      <td>9937</td>
      <td>5</td>
      <td>6</td>
      <td>1965</td>
      <td>1965</td>
      <td>0.0</td>
      <td>830</td>
      <td>290</td>
      <td>...</td>
      <td>TA</td>
      <td>Y</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>WD</td>
      <td>Normal</td>
      <td>Edwards</td>
      <td>HdBoard</td>
      <td>HdBoard</td>
    </tr>
  </tbody>
</table>
<p>1460 rows × 79 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Training">Training<a class="anchor-link" href="#Training"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="create-train-valid-dataframes-for-quick-preprocessing-and-training">create train valid dataframes for quick preprocessing and training<a class="anchor-link" href="#create-train-valid-dataframes-for-quick-preprocessing-and-training"> </a></h5>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1"># create train, valid split to evaulate model on valid dataset</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_valid</span><span class="p">,</span>  <span class="n">y_train</span><span class="p">,</span> <span class="n">y_valid</span> <span class="o">=</span>  <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">create_train_valid</span><span class="p">(</span><span class="n">valid_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 6.11 ms, sys: 1.88 ms, total: 7.99 ms
Wall time: 6.28 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_valid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_valid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1168, 79)
(1168,)
(292, 79)
(292,)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Now-PreProcess-X_train,-X_valid">Now PreProcess X_train, X_valid<a class="anchor-link" href="#Now-PreProcess-X_train,-X_valid"> </a></h5><p>NOTE: Preprocessing gives back numpy arrays for pandas dataframe</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">X_train_np</span><span class="p">,</span>  <span class="n">X_valid_np</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">pp_fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_valid</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 35.3 ms, sys: 3.43 ms, total: 38.7 ms
Wall time: 37.3 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">X_train_np</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_train_np</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1"># print(X_train_np)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">X_valid_np</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_valid_np</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1"># print(X_valid_np)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">y_valid</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">y_train</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;numpy.ndarray&#39;&gt;
(1168, 302)
&lt;class &#39;numpy.ndarray&#39;&gt;
(292, 302)
&lt;class &#39;numpy.ndarray&#39;&gt;
&lt;class &#39;numpy.ndarray&#39;&gt;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Training">Training<a class="anchor-link" href="#Training"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Create-a-base-xgb-classifier-model-with-your-best-guess-params">Create a base xgb classifier model with your best guess params<a class="anchor-link" href="#Create-a-base-xgb-classifier-model-with-your-best-guess-params"> </a></h5>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xgb_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="s1">&#39;use_label_encoder&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;eval_metric&#39;</span><span class="p">:</span><span class="s1">&#39;rmse&#39;</span><span class="p">,</span>
    <span class="s1">&#39;random_state&#39;</span><span class="p">:</span><span class="mi">42</span><span class="p">,</span>
    <span class="c1"># for GPU</span>
<span class="c1">#     &#39;tree_method&#39;: &#39;gpu_hist&#39;,</span>
<span class="c1">#     &#39;predictor&#39;: &#39;gpu_predictor&#39;,</span>
<span class="p">}</span>
<span class="c1"># create xgb ml model</span>
<span class="n">xgb_model</span> <span class="o">=</span> <span class="n">XGBRegressor</span><span class="p">(</span><span class="o">**</span><span class="n">xgb_params</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1"># Now do model training</span>
<span class="n">xgb_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_np</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
              <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="c1">#detect &amp; avoid overfitting</span>
              <span class="n">eval_set</span><span class="o">=</span><span class="p">[(</span><span class="n">X_train_np</span><span class="p">,</span> <span class="n">y_train</span><span class="p">),</span> <span class="p">(</span><span class="n">X_valid_np</span><span class="p">,</span> <span class="n">y_valid</span><span class="p">)],</span>
              <span class="n">eval_metric</span><span class="o">=</span><span class="s2">&quot;mae&quot;</span><span class="p">,</span>
              <span class="n">early_stopping_rounds</span><span class="o">=</span><span class="mi">300</span>
             <span class="p">)</span>

<span class="c1">#predict</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">xgb_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_valid_np</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X_valid MAE:&#39;</span><span class="p">,</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>X_valid MAE: 15915.75480254709
CPU times: user 3.67 s, sys: 28.5 ms, total: 3.7 s
Wall time: 484 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In background <code>prepare_data</code> method loads your input data into Pandas DataFrame, seprates X(features) and y(target), preprocess all numerical and categorical type data found in these DataFrames using scikit-learn pipelines. Then it bundle preprocessor and data return a TMLT object, this class instance has dataframeloader, preprocessor instances.</p>
<p>The <code>create_train_valid</code> method use valid_size to split X(features) into X_train, y_train, X_valid and y_valid DataFrames, so you can call fit methods on X_train and y_train and predict methods on X_valid or X_test.</p>
<p>Please check detail documentation and source code for more details.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>NOTE: If you want to customize data and preprocessing steps you can do so by using <a href="/tabular_ml_toolkit/dataframeloader.html#DataFrameLoader"><code>DataFrameLoader</code></a> and <code>PreProessor</code> classes. Check detail documentations for these classes for more options.</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="To-see-more-clear-picture-of-model-performance,-Let's-do-a-quick-Cross-Validation-on-our-Pipeline">To see more clear picture of model performance, Let's do a quick Cross Validation on our Pipeline<a class="anchor-link" href="#To-see-more-clear-picture-of-model-performance,-Let's-do-a-quick-Cross-Validation-on-our-Pipeline"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Make-sure-to-PreProcess-the-data">Make sure to PreProcess the data<a class="anchor-link" href="#Make-sure-to-PreProcess-the-data"> </a></h5>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">X_np</span><span class="p">,</span> <span class="n">X_test_np</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">pp_fit_transform</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_np</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 49.3 ms, sys: 3.5 ms, total: 52.8 ms
Wall time: 52.2 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1"># Now do cross_validation</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">do_cross_validation</span><span class="p">(</span><span class="n">X_np</span><span class="p">,</span> <span class="n">y_np</span><span class="p">,</span> <span class="n">xgb_model</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;scores:&quot;</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average MAE score:&quot;</span><span class="p">,</span> <span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>scores: [15733.51983893 16386.18366064 16648.82777718 14571.39875856
 17295.16245719]
Average MAE score: 16127.018498501711
CPU times: user 37.9 ms, sys: 59.7 ms, total: 97.6 ms
Wall time: 3.3 s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>MAE did came out slightly bad with cross validation</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>Let's see if we can improve our cross validation score with hyperparams tunning</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>We are using optuna based hyperparameter search here!</strong></p>
<p><strong>TMLT has inbuilt xgb optuna optimization helper method!</strong></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">study</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">do_xgb_optuna_optimization</span><span class="p">(</span><span class="n">optuna_db_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">,</span> <span class="n">opt_timeout</span><span class="o">=</span><span class="mi">360</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">study</span><span class="o">.</span><span class="n">best_trial</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 21:00:14,542 INFO Optimization Direction is: minimize
<span class="ansi-green-fg">[I 2021-12-06 21:00:14,569]</span> Using an existing study with name &#39;tmlt_autoxgb&#39; instead of creating a new one.
2021-12-06 21:00:14,734 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[21:00:14] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { early_stopping_rounds, eval_set } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 21:00:35,108 INFO Training Ended!
2021-12-06 21:00:35,152 INFO mean_absolute_error: 15009.969084439212
2021-12-06 21:00:35,153 INFO mean_squared_error: 655351882.5350126
2021-12-06 21:00:35,153 INFO r2_score: 0.914560102812714
<span class="ansi-green-fg">[I 2021-12-06 21:00:35,197]</span> Trial 11 finished with value: 655351882.5350126 and parameters: {&#39;learning_rate&#39;: 0.010270418302430515, &#39;n_estimators&#39;: 7000, &#39;reg_lambda&#39;: 0.11208993634908683, &#39;reg_alpha&#39;: 1.2523750509850092e-08, &#39;subsample&#39;: 0.7654682326285074, &#39;colsample_bytree&#39;: 0.3202600058643555, &#39;max_depth&#39;: 6, &#39;early_stopping_rounds&#39;: 311, &#39;tree_method&#39;: &#39;approx&#39;, &#39;booster&#39;: &#39;gbtree&#39;, &#39;gamma&#39;: 3.0032310337571614e-08, &#39;grow_policy&#39;: &#39;lossguide&#39;}. Best is trial 0 with value: 607032267.1056623.
2021-12-06 21:00:35,344 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[21:00:35] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { early_stopping_rounds, eval_set } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 21:00:57,999 INFO Training Ended!
2021-12-06 21:00:58,043 INFO mean_absolute_error: 15042.68758026541
2021-12-06 21:00:58,044 INFO mean_squared_error: 692181925.3312689
2021-12-06 21:00:58,044 INFO r2_score: 0.9097584761541573
<span class="ansi-green-fg">[I 2021-12-06 21:00:58,084]</span> Trial 12 finished with value: 692181925.3312689 and parameters: {&#39;learning_rate&#39;: 0.01031476516405966, &#39;n_estimators&#39;: 7000, &#39;reg_lambda&#39;: 0.06291237692238871, &#39;reg_alpha&#39;: 1.000769636493865e-08, &#39;subsample&#39;: 0.7266594563237431, &#39;colsample_bytree&#39;: 0.36116785096889154, &#39;max_depth&#39;: 6, &#39;early_stopping_rounds&#39;: 310, &#39;tree_method&#39;: &#39;approx&#39;, &#39;booster&#39;: &#39;gbtree&#39;, &#39;gamma&#39;: 1.0514451034987692e-08, &#39;grow_policy&#39;: &#39;lossguide&#39;}. Best is trial 0 with value: 607032267.1056623.
2021-12-06 21:00:58,236 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[21:00:58] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { early_stopping_rounds, eval_set } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 21:01:16,142 INFO Training Ended!
2021-12-06 21:01:16,188 INFO mean_absolute_error: 15168.345836900686
2021-12-06 21:01:16,189 INFO mean_squared_error: 646714033.6624396
2021-12-06 21:01:16,190 INFO r2_score: 0.9156862412114277
<span class="ansi-green-fg">[I 2021-12-06 21:01:16,226]</span> Trial 13 finished with value: 646714033.6624396 and parameters: {&#39;learning_rate&#39;: 0.011755163749377023, &#39;n_estimators&#39;: 7000, &#39;reg_lambda&#39;: 0.3206755620341041, &#39;reg_alpha&#39;: 1.0765871018494073e-08, &#39;subsample&#39;: 0.701867431660848, &#39;colsample_bytree&#39;: 0.2745782478450856, &#39;max_depth&#39;: 6, &#39;early_stopping_rounds&#39;: 298, &#39;tree_method&#39;: &#39;approx&#39;, &#39;booster&#39;: &#39;gbtree&#39;, &#39;gamma&#39;: 3.1057087219579735e-08, &#39;grow_policy&#39;: &#39;lossguide&#39;}. Best is trial 0 with value: 607032267.1056623.
2021-12-06 21:01:16,377 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[21:01:16] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { early_stopping_rounds, eval_set } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 21:01:30,116 INFO Training Ended!
2021-12-06 21:01:30,134 INFO mean_absolute_error: 16569.805610552226
2021-12-06 21:01:30,135 INFO mean_squared_error: 757096281.7109799
2021-12-06 21:01:30,135 INFO r2_score: 0.9012954258709913
<span class="ansi-green-fg">[I 2021-12-06 21:01:30,169]</span> Trial 14 finished with value: 757096281.7109799 and parameters: {&#39;learning_rate&#39;: 0.10138738039382836, &#39;n_estimators&#39;: 7000, &#39;reg_lambda&#39;: 0.2816742259414267, &#39;reg_alpha&#39;: 0.00016554411913750615, &#39;subsample&#39;: 0.6563278374163238, &#39;colsample_bytree&#39;: 0.6352242840674879, &#39;max_depth&#39;: 2, &#39;early_stopping_rounds&#39;: 227, &#39;tree_method&#39;: &#39;approx&#39;, &#39;booster&#39;: &#39;gbtree&#39;, &#39;gamma&#39;: 0.00620127368783362, &#39;grow_policy&#39;: &#39;lossguide&#39;}. Best is trial 0 with value: 607032267.1056623.
2021-12-06 21:01:30,329 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[21:01:30] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { early_stopping_rounds, eval_set } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 21:02:07,556 INFO Training Ended!
2021-12-06 21:02:07,599 INFO mean_absolute_error: 15009.079743685788
2021-12-06 21:02:07,600 INFO mean_squared_error: 626148008.2534
2021-12-06 21:02:07,600 INFO r2_score: 0.9183674864223249
<span class="ansi-green-fg">[I 2021-12-06 21:02:07,638]</span> Trial 15 finished with value: 626148008.2534 and parameters: {&#39;learning_rate&#39;: 0.020642957404846188, &#39;n_estimators&#39;: 7000, &#39;reg_lambda&#39;: 1.7513064452033746, &#39;reg_alpha&#39;: 1.7170396831267702e-05, &#39;subsample&#39;: 0.6242954147289631, &#39;colsample_bytree&#39;: 0.8202870433196692, &#39;max_depth&#39;: 6, &#39;early_stopping_rounds&#39;: 195, &#39;tree_method&#39;: &#39;hist&#39;, &#39;booster&#39;: &#39;gbtree&#39;, &#39;gamma&#39;: 0.49885898603515555, &#39;grow_policy&#39;: &#39;lossguide&#39;}. Best is trial 0 with value: 607032267.1056623.
2021-12-06 21:02:07,781 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[21:02:07] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { early_stopping_rounds, eval_set } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 21:02:19,643 INFO Training Ended!
2021-12-06 21:02:19,665 INFO mean_absolute_error: 15922.791136023116
2021-12-06 21:02:19,665 INFO mean_squared_error: 652899854.8858695
2021-12-06 21:02:19,666 INFO r2_score: 0.9148797799141711
<span class="ansi-green-fg">[I 2021-12-06 21:02:19,697]</span> Trial 16 finished with value: 652899854.8858695 and parameters: {&#39;learning_rate&#39;: 0.023785205795892477, &#39;n_estimators&#39;: 7000, &#39;reg_lambda&#39;: 2.3962635699611746e-06, &#39;reg_alpha&#39;: 1.7345589108628806e-05, &#39;subsample&#39;: 0.2253464414439063, &#39;colsample_bytree&#39;: 0.849342044824962, &#39;max_depth&#39;: 3, &#39;early_stopping_rounds&#39;: 190, &#39;tree_method&#39;: &#39;hist&#39;, &#39;booster&#39;: &#39;gbtree&#39;, &#39;gamma&#39;: 0.9605947921182305, &#39;grow_policy&#39;: &#39;lossguide&#39;}. Best is trial 0 with value: 607032267.1056623.
2021-12-06 21:02:19,844 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[21:02:19] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { early_stopping_rounds, eval_set } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 21:03:22,928 INFO Training Ended!
2021-12-06 21:03:23,056 INFO mean_absolute_error: 15691.25409353596
2021-12-06 21:03:23,056 INFO mean_squared_error: 621107020.9367895
2021-12-06 21:03:23,057 INFO r2_score: 0.9190246928018773
<span class="ansi-green-fg">[I 2021-12-06 21:03:23,133]</span> Trial 17 finished with value: 621107020.9367895 and parameters: {&#39;learning_rate&#39;: 0.030318257026273988, &#39;n_estimators&#39;: 20000, &#39;reg_lambda&#39;: 3.575493353987708, &#39;reg_alpha&#39;: 0.0006892576471908247, &#39;subsample&#39;: 0.6074312166546988, &#39;colsample_bytree&#39;: 0.709262955470817, &#39;max_depth&#39;: 7, &#39;early_stopping_rounds&#39;: 185, &#39;tree_method&#39;: &#39;hist&#39;, &#39;booster&#39;: &#39;gbtree&#39;, &#39;gamma&#39;: 0.018834748728647963, &#39;grow_policy&#39;: &#39;depthwise&#39;}. Best is trial 0 with value: 607032267.1056623.
2021-12-06 21:03:23,268 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[21:03:23] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { early_stopping_rounds, eval_set } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 21:04:29,536 INFO Training Ended!
2021-12-06 21:04:29,693 INFO mean_absolute_error: 15795.27316994863
2021-12-06 21:04:29,694 INFO mean_squared_error: 652118209.6186093
2021-12-06 21:04:29,694 INFO r2_score: 0.9149816850021878
<span class="ansi-green-fg">[I 2021-12-06 21:04:29,774]</span> Trial 18 finished with value: 652118209.6186093 and parameters: {&#39;learning_rate&#39;: 0.03271758718111387, &#39;n_estimators&#39;: 20000, &#39;reg_lambda&#39;: 0.005692270491178403, &#39;reg_alpha&#39;: 0.0023408373512426913, &#39;subsample&#39;: 0.8199008446138789, &#39;colsample_bytree&#39;: 0.6886538208392597, &#39;max_depth&#39;: 8, &#39;early_stopping_rounds&#39;: 177, &#39;tree_method&#39;: &#39;hist&#39;, &#39;booster&#39;: &#39;gbtree&#39;, &#39;gamma&#39;: 0.003797884287025332, &#39;grow_policy&#39;: &#39;depthwise&#39;}. Best is trial 0 with value: 607032267.1056623.
2021-12-06 21:04:29,915 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[21:04:29] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { early_stopping_rounds, eval_set } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 21:04:58,518 INFO Training Ended!
2021-12-06 21:04:58,603 INFO mean_absolute_error: 19889.809463291953
2021-12-06 21:04:58,603 INFO mean_squared_error: 908790344.0741059
2021-12-06 21:04:58,604 INFO r2_score: 0.8815186838830185
<span class="ansi-green-fg">[I 2021-12-06 21:04:58,648]</span> Trial 19 finished with value: 908790344.0741059 and parameters: {&#39;learning_rate&#39;: 0.076049158907957, &#39;n_estimators&#39;: 20000, &#39;reg_lambda&#39;: 0.006228486140956925, &#39;reg_alpha&#39;: 90.60432556749008, &#39;subsample&#39;: 0.11043073454912561, &#39;colsample_bytree&#39;: 0.5759546613129808, &#39;max_depth&#39;: 9, &#39;early_stopping_rounds&#39;: 253, &#39;tree_method&#39;: &#39;hist&#39;, &#39;booster&#39;: &#39;gbtree&#39;, &#39;gamma&#39;: 0.0221527943168504, &#39;grow_policy&#39;: &#39;depthwise&#39;}. Best is trial 0 with value: 607032267.1056623.
2021-12-06 21:04:58,789 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[21:04:58] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { early_stopping_rounds, eval_set } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 21:05:55,248 INFO Training Ended!
2021-12-06 21:05:55,374 INFO mean_absolute_error: 19523.97050915026
2021-12-06 21:05:55,375 INFO mean_squared_error: 891129659.8191046
2021-12-06 21:05:55,375 INFO r2_score: 0.8838211523541055
<span class="ansi-green-fg">[I 2021-12-06 21:05:55,446]</span> Trial 20 finished with value: 891129659.8191046 and parameters: {&#39;learning_rate&#39;: 0.14999053695281084, &#39;n_estimators&#39;: 20000, &#39;reg_lambda&#39;: 1.2704296846435246e-07, &#39;reg_alpha&#39;: 0.0008225883615747367, &#39;subsample&#39;: 0.3240920022885547, &#39;colsample_bytree&#39;: 0.9965396149951824, &#39;max_depth&#39;: 7, &#39;early_stopping_rounds&#39;: 106, &#39;tree_method&#39;: &#39;hist&#39;, &#39;booster&#39;: &#39;gbtree&#39;, &#39;gamma&#39;: 0.0002518451571799014, &#39;grow_policy&#39;: &#39;depthwise&#39;}. Best is trial 0 with value: 607032267.1056623.
2021-12-06 21:05:55,585 INFO Training Started!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[21:05:55] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { early_stopping_rounds, eval_set } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 21:07:12,858 INFO Training Ended!
2021-12-06 21:07:12,949 INFO mean_absolute_error: 15295.217291845034
2021-12-06 21:07:12,950 INFO mean_squared_error: 629518554.1992229
2021-12-06 21:07:12,950 INFO r2_score: 0.917928059746747
<span class="ansi-green-fg">[I 2021-12-06 21:07:13,025]</span> Trial 21 finished with value: 629518554.1992229 and parameters: {&#39;learning_rate&#39;: 0.016262149275948868, &#39;n_estimators&#39;: 20000, &#39;reg_lambda&#39;: 3.0602182797930273, &#39;reg_alpha&#39;: 4.28112054954546e-05, &#39;subsample&#39;: 0.5976621107062762, &#39;colsample_bytree&#39;: 0.8189821798104691, &#39;max_depth&#39;: 5, &#39;early_stopping_rounds&#39;: 183, &#39;tree_method&#39;: &#39;hist&#39;, &#39;booster&#39;: &#39;gbtree&#39;, &#39;gamma&#39;: 0.09996502741004878, &#39;grow_policy&#39;: &#39;lossguide&#39;}. Best is trial 0 with value: 607032267.1056623.
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>FrozenTrial(number=0, values=[607032267.1056623], datetime_start=datetime.datetime(2021, 12, 6, 20, 42, 39, 63725), datetime_complete=datetime.datetime(2021, 12, 6, 20, 42, 55, 16274), params={&#39;booster&#39;: &#39;gbtree&#39;, &#39;colsample_bytree&#39;: 0.8467533640596729, &#39;early_stopping_rounds&#39;: 156, &#39;gamma&#39;: 0.048829460890126776, &#39;grow_policy&#39;: &#39;lossguide&#39;, &#39;learning_rate&#39;: 0.14978041444389834, &#39;max_depth&#39;: 4, &#39;n_estimators&#39;: 7000, &#39;reg_alpha&#39;: 4.069576449804004e-05, &#39;reg_lambda&#39;: 0.00014406316350951595, &#39;subsample&#39;: 0.4839769602908782, &#39;tree_method&#39;: &#39;hist&#39;}, distributions={&#39;booster&#39;: CategoricalDistribution(choices=(&#39;gbtree&#39;, &#39;gblinear&#39;)), &#39;colsample_bytree&#39;: UniformDistribution(high=1.0, low=0.1), &#39;early_stopping_rounds&#39;: IntUniformDistribution(high=500, low=100, step=1), &#39;gamma&#39;: LogUniformDistribution(high=1.0, low=1e-08), &#39;grow_policy&#39;: CategoricalDistribution(choices=(&#39;depthwise&#39;, &#39;lossguide&#39;)), &#39;learning_rate&#39;: LogUniformDistribution(high=0.25, low=0.01), &#39;max_depth&#39;: IntUniformDistribution(high=9, low=1, step=1), &#39;n_estimators&#39;: CategoricalDistribution(choices=(7000, 15000, 20000)), &#39;reg_alpha&#39;: LogUniformDistribution(high=100.0, low=1e-08), &#39;reg_lambda&#39;: LogUniformDistribution(high=100.0, low=1e-08), &#39;subsample&#39;: UniformDistribution(high=1.0, low=0.1), &#39;tree_method&#39;: CategoricalDistribution(choices=(&#39;exact&#39;, &#39;approx&#39;, &#39;hist&#39;))}, user_attrs={}, system_attrs={}, intermediate_values={}, trial_id=1, state=TrialState.COMPLETE, value=None)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Let's-use-our-newly-found-best-params-to-update-the-model-on-sklearn-pipeline">Let's use our newly found best params to update the model on sklearn pipeline<a class="anchor-link" href="#Let's-use-our-newly-found-best-params-to-update-the-model-on-sklearn-pipeline"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xgb_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">study</span><span class="o">.</span><span class="n">best_trial</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;xgb_params&quot;</span><span class="p">,</span> <span class="n">xgb_params</span><span class="p">)</span>
<span class="n">updated_xgb_model</span> <span class="o">=</span> <span class="n">XGBRegressor</span><span class="p">(</span><span class="o">**</span><span class="n">xgb_params</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>xgb_params {&#39;learning_rate&#39;: 0.14978041444389834, &#39;use_label_encoder&#39;: False, &#39;eval_metric&#39;: &#39;rmse&#39;, &#39;random_state&#39;: 42, &#39;booster&#39;: &#39;gbtree&#39;, &#39;colsample_bytree&#39;: 0.8467533640596729, &#39;early_stopping_rounds&#39;: 156, &#39;gamma&#39;: 0.048829460890126776, &#39;grow_policy&#39;: &#39;lossguide&#39;, &#39;max_depth&#39;: 4, &#39;n_estimators&#39;: 7000, &#39;reg_alpha&#39;: 4.069576449804004e-05, &#39;reg_lambda&#39;: 0.00014406316350951595, &#39;subsample&#39;: 0.4839769602908782, &#39;tree_method&#39;: &#39;hist&#39;}
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Now,-Let's-use-5-K-Fold-Training-on-this-Updated-XGB-model-with-best-params-found-from-Optuna-search">Now, Let's use 5 K-Fold Training on this Updated XGB model with best params found from Optuna search<a class="anchor-link" href="#Now,-Let's-use-5-K-Fold-Training-on-this-Updated-XGB-model-with-best-params-found-from-Optuna-search"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># xgb_model_metrics_score, xgb_model_test_preds = tmlt.do_kfold_training(X_np, y_np, n_splits=5, model=xgb_model, test_preds_metric=mean_absolute_error)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1"># k-fold training</span>
<span class="n">xgb_model_metrics_score</span><span class="p">,</span> <span class="n">xgb_model_test_preds</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">do_kfold_training</span><span class="p">(</span><span class="n">X_np</span><span class="p">,</span> <span class="n">y_np</span><span class="p">,</span> <span class="n">X_test</span><span class="o">=</span><span class="n">X_test_np</span><span class="p">,</span> <span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">updated_xgb_model</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 21:07:13,069 INFO  model class:&lt;class &#39;xgboost.sklearn.XGBRegressor&#39;&gt;
/Users/pankajmathur/anaconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/model_selection/_split.py:676: UserWarning: The least populated class in y has only 1 members, which is less than n_splits=5.
  warnings.warn(
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[21:07:13] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { early_stopping_rounds } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 21:07:33,568 INFO Predicting Score!
2021-12-06 21:07:33,577 INFO fold: 1 mean_absolute_error : 20715.247458261987
2021-12-06 21:07:33,577 INFO fold: 1 mean_squared_error : 2957095332.886548
2021-12-06 21:07:33,578 INFO fold: 1 r2_score : 0.4896348241260975
2021-12-06 21:07:33,579 INFO Predicting Test Scores!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[21:07:33] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { early_stopping_rounds } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 21:07:53,660 INFO Predicting Score!
2021-12-06 21:07:53,668 INFO fold: 2 mean_absolute_error : 16294.310145547945
2021-12-06 21:07:53,669 INFO fold: 2 mean_squared_error : 830363243.5137496
2021-12-06 21:07:53,669 INFO fold: 2 r2_score : 0.8520142405786058
2021-12-06 21:07:53,670 INFO Predicting Test Scores!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[21:07:53] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { early_stopping_rounds } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 21:08:14,639 INFO Predicting Score!
2021-12-06 21:08:14,648 INFO fold: 3 mean_absolute_error : 16816.43455693493
2021-12-06 21:08:14,649 INFO fold: 3 mean_squared_error : 710149427.4676694
2021-12-06 21:08:14,649 INFO fold: 3 r2_score : 0.9067089553667816
2021-12-06 21:08:14,650 INFO Predicting Test Scores!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[21:08:14] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { early_stopping_rounds } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 21:08:33,527 INFO Predicting Score!
2021-12-06 21:08:33,536 INFO fold: 4 mean_absolute_error : 15824.842572773972
2021-12-06 21:08:33,536 INFO fold: 4 mean_squared_error : 523051432.0483315
2021-12-06 21:08:33,537 INFO fold: 4 r2_score : 0.9062322810198855
2021-12-06 21:08:33,537 INFO Predicting Test Scores!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[21:08:33] WARNING: /Users/travis/build/dmlc/xgboost/src/learner.cc:541: 
Parameters: { early_stopping_rounds } might not be used.

  This may not be accurate due to some parameters are only used in language bindings but
  passed down to XGBoost core.  Or some parameters are not used but slip through this
  verification. Please open an issue if you find above cases.


</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-12-06 21:08:54,259 INFO Predicting Score!
2021-12-06 21:08:54,266 INFO fold: 5 mean_absolute_error : 16750.133160316782
2021-12-06 21:08:54,267 INFO fold: 5 mean_squared_error : 843596693.0681775
2021-12-06 21:08:54,268 INFO fold: 5 r2_score : 0.876985526050572
2021-12-06 21:08:54,268 INFO Predicting Test Scores!
2021-12-06 21:08:54,297 INFO  Mean Metrics Results from all Folds are: {&#39;mean_absolute_error&#39;: 17280.193578767125, &#39;mean_squared_error&#39;: 1172851225.7968953, &#39;r2_score&#39;: 0.8063151654283884}
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 11min 50s, sys: 12.4 s, total: 12min 2s
Wall time: 1min 41s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">xgb_model_test_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">xgb_model_test_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1459,)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="You-can-even-improve-metrics-score-further-by-running-Optuna-search-for-longer-time-or-rerunning-the-study,-check-documentation-for-more-details">You can even improve metrics score further by running Optuna search for longer time or rerunning the study, check documentation for more details<a class="anchor-link" href="#You-can-even-improve-metrics-score-further-by-running-Optuna-search-for-longer-time-or-rerunning-the-study,-check-documentation-for-more-details"> </a></h5>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

