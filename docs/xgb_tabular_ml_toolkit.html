---

title: Getting Started Kaggle TPS Challenge with Tabular ML Toolkit


keywords: fastai
sidebar: home_sidebar

summary: "A Tutorial to showcase usage of tabular_ml_toolkit library on Kaggle TPS Challenge Nov 2021."
description: "A Tutorial to showcase usage of tabular_ml_toolkit library on Kaggle TPS Challenge Nov 2021."
nb_path: "xgb_tabular_ml_toolkit.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: xgb_tabular_ml_toolkit.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install">Install<a class="anchor-link" href="#Install"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>pip install -U tabular_ml_toolkit</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">tabular_ml_toolkit.tmlt</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># for visualizing pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">set_config</span>
<span class="n">set_config</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s2">&quot;diagram&quot;</span><span class="p">)</span>

<span class="c1"># just to measure fit performance</span>
<span class="kn">import</span> <span class="nn">time</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">accuracy_score</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="For-Dataset,-Mount-Google-Drive">For Dataset, Mount Google Drive<a class="anchor-link" href="#For-Dataset,-Mount-Google-Drive"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># drive.mount(&#39;/content/gdrive/&#39;)</span>
<span class="c1"># # drive.mount(&#39;/content/gdrive/&#39;, force_remount=True)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># COLAB_BASE_PATH = &#39;/content/gdrive/MyDrive/pankaj_dev/kaggle&#39;</span>
<span class="c1"># os.listdir(COLAB_BASE_PATH)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># DIRECTORY_PATH = COLAB_BASE_PATH +&quot;/tabular/tps_nov_2021/input/&quot;</span>
<span class="c1"># TRAIN_FILE = &quot;train.csv&quot;</span>
<span class="c1"># TEST_FILE = &quot;test.csv&quot;</span>
<span class="c1"># SAMPLE_SUB_FILE = &quot;sample_submission.csv&quot;</span>
<span class="c1"># OUTPUT_PATH = COLAB_BASE_PATH + &quot;/tabular/tps_nov_2021/output/&quot;</span>
<span class="c1"># os.listdir(DIRECTORY_PATH)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DIRECTORY_PATH</span> <span class="o">=</span> <span class="s2">&quot;/Users/pamathur/kaggle_datasets/tps_nov_2021/&quot;</span>
<span class="n">TRAIN_FILE</span> <span class="o">=</span> <span class="s2">&quot;train.csv&quot;</span>
<span class="n">TEST_FILE</span> <span class="o">=</span> <span class="s2">&quot;test.csv&quot;</span>
<span class="n">SAMPLE_SUB_FILE</span> <span class="o">=</span> <span class="s2">&quot;sample_submission.csv&quot;</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="s2">&quot;kaggle_tps_output/&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Create-a-base-sklearn-model">Create a base sklearn model<a class="anchor-link" href="#Create-a-base-sklearn-model"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="n">log_reg_model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmlt</span> <span class="o">=</span> <span class="n">TMLT</span><span class="p">()</span><span class="o">.</span><span class="n">prepare_data_for_training</span><span class="p">(</span>
    <span class="n">train_file_path</span><span class="o">=</span> <span class="n">DIRECTORY_PATH</span> <span class="o">+</span> <span class="n">TRAIN_FILE</span><span class="p">,</span>
    <span class="n">test_file_path</span><span class="o">=</span> <span class="n">DIRECTORY_PATH</span> <span class="o">+</span> <span class="n">TEST_FILE</span><span class="p">,</span>
    <span class="c1">#make sure to use right index and target columns</span>
    <span class="n">idx_col</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span>
    <span class="n">target</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="n">log_reg_model</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
    <span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;binary_classification&quot;</span><span class="p">,</span>
    <span class="n">nrows</span><span class="o">=</span><span class="mi">4000</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-11-28 17:41:05,158 INFO 12 cores found, model and data parallel processing should worked!
2021-11-28 17:41:05,273 INFO DataFrame Memory usage decreased to 0.80 Mb (74.4% reduction)
2021-11-28 17:41:05,420 INFO DataFrame Memory usage decreased to 0.79 Mb (74.3% reduction)
2021-11-28 17:41:05,475 INFO categorical columns are None, Preprocessing will done accordingly!
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmlt</span><span class="o">.</span><span class="n">spl</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<style>#sk-fe8cff63-8d47-4df7-98db-65461e127f9d {color: black;background-color: white;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d pre{padding: 0;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d div.sk-toggleable {background-color: white;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d div.sk-estimator:hover {background-color: #d4ebff;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d div.sk-item {z-index: 1;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d div.sk-parallel-item:only-child::after {width: 0;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-fe8cff63-8d47-4df7-98db-65461e127f9d div.sk-container {display: inline-block;position: relative;}</style><div id="sk-fe8cff63-8d47-4df7-98db-65461e127f9d" class"sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ff0db876-d360-425f-adfd-35a895372764" type="checkbox" ><label class="sk-toggleable__label" for="ff0db876-d360-425f-adfd-35a895372764">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(memory='pipeline_cache_dir',
         steps=[('preprocessor',
                 ColumnTransformer(transformers=[('num_cols',
                                                  Pipeline(memory='pipeline_cache_dir',
                                                           steps=[('imputer',
                                                                   SimpleImputer(strategy='constant')),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  ['f0', 'f1', 'f2', 'f3', 'f4',
                                                   'f5', 'f6', 'f7', 'f8', 'f9',
                                                   'f10', 'f11', 'f12', 'f13',
                                                   'f14', 'f15', 'f16', 'f17',
                                                   'f18', 'f19', 'f20', 'f21',
                                                   'f22', 'f23', 'f24', 'f25',
                                                   'f26', 'f27', 'f28', 'f29', ...])])),
                ('model',
                 LogisticRegression(n_jobs=11, random_state=42,
                                    solver='liblinear'))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c8485d48-76d8-436c-a0b6-4d26e992fc4b" type="checkbox" ><label class="sk-toggleable__label" for="c8485d48-76d8-436c-a0b6-4d26e992fc4b">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('num_cols',
                                 Pipeline(memory='pipeline_cache_dir',
                                          steps=[('imputer',
                                                  SimpleImputer(strategy='constant')),
                                                 ('scaler', StandardScaler())]),
                                 ['f0', 'f1', 'f2', 'f3', 'f4', 'f5', 'f6',
                                  'f7', 'f8', 'f9', 'f10', 'f11', 'f12', 'f13',
                                  'f14', 'f15', 'f16', 'f17', 'f18', 'f19',
                                  'f20', 'f21', 'f22', 'f23', 'f24', 'f25',
                                  'f26', 'f27', 'f28', 'f29', ...])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7fe0923b-0bdd-467d-b3b6-e72bb4ec55b8" type="checkbox" ><label class="sk-toggleable__label" for="7fe0923b-0bdd-467d-b3b6-e72bb4ec55b8">num_cols</label><div class="sk-toggleable__content"><pre>['f0', 'f1', 'f2', 'f3', 'f4', 'f5', 'f6', 'f7', 'f8', 'f9', 'f10', 'f11', 'f12', 'f13', 'f14', 'f15', 'f16', 'f17', 'f18', 'f19', 'f20', 'f21', 'f22', 'f23', 'f24', 'f25', 'f26', 'f27', 'f28', 'f29', 'f30', 'f31', 'f32', 'f33', 'f34', 'f35', 'f36', 'f37', 'f38', 'f39', 'f40', 'f41', 'f42', 'f43', 'f44', 'f45', 'f46', 'f47', 'f48', 'f49', 'f50', 'f51', 'f52', 'f53', 'f54', 'f55', 'f56', 'f57', 'f58', 'f59', 'f60', 'f61', 'f62', 'f63', 'f64', 'f65', 'f66', 'f67', 'f68', 'f69', 'f70', 'f71', 'f72', 'f73', 'f74', 'f75', 'f76', 'f77', 'f78', 'f79', 'f80', 'f81', 'f82', 'f83', 'f84', 'f85', 'f86', 'f87', 'f88', 'f89', 'f90', 'f91', 'f92', 'f93', 'f94', 'f95', 'f96', 'f97', 'f98', 'f99']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="183da0a5-1cc6-43ea-a738-a0a7fcc57bdb" type="checkbox" ><label class="sk-toggleable__label" for="183da0a5-1cc6-43ea-a738-a0a7fcc57bdb">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="07dd8653-4355-4e0c-8ba8-53ff0110943b" type="checkbox" ><label class="sk-toggleable__label" for="07dd8653-4355-4e0c-8ba8-53ff0110943b">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="60548424-ad59-4e3a-b45d-cd4a2275e516" type="checkbox" ><label class="sk-toggleable__label" for="60548424-ad59-4e3a-b45d-cd4a2275e516">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(n_jobs=11, random_state=42, solver='liblinear')</pre></div></div></div></div></div></div></div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Let's-do-a-quick-round-of-training">Let's do a quick round of training<a class="anchor-link" href="#Let's-do-a-quick-round-of-training"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">create_train_valid</span><span class="p">(</span><span class="n">valid_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># print(f&quot;X_train shape is {tmlt.dfl.X_train.shape}&quot; )</span>
<span class="c1"># print(f&quot;X_valid shape is {tmlt.dfl.X_valid.shape}&quot; )</span>
<span class="c1"># print(f&quot;y_train shape is {tmlt.dfl.y_train.shape}&quot;)</span>
<span class="c1"># print(f&quot;y_valid shape is {tmlt.dfl.y_valid.shape}&quot;)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">tmlt</span><span class="o">.</span><span class="n">spl</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_train</span><span class="p">,</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fit Time:&quot;</span><span class="p">,</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>

<span class="c1">#predict</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">spl</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_valid</span><span class="p">)</span>
<span class="n">preds_probs</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">spl</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_valid</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="c1"># Val Metrics</span>
<span class="n">auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds_probs</span><span class="p">)</span>
<span class="n">acc</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AUC is : </span><span class="si">{</span><span class="n">auc</span><span class="si">}</span><span class="s2"> while Accuracy is : </span><span class="si">{</span><span class="n">acc</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/linear_model/_logistic.py:1523: UserWarning: &#39;n_jobs&#39; &gt; 1 does not have any effect when &#39;solver&#39; is set to &#39;liblinear&#39;. Got &#39;n_jobs&#39; = 11.
  warnings.warn(
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Fit Time: 0.11430573463439941
AUC is : 0.7159750818287403 while Accuracy is : 0.695 
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="For-Meta-Ensemble-Models-Training">For Meta Ensemble Models Training<a class="anchor-link" href="#For-Meta-Ensemble-Models-Training"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Base-Model-1:-linear-SVM-model">Base Model 1: linear SVM model<a class="anchor-link" href="#Base-Model-1:-linear-SVM-model"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">LinearSVC</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#choose model</span>
<span class="n">linear_oof_model</span> <span class="o">=</span> <span class="n">LinearSVC</span><span class="p">(</span><span class="n">tol</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">,</span> <span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span> <span class="n">dual</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1">#update the model on sklearn pipeline and get update skline pipeline back</span>
<span class="n">tmlt</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">update_model</span><span class="p">(</span><span class="n">linear_oof_model</span><span class="p">)</span>

<span class="c1"># let see pipeline</span>
<span class="n">tmlt</span><span class="o">.</span><span class="n">spl</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<style>#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf {color: black;background-color: white;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf pre{padding: 0;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf div.sk-toggleable {background-color: white;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf div.sk-estimator:hover {background-color: #d4ebff;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf div.sk-item {z-index: 1;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf div.sk-parallel-item:only-child::after {width: 0;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-a6668a81-53bd-4ecd-b1af-a423aced61cf div.sk-container {display: inline-block;position: relative;}</style><div id="sk-a6668a81-53bd-4ecd-b1af-a423aced61cf" class"sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="cc0e75d7-709f-4a43-b884-82d6a9c739fa" type="checkbox" ><label class="sk-toggleable__label" for="cc0e75d7-709f-4a43-b884-82d6a9c739fa">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(memory='pipeline_cache_dir',
         steps=[('preprocessor',
                 ColumnTransformer(transformers=[('num_cols',
                                                  Pipeline(memory='pipeline_cache_dir',
                                                           steps=[('imputer',
                                                                   SimpleImputer(strategy='constant')),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  ['f0', 'f1', 'f2', 'f3', 'f4',
                                                   'f5', 'f6', 'f7', 'f8', 'f9',
                                                   'f10', 'f11', 'f12', 'f13',
                                                   'f14', 'f15', 'f16', 'f17',
                                                   'f18', 'f19', 'f20', 'f21',
                                                   'f22', 'f23', 'f24', 'f25',
                                                   'f26', 'f27', 'f28', 'f29', ...])])),
                ('model',
                 LinearSVC(dual=False, max_iter=2000, random_state=42,
                           tol=1e-07))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="127bc530-9fa2-4fa1-8891-c81628f16688" type="checkbox" ><label class="sk-toggleable__label" for="127bc530-9fa2-4fa1-8891-c81628f16688">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('num_cols',
                                 Pipeline(memory='pipeline_cache_dir',
                                          steps=[('imputer',
                                                  SimpleImputer(strategy='constant')),
                                                 ('scaler', StandardScaler())]),
                                 ['f0', 'f1', 'f2', 'f3', 'f4', 'f5', 'f6',
                                  'f7', 'f8', 'f9', 'f10', 'f11', 'f12', 'f13',
                                  'f14', 'f15', 'f16', 'f17', 'f18', 'f19',
                                  'f20', 'f21', 'f22', 'f23', 'f24', 'f25',
                                  'f26', 'f27', 'f28', 'f29', ...])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="15cda2f3-4f1c-4b75-aac0-3d2b3a182f53" type="checkbox" ><label class="sk-toggleable__label" for="15cda2f3-4f1c-4b75-aac0-3d2b3a182f53">num_cols</label><div class="sk-toggleable__content"><pre>['f0', 'f1', 'f2', 'f3', 'f4', 'f5', 'f6', 'f7', 'f8', 'f9', 'f10', 'f11', 'f12', 'f13', 'f14', 'f15', 'f16', 'f17', 'f18', 'f19', 'f20', 'f21', 'f22', 'f23', 'f24', 'f25', 'f26', 'f27', 'f28', 'f29', 'f30', 'f31', 'f32', 'f33', 'f34', 'f35', 'f36', 'f37', 'f38', 'f39', 'f40', 'f41', 'f42', 'f43', 'f44', 'f45', 'f46', 'f47', 'f48', 'f49', 'f50', 'f51', 'f52', 'f53', 'f54', 'f55', 'f56', 'f57', 'f58', 'f59', 'f60', 'f61', 'f62', 'f63', 'f64', 'f65', 'f66', 'f67', 'f68', 'f69', 'f70', 'f71', 'f72', 'f73', 'f74', 'f75', 'f76', 'f77', 'f78', 'f79', 'f80', 'f81', 'f82', 'f83', 'f84', 'f85', 'f86', 'f87', 'f88', 'f89', 'f90', 'f91', 'f92', 'f93', 'f94', 'f95', 'f96', 'f97', 'f98', 'f99']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b948c5e4-8384-4caf-96ad-200330c6ab2e" type="checkbox" ><label class="sk-toggleable__label" for="b948c5e4-8384-4caf-96ad-200330c6ab2e">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="cd75002b-0ba9-488c-81d7-bb775b67e8ec" type="checkbox" ><label class="sk-toggleable__label" for="cd75002b-0ba9-488c-81d7-bb775b67e8ec">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="54dafc6e-063b-47ca-bf62-9cc5421c1b38" type="checkbox" ><label class="sk-toggleable__label" for="54dafc6e-063b-47ca-bf62-9cc5421c1b38">LinearSVC</label><div class="sk-toggleable__content"><pre>LinearSVC(dual=False, max_iter=2000, random_state=42, tol=1e-07)</pre></div></div></div></div></div></div></div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">linear_oof_model_preds</span><span class="p">,</span> <span class="n">linear_oof_model_test_preds</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">do_oof_kfold_train_preds</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="k">if</span> <span class="n">linear_oof_model_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">linear_oof_model_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="k">if</span> <span class="n">linear_oof_model_test_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>    
    <span class="nb">print</span><span class="p">(</span><span class="n">linear_oof_model_test_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but LinearSVC was fitted without feature names
  warnings.warn(
2021-11-28 17:41:05,868 INFO fold: 1 OOF Model ROC AUC: 0.5420631850419084!
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but LinearSVC was fitted without feature names
  warnings.warn(
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but LinearSVC was fitted without feature names
  warnings.warn(
2021-11-28 17:41:05,989 INFO fold: 2 OOF Model ROC AUC: 0.569651837524178!
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but LinearSVC was fitted without feature names
  warnings.warn(
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but LinearSVC was fitted without feature names
  warnings.warn(
2021-11-28 17:41:06,138 INFO fold: 3 OOF Model ROC AUC: 0.5094906511927788!
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but LinearSVC was fitted without feature names
  warnings.warn(
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but LinearSVC was fitted without feature names
  warnings.warn(
2021-11-28 17:41:06,256 INFO fold: 4 OOF Model ROC AUC: 0.4881634125445281!
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but LinearSVC was fitted without feature names
  warnings.warn(
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but LinearSVC was fitted without feature names
  warnings.warn(
2021-11-28 17:41:06,386 INFO fold: 5 OOF Model ROC AUC: 0.5443219809455098!
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but LinearSVC was fitted without feature names
  warnings.warn(
2021-11-28 17:41:06,392 INFO Mean OOF Model ROC AUC: 0.5307382134497807!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000,)
(4000,)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Base-Model-2:-Logistic-Regression-Model">Base Model 2: Logistic Regression Model<a class="anchor-link" href="#Base-Model-2:-Logistic-Regression-Model"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#choose model</span>
<span class="n">log_oof_model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1">#update the model on sklearn pipeline</span>
<span class="n">tmlt</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">update_model</span><span class="p">(</span><span class="n">log_oof_model</span><span class="p">)</span>

<span class="c1">#fit and predict</span>
<span class="n">log_oof_model_preds</span><span class="p">,</span> <span class="n">log_oof_model_test_preds</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">do_oof_kfold_train_preds</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="k">if</span> <span class="n">log_oof_model_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">log_oof_model_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="k">if</span> <span class="n">log_oof_model_test_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>    
    <span class="nb">print</span><span class="p">(</span><span class="n">log_oof_model_test_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but LogisticRegression was fitted without feature names
  warnings.warn(
2021-11-28 17:41:06,531 INFO fold: 1 OOF Model ROC AUC: 0.5431270148291425!
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but LogisticRegression was fitted without feature names
  warnings.warn(
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but LogisticRegression was fitted without feature names
  warnings.warn(
2021-11-28 17:41:06,662 INFO fold: 2 OOF Model ROC AUC: 0.570896196002579!
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but LogisticRegression was fitted without feature names
  warnings.warn(
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but LogisticRegression was fitted without feature names
  warnings.warn(
2021-11-28 17:41:06,811 INFO fold: 3 OOF Model ROC AUC: 0.5097678916827854!
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but LogisticRegression was fitted without feature names
  warnings.warn(
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but LogisticRegression was fitted without feature names
  warnings.warn(
2021-11-28 17:41:06,938 INFO fold: 4 OOF Model ROC AUC: 0.4884726131964262!
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but LogisticRegression was fitted without feature names
  warnings.warn(
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but LogisticRegression was fitted without feature names
  warnings.warn(
2021-11-28 17:41:07,065 INFO fold: 5 OOF Model ROC AUC: 0.5453397664246742!
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but LogisticRegression was fitted without feature names
  warnings.warn(
2021-11-28 17:41:07,071 INFO Mean OOF Model ROC AUC: 0.5315206964271214!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000,)
(4000,)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Base-Model-3:-SKLearn-MLP">Base Model 3: SKLearn MLP<a class="anchor-link" href="#Base-Model-3:-SKLearn-MLP"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.neural_network</span> <span class="kn">import</span> <span class="n">MLPClassifier</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#choose model</span>
<span class="n">mlp_oof_model</span> <span class="o">=</span> <span class="n">MLPClassifier</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">early_stopping</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#update the model on sklearn pipeline</span>
<span class="n">tmlt</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">update_model</span><span class="p">(</span><span class="n">mlp_oof_model</span><span class="p">)</span>


<span class="c1">#fit and predict</span>
<span class="n">mlp_oof_model_preds</span><span class="p">,</span> <span class="n">mlp_oof_model_test_preds</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">do_oof_kfold_train_preds</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="k">if</span> <span class="n">mlp_oof_model_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">mlp_oof_model_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="k">if</span> <span class="n">mlp_oof_model_test_preds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>    
    <span class="nb">print</span><span class="p">(</span><span class="n">mlp_oof_model_test_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but MLPClassifier was fitted without feature names
  warnings.warn(
2021-11-28 17:41:07,510 INFO fold: 1 OOF Model ROC AUC: 0.5425145067698259!
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but MLPClassifier was fitted without feature names
  warnings.warn(
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but MLPClassifier was fitted without feature names
  warnings.warn(
2021-11-28 17:41:07,902 INFO fold: 2 OOF Model ROC AUC: 0.5555738233397807!
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but MLPClassifier was fitted without feature names
  warnings.warn(
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but MLPClassifier was fitted without feature names
  warnings.warn(
2021-11-28 17:41:08,296 INFO fold: 3 OOF Model ROC AUC: 0.5118568665377177!
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but MLPClassifier was fitted without feature names
  warnings.warn(
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but MLPClassifier was fitted without feature names
  warnings.warn(
2021-11-28 17:41:08,760 INFO fold: 4 OOF Model ROC AUC: 0.4969756311236223!
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but MLPClassifier was fitted without feature names
  warnings.warn(
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but MLPClassifier was fitted without feature names
  warnings.warn(
2021-11-28 17:41:09,368 INFO fold: 5 OOF Model ROC AUC: 0.53995452173745!
/Users/pamathur/miniconda3/envs/nbdev_env/lib/python3.9/site-packages/sklearn/base.py:434: UserWarning: X has feature names, but MLPClassifier was fitted without feature names
  warnings.warn(
2021-11-28 17:41:09,382 INFO Mean OOF Model ROC AUC: 0.5293750699016794!
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000,)
(4000,)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Now-add-back-based-models-predictions-to-X-and-X_test">Now add back based models predictions to X and X_test<a class="anchor-link" href="#Now-add-back-based-models-predictions-to-X-and-X_test"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;linear_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linear_oof_model_preds</span>
<span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;linear_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linear_oof_model_test_preds</span>

<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000, 101)
(4000, 101)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;log_reg_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_oof_model_preds</span>
<span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;log_reg_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_oof_model_test_preds</span>

<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000, 102)
(4000, 102)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;mlp_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mlp_oof_model_preds</span>
<span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;mlp_preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mlp_oof_model_test_preds</span>

<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000, 103)
(4000, 103)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmlt</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">update_dfl</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">tmlt</span><span class="o">.</span><span class="n">spl</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-11-28 17:41:09,474 INFO categorical columns are None, Preprocessing will done accordingly!
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<style>#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 {color: black;background-color: white;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 pre{padding: 0;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 div.sk-toggleable {background-color: white;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 div.sk-estimator:hover {background-color: #d4ebff;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 div.sk-item {z-index: 1;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 div.sk-parallel-item:only-child::after {width: 0;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273 div.sk-container {display: inline-block;position: relative;}</style><div id="sk-de95ae31-2f7e-43ba-a5b5-6aa157dca273" class"sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="20e1b613-e87d-4a63-a377-ae93ac3324cc" type="checkbox" ><label class="sk-toggleable__label" for="20e1b613-e87d-4a63-a377-ae93ac3324cc">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(memory='pipeline_cache_dir',
         steps=[('preprocessor',
                 ColumnTransformer(transformers=[('num_cols',
                                                  Pipeline(memory='pipeline_cache_dir',
                                                           steps=[('imputer',
                                                                   SimpleImputer(strategy='median')),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  ['f0', 'f1', 'f2', 'f3', 'f4',
                                                   'f5', 'f6', 'f7', 'f8', 'f9',
                                                   'f10', 'f11', 'f12', 'f13',
                                                   'f14', 'f15', 'f16', 'f17',
                                                   'f18', 'f19', 'f20', 'f21',
                                                   'f22', 'f23', 'f24', 'f25',
                                                   'f26', 'f27', 'f28', 'f29', ...])])),
                ('model', MLPClassifier(early_stopping=True, max_iter=1000))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="617c62a4-af63-4867-99ea-bcf1be737b88" type="checkbox" ><label class="sk-toggleable__label" for="617c62a4-af63-4867-99ea-bcf1be737b88">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('num_cols',
                                 Pipeline(memory='pipeline_cache_dir',
                                          steps=[('imputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('scaler', StandardScaler())]),
                                 ['f0', 'f1', 'f2', 'f3', 'f4', 'f5', 'f6',
                                  'f7', 'f8', 'f9', 'f10', 'f11', 'f12', 'f13',
                                  'f14', 'f15', 'f16', 'f17', 'f18', 'f19',
                                  'f20', 'f21', 'f22', 'f23', 'f24', 'f25',
                                  'f26', 'f27', 'f28', 'f29', ...])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4ddf9785-c145-407c-9d29-299b2cee6b41" type="checkbox" ><label class="sk-toggleable__label" for="4ddf9785-c145-407c-9d29-299b2cee6b41">num_cols</label><div class="sk-toggleable__content"><pre>['f0', 'f1', 'f2', 'f3', 'f4', 'f5', 'f6', 'f7', 'f8', 'f9', 'f10', 'f11', 'f12', 'f13', 'f14', 'f15', 'f16', 'f17', 'f18', 'f19', 'f20', 'f21', 'f22', 'f23', 'f24', 'f25', 'f26', 'f27', 'f28', 'f29', 'f30', 'f31', 'f32', 'f33', 'f34', 'f35', 'f36', 'f37', 'f38', 'f39', 'f40', 'f41', 'f42', 'f43', 'f44', 'f45', 'f46', 'f47', 'f48', 'f49', 'f50', 'f51', 'f52', 'f53', 'f54', 'f55', 'f56', 'f57', 'f58', 'f59', 'f60', 'f61', 'f62', 'f63', 'f64', 'f65', 'f66', 'f67', 'f68', 'f69', 'f70', 'f71', 'f72', 'f73', 'f74', 'f75', 'f76', 'f77', 'f78', 'f79', 'f80', 'f81', 'f82', 'f83', 'f84', 'f85', 'f86', 'f87', 'f88', 'f89', 'f90', 'f91', 'f92', 'f93', 'f94', 'f95', 'f96', 'f97', 'f98', 'f99', 'linear_preds', 'log_reg_preds', 'mlp_preds']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7b309381-5201-4efc-ab36-1efa2a8651a9" type="checkbox" ><label class="sk-toggleable__label" for="7b309381-5201-4efc-ab36-1efa2a8651a9">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='median')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="0bc380b2-07d2-42b2-9d0d-df8b1b62b6c7" type="checkbox" ><label class="sk-toggleable__label" for="0bc380b2-07d2-42b2-9d0d-df8b1b62b6c7">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="315ea0c4-4b52-484a-820f-fe937c5bd044" type="checkbox" ><label class="sk-toggleable__label" for="315ea0c4-4b52-484a-820f-fe937c5bd044">MLPClassifier</label><div class="sk-toggleable__content"><pre>MLPClassifier(early_stopping=True, max_iter=1000)</pre></div></div></div></div></div></div></div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;f0&#39;, &#39;f1&#39;, &#39;f2&#39;, &#39;f3&#39;, &#39;f4&#39;, &#39;f5&#39;, &#39;f6&#39;, &#39;f7&#39;, &#39;f8&#39;, &#39;f9&#39;, &#39;f10&#39;, &#39;f11&#39;, &#39;f12&#39;, &#39;f13&#39;, &#39;f14&#39;, &#39;f15&#39;, &#39;f16&#39;, &#39;f17&#39;, &#39;f18&#39;, &#39;f19&#39;, &#39;f20&#39;, &#39;f21&#39;, &#39;f22&#39;, &#39;f23&#39;, &#39;f24&#39;, &#39;f25&#39;, &#39;f26&#39;, &#39;f27&#39;, &#39;f28&#39;, &#39;f29&#39;, &#39;f30&#39;, &#39;f31&#39;, &#39;f32&#39;, &#39;f33&#39;, &#39;f34&#39;, &#39;f35&#39;, &#39;f36&#39;, &#39;f37&#39;, &#39;f38&#39;, &#39;f39&#39;, &#39;f40&#39;, &#39;f41&#39;, &#39;f42&#39;, &#39;f43&#39;, &#39;f44&#39;, &#39;f45&#39;, &#39;f46&#39;, &#39;f47&#39;, &#39;f48&#39;, &#39;f49&#39;, &#39;f50&#39;, &#39;f51&#39;, &#39;f52&#39;, &#39;f53&#39;, &#39;f54&#39;, &#39;f55&#39;, &#39;f56&#39;, &#39;f57&#39;, &#39;f58&#39;, &#39;f59&#39;, &#39;f60&#39;, &#39;f61&#39;, &#39;f62&#39;, &#39;f63&#39;, &#39;f64&#39;, &#39;f65&#39;, &#39;f66&#39;, &#39;f67&#39;, &#39;f68&#39;, &#39;f69&#39;, &#39;f70&#39;, &#39;f71&#39;, &#39;f72&#39;, &#39;f73&#39;, &#39;f74&#39;, &#39;f75&#39;, &#39;f76&#39;, &#39;f77&#39;, &#39;f78&#39;, &#39;f79&#39;, &#39;f80&#39;, &#39;f81&#39;, &#39;f82&#39;, &#39;f83&#39;, &#39;f84&#39;, &#39;f85&#39;, &#39;f86&#39;, &#39;f87&#39;, &#39;f88&#39;, &#39;f89&#39;, &#39;f90&#39;, &#39;f91&#39;, &#39;f92&#39;, &#39;f93&#39;, &#39;f94&#39;, &#39;f95&#39;, &#39;f96&#39;, &#39;f97&#39;, &#39;f98&#39;, &#39;f99&#39;, &#39;linear_preds&#39;, &#39;log_reg_preds&#39;, &#39;mlp_preds&#39;]
[&#39;f0&#39;, &#39;f1&#39;, &#39;f2&#39;, &#39;f3&#39;, &#39;f4&#39;, &#39;f5&#39;, &#39;f6&#39;, &#39;f7&#39;, &#39;f8&#39;, &#39;f9&#39;, &#39;f10&#39;, &#39;f11&#39;, &#39;f12&#39;, &#39;f13&#39;, &#39;f14&#39;, &#39;f15&#39;, &#39;f16&#39;, &#39;f17&#39;, &#39;f18&#39;, &#39;f19&#39;, &#39;f20&#39;, &#39;f21&#39;, &#39;f22&#39;, &#39;f23&#39;, &#39;f24&#39;, &#39;f25&#39;, &#39;f26&#39;, &#39;f27&#39;, &#39;f28&#39;, &#39;f29&#39;, &#39;f30&#39;, &#39;f31&#39;, &#39;f32&#39;, &#39;f33&#39;, &#39;f34&#39;, &#39;f35&#39;, &#39;f36&#39;, &#39;f37&#39;, &#39;f38&#39;, &#39;f39&#39;, &#39;f40&#39;, &#39;f41&#39;, &#39;f42&#39;, &#39;f43&#39;, &#39;f44&#39;, &#39;f45&#39;, &#39;f46&#39;, &#39;f47&#39;, &#39;f48&#39;, &#39;f49&#39;, &#39;f50&#39;, &#39;f51&#39;, &#39;f52&#39;, &#39;f53&#39;, &#39;f54&#39;, &#39;f55&#39;, &#39;f56&#39;, &#39;f57&#39;, &#39;f58&#39;, &#39;f59&#39;, &#39;f60&#39;, &#39;f61&#39;, &#39;f62&#39;, &#39;f63&#39;, &#39;f64&#39;, &#39;f65&#39;, &#39;f66&#39;, &#39;f67&#39;, &#39;f68&#39;, &#39;f69&#39;, &#39;f70&#39;, &#39;f71&#39;, &#39;f72&#39;, &#39;f73&#39;, &#39;f74&#39;, &#39;f75&#39;, &#39;f76&#39;, &#39;f77&#39;, &#39;f78&#39;, &#39;f79&#39;, &#39;f80&#39;, &#39;f81&#39;, &#39;f82&#39;, &#39;f83&#39;, &#39;f84&#39;, &#39;f85&#39;, &#39;f86&#39;, &#39;f87&#39;, &#39;f88&#39;, &#39;f89&#39;, &#39;f90&#39;, &#39;f91&#39;, &#39;f92&#39;, &#39;f93&#39;, &#39;f94&#39;, &#39;f95&#39;, &#39;f96&#39;, &#39;f97&#39;, &#39;f98&#39;, &#39;f99&#39;, &#39;linear_preds&#39;, &#39;log_reg_preds&#39;, &#39;mlp_preds&#39;]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="For-META-Model-Training-(direct-training-non-tmlt)">For META Model Training (direct training non tmlt)<a class="anchor-link" href="#For-META-Model-Training-(direct-training-non-tmlt)"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xgb_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;objective&#39;</span><span class="p">:</span> <span class="s1">&#39;binary:logistic&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;use_label_encoder&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">40000</span><span class="p">,</span>
    <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="mf">0.18515462875481553</span><span class="p">,</span>
    <span class="s1">&#39;subsample&#39;</span><span class="p">:</span> <span class="mf">0.97</span><span class="p">,</span> 
    <span class="s1">&#39;colsample_bytree&#39;</span><span class="p">:</span> <span class="mf">0.32</span><span class="p">,</span>
    <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;booster&#39;</span><span class="p">:</span> <span class="s1">&#39;gbtree&#39;</span><span class="p">,</span>
    <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="s1">&#39;reg_lambda&#39;</span><span class="p">:</span> <span class="mf">0.11729916523488974</span><span class="p">,</span> 
    <span class="s1">&#39;reg_alpha&#39;</span><span class="p">:</span> <span class="mf">0.6318827156945853</span><span class="p">,</span>
    <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
    <span class="s1">&#39;n_jobs&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> 
    <span class="s1">&#39;min_child_weight&#39;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
    <span class="c1">#for GPU</span>
<span class="c1">#     &#39;tree_method&#39;: &#39;gpu_hist&#39;,</span>
<span class="c1">#     &#39;predictor&#39;: &#39;gpu_predictor&#39;,</span>
    <span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xgb_model</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="o">**</span><span class="n">xgb_params</span><span class="p">)</span>

<span class="c1"># update sklearn pipeline to not to use cache model(estimator)</span>
<span class="n">tmlt</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">update_model</span><span class="p">(</span><span class="n">xgb_model</span><span class="p">)</span>

<span class="c1"># lets see updated sklearn pipeline</span>
<span class="n">tmlt</span><span class="o">.</span><span class="n">spl</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<style>#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df {color: black;background-color: white;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df pre{padding: 0;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df div.sk-toggleable {background-color: white;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df div.sk-estimator:hover {background-color: #d4ebff;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df div.sk-item {z-index: 1;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df div.sk-parallel-item:only-child::after {width: 0;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-80ea6aab-bb0e-4afd-a189-7cceb36785df div.sk-container {display: inline-block;position: relative;}</style><div id="sk-80ea6aab-bb0e-4afd-a189-7cceb36785df" class"sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="97babdb1-09cc-4a72-8335-eb6c47776469" type="checkbox" ><label class="sk-toggleable__label" for="97babdb1-09cc-4a72-8335-eb6c47776469">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(memory='pipeline_cache_dir',
         steps=[('preprocessor',
                 ColumnTransformer(transformers=[('num_cols',
                                                  Pipeline(memory='pipeline_cache_dir',
                                                           steps=[('imputer',
                                                                   SimpleImputer(strategy='median')),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  ['f0', 'f1', 'f2', 'f3', 'f4',
                                                   'f5', 'f6', 'f7', 'f8', 'f9',
                                                   'f10', 'f11', 'f12', 'f13',
                                                   'f14', 'f15', 'f16', 'f17',
                                                   'f18', 'f19', 'f20', 'f21',
                                                   'f22...
                               max_delta_step=None, max_depth=1,
                               min_child_weight=256, missing=nan,
                               monotone_constraints=None, n_estimators=40000,
                               n_jobs=4, num_parallel_tree=None, predictor=None,
                               random_state=42, reg_alpha=0.6318827156945853,
                               reg_lambda=0.11729916523488974,
                               scale_pos_weight=None, subsample=0.97,
                               tree_method=None, use_label_encoder=False,
                               validate_parameters=None, verbosity=None))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7cdaa261-6282-4650-8adf-1d572bb7ca1c" type="checkbox" ><label class="sk-toggleable__label" for="7cdaa261-6282-4650-8adf-1d572bb7ca1c">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('num_cols',
                                 Pipeline(memory='pipeline_cache_dir',
                                          steps=[('imputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('scaler', StandardScaler())]),
                                 ['f0', 'f1', 'f2', 'f3', 'f4', 'f5', 'f6',
                                  'f7', 'f8', 'f9', 'f10', 'f11', 'f12', 'f13',
                                  'f14', 'f15', 'f16', 'f17', 'f18', 'f19',
                                  'f20', 'f21', 'f22', 'f23', 'f24', 'f25',
                                  'f26', 'f27', 'f28', 'f29', ...])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d7b10a4f-d399-4952-9c55-ae9957468895" type="checkbox" ><label class="sk-toggleable__label" for="d7b10a4f-d399-4952-9c55-ae9957468895">num_cols</label><div class="sk-toggleable__content"><pre>['f0', 'f1', 'f2', 'f3', 'f4', 'f5', 'f6', 'f7', 'f8', 'f9', 'f10', 'f11', 'f12', 'f13', 'f14', 'f15', 'f16', 'f17', 'f18', 'f19', 'f20', 'f21', 'f22', 'f23', 'f24', 'f25', 'f26', 'f27', 'f28', 'f29', 'f30', 'f31', 'f32', 'f33', 'f34', 'f35', 'f36', 'f37', 'f38', 'f39', 'f40', 'f41', 'f42', 'f43', 'f44', 'f45', 'f46', 'f47', 'f48', 'f49', 'f50', 'f51', 'f52', 'f53', 'f54', 'f55', 'f56', 'f57', 'f58', 'f59', 'f60', 'f61', 'f62', 'f63', 'f64', 'f65', 'f66', 'f67', 'f68', 'f69', 'f70', 'f71', 'f72', 'f73', 'f74', 'f75', 'f76', 'f77', 'f78', 'f79', 'f80', 'f81', 'f82', 'f83', 'f84', 'f85', 'f86', 'f87', 'f88', 'f89', 'f90', 'f91', 'f92', 'f93', 'f94', 'f95', 'f96', 'f97', 'f98', 'f99', 'linear_preds', 'log_reg_preds', 'mlp_preds']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="93da97a1-60a2-4071-9ebf-92b8ff9f780f" type="checkbox" ><label class="sk-toggleable__label" for="93da97a1-60a2-4071-9ebf-92b8ff9f780f">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='median')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="9e61de5d-aefb-4727-b81e-476ce1a8b73c" type="checkbox" ><label class="sk-toggleable__label" for="9e61de5d-aefb-4727-b81e-476ce1a8b73c">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6625c1dc-e509-41c3-88d3-1faf34c583ec" type="checkbox" ><label class="sk-toggleable__label" for="6625c1dc-e509-41c3-88d3-1faf34c583ec">XGBClassifier</label><div class="sk-toggleable__content"><pre>XGBClassifier(base_score=None, booster='gbtree', colsample_bylevel=None,
              colsample_bynode=None, colsample_bytree=0.32,
              enable_categorical=False, gamma=0.2, gpu_id=None,
              importance_type=None, interaction_constraints=None,
              learning_rate=0.18515462875481553, max_delta_step=None,
              max_depth=1, min_child_weight=256, missing=nan,
              monotone_constraints=None, n_estimators=40000, n_jobs=4,
              num_parallel_tree=None, predictor=None, random_state=42,
              reg_alpha=0.6318827156945853, reg_lambda=0.11729916523488974,
              scale_pos_weight=None, subsample=0.97, tree_method=None,
              use_label_encoder=False, validate_parameters=None,
              verbosity=None)</pre></div></div></div></div></div></div></div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">xgb_model_preds_metrics_score</span><span class="p">,</span> <span class="n">xgb_model_test_preds</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">do_kfold_training</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                                                              <span class="n">test_preds_metric</span><span class="o">=</span><span class="n">roc_auc_score</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2021-11-28 17:41:09,573 INFO  model class:&lt;class &#39;xgboost.sklearn.XGBClassifier&#39;&gt;
2021-11-28 17:41:41,536 INFO fold: 1 roc_auc_score : 0.6171373307543521
2021-11-28 17:41:41,536 INFO fold: 1 log_loss : 0.7281110190437176
2021-11-28 17:41:41,537 INFO fold: 1 accuracy_score : 0.57625
2021-11-28 17:41:41,537 INFO fold: 1 f1_score : 0.46275752773375595
2021-11-28 17:41:41,537 INFO fold: 1 precision_score : 0.4850498338870432
2021-11-28 17:41:41,538 INFO fold: 1 recall_score : 0.44242424242424244
2021-11-28 17:41:41,538 INFO Predicting Test Preds Probablities!
2021-11-28 17:42:14,031 INFO fold: 2 roc_auc_score : 0.6035138620245003
2021-11-28 17:42:14,032 INFO fold: 2 log_loss : 0.7519563890597784
2021-11-28 17:42:14,032 INFO fold: 2 accuracy_score : 0.595
2021-11-28 17:42:14,033 INFO fold: 2 f1_score : 0.4774193548387097
2021-11-28 17:42:14,033 INFO fold: 2 precision_score : 0.5103448275862069
2021-11-28 17:42:14,034 INFO fold: 2 recall_score : 0.4484848484848485
2021-11-28 17:42:14,034 INFO Predicting Test Preds Probablities!
2021-11-28 17:42:48,984 INFO fold: 3 roc_auc_score : 0.6147453255963894
2021-11-28 17:42:48,985 INFO fold: 3 log_loss : 0.7468053783191135
2021-11-28 17:42:48,986 INFO fold: 3 accuracy_score : 0.60375
2021-11-28 17:42:48,988 INFO fold: 3 f1_score : 0.47603305785123967
2021-11-28 17:42:48,990 INFO fold: 3 precision_score : 0.5236363636363637
2021-11-28 17:42:48,992 INFO fold: 3 recall_score : 0.43636363636363634
2021-11-28 17:42:48,993 INFO Predicting Test Preds Probablities!
2021-11-28 17:43:22,561 INFO fold: 4 roc_auc_score : 0.6192773723097933
2021-11-28 17:43:22,562 INFO fold: 4 log_loss : 0.7461987593222875
2021-11-28 17:43:22,563 INFO fold: 4 accuracy_score : 0.61375
2021-11-28 17:43:22,564 INFO fold: 4 f1_score : 0.4926108374384236
2021-11-28 17:43:22,564 INFO fold: 4 precision_score : 0.539568345323741
2021-11-28 17:43:22,565 INFO fold: 4 recall_score : 0.45317220543806647
2021-11-28 17:43:22,565 INFO Predicting Test Preds Probablities!
2021-11-28 17:43:56,767 INFO fold: 5 roc_auc_score : 0.609537551775005
2021-11-28 17:43:56,768 INFO fold: 5 log_loss : 0.7455774929642212
2021-11-28 17:43:56,768 INFO fold: 5 accuracy_score : 0.585
2021-11-28 17:43:56,769 INFO fold: 5 f1_score : 0.48447204968944096
2021-11-28 17:43:56,769 INFO fold: 5 precision_score : 0.4984025559105431
2021-11-28 17:43:56,770 INFO fold: 5 recall_score : 0.47129909365558914
2021-11-28 17:43:56,770 INFO Predicting Test Preds Probablities!
2021-11-28 17:43:56,905 INFO  Mean Metrics Results from all Folds are: {&#39;roc_auc_score&#39;: 0.6128422884920081, &#39;log_loss&#39;: 0.7437298077418236, &#39;accuracy_score&#39;: 0.59475, &#39;f1_score&#39;: 0.47865856551031405, &#39;precision_score&#39;: 0.5114003852687795, &#39;recall_score&#39;: 0.45034880527327653}
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 10min 25s, sys: 4.33 s, total: 10min 29s
Wall time: 2min 47s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedKFold</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>

<span class="c1"># Setting up fold parameters</span>
<span class="n">splits</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">skf</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="n">splits</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># Creating an array of zeros for storing &quot;out of fold&quot; predictions</span>
<span class="n">oof_preds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],))</span>
<span class="n">preds</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1"># model_fi = 0</span>
<span class="n">total_mean_auc</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Generating folds and making training and prediction for each of them</span>
<span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="p">(</span><span class="n">train_idx</span><span class="p">,</span> <span class="n">valid_idx</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">skf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y</span><span class="p">)):</span>
    <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_train</span><span class="p">,</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_valid</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">valid_idx</span><span class="p">]</span>
    <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y_valid</span> <span class="o">=</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">valid_idx</span><span class="p">]</span>
    
    <span class="n">model</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="o">**</span><span class="n">xgb_params</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_train</span><span class="p">,</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span>
              <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="c1"># The parameters below help to detect and avoid overfitting</span>
              <span class="n">eval_set</span><span class="o">=</span><span class="p">[(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_train</span><span class="p">,</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y_train</span><span class="p">),</span> <span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_valid</span><span class="p">,</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y_valid</span><span class="p">)],</span>
              <span class="n">eval_metric</span><span class="o">=</span><span class="s2">&quot;auc&quot;</span><span class="p">,</span>
              <span class="n">early_stopping_rounds</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
              <span class="p">)</span>
    
    <span class="c1"># Getting mean test data predictions (i.e. devided by number of splits)</span>
    <span class="n">preds</span> <span class="o">+=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">splits</span>
    
    <span class="c1"># Getting mean feature importances (i.e. devided by number of splits)</span>
    <span class="c1"># model_fi += model.feature_importances_ / splits</span>
    
    <span class="c1"># Getting validation data predictions. Each fold model makes predictions on an unseen data.</span>
    <span class="c1"># So in the end it will be completely filled with unseen data predictions.</span>
    <span class="c1"># It will be used to evaluate hyperparameters performance only.</span>
    <span class="n">oof_preds</span><span class="p">[</span><span class="n">valid_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_valid</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
    
    <span class="c1"># Getting score for a fold model</span>
    <span class="n">fold_auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">oof_preds</span><span class="p">[</span><span class="n">valid_idx</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fold </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2"> ROC AUC: </span><span class="si">{</span><span class="n">fold_auc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Getting mean score of all fold models (i.e. devided by number of splits)</span>
    <span class="n">total_mean_auc</span> <span class="o">+=</span> <span class="n">fold_auc</span> <span class="o">/</span> <span class="n">splits</span>
    <span class="c1"># delete all dataframes after each fold</span>
    <span class="n">unused_df_lst</span> <span class="o">=</span> <span class="p">[</span><span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_train</span><span class="p">,</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">X_valid</span><span class="p">,</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="n">tmlt</span><span class="o">.</span><span class="n">dfl</span><span class="o">.</span><span class="n">y_valid</span><span class="p">]</span>
    <span class="k">del</span> <span class="n">unused_df_lst</span>
    
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Overall ROC AUC: </span><span class="si">{</span><span class="n">total_mean_auc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Fold 0 ROC AUC: 0.761928164444148
Fold 1 ROC AUC: 0.7610277116407352
Fold 2 ROC AUC: 0.7627903156056819
Fold 3 ROC AUC: 0.7632015002586378
Fold 4 ROC AUC: 0.7569241924918775</p>
<p>Overall ROC AUC: 0.7611743768882161
CPU times: user 53 s, sys: 384 ms, total: 53.4 s
Wall time: 26.7 s</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Let's-do-Optuna-based-HyperParameter-search-to-get-best-params-for-fit">Let's do Optuna based HyperParameter search to get best params for fit<a class="anchor-link" href="#Let's-do-Optuna-based-HyperParameter-search-to-get-best-params-for-fit"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Since-the-training-dataset-is-big-size,-aka-&quot;Big-Data&quot;,-Let's-give-600-sec-(10-minutes)-for-Optuna-Study-optimization">Since the training dataset is big size, aka "Big Data", Let's give 600 sec (10 minutes) for Optuna Study optimization<a class="anchor-link" href="#Since-the-training-dataset-is-big-size,-aka-&quot;Big-Data&quot;,-Let's-give-600-sec-(10-minutes)-for-Optuna-Study-optimization"> </a></h5>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#                                        use_gpu=True, opt_timeout=600)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Since number of trials did not ended in 10 minutes, we can always come back and run this cell to do additional hyperparams search, Optuna will save the study and restart from the last trial</strong></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Now,-let's-update-the-model-with-best-params-from-optuna-study">Now, let's update the model with best params from optuna study<a class="anchor-link" href="#Now,-let's-update-the-model-with-best-params-from-optuna-study"> </a></h4><p><strong>Make sure to update the sklearn pipeline with new model too, Only this way sklearn pipeline will not reuse cache models (estimators)</strong></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># # xgb_params.update(new_xgb_params)</span>
<span class="c1"># # print(&quot;Final xgb_params:&quot;, xgb_params)</span>
<span class="c1"># xgb_model = XGBClassifier(**new_xgb_params)</span>

<span class="c1"># # update sklearn pipeline to not to use cache model(estimator)</span>
<span class="c1"># tmlt.update_model(xgb_model)</span>
<span class="c1"># # lets see sklearn pipeline</span>
<span class="c1"># tmlt.spl</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Let's-do-K-Fold-Training">Let's do K-Fold Training<a class="anchor-link" href="#Let's-do-K-Fold-Training"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># xgb_model_preds_metrics_score, xgb_model_test_preds= tmlt.do_kfold_training(n_splits=5, test_preds_metric=roc_auc_score)</span>
<span class="c1"># if xgb_model_test_preds is not None:</span>
<span class="c1">#     print(xgb_model_test_preds.shape)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Create-Kaggle-Predictions">Create Kaggle Predictions<a class="anchor-link" href="#Create-Kaggle-Predictions"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># # sub[&#39;target&#39;] = xgb_model_test_preds</span>
<span class="c1"># sub[&#39;target&#39;] = preds</span>
<span class="c1"># sub.to_csv(OUTPUT_PATH + &#39;wed_nov_25_1042_submission.csv&#39;, index=False)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">OUTPUT_PATH</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">/var/folders/p3/zmg8jfwx0hb9gwzs0w69d7f0rgyjx2/T/ipykernel_69504/1639295376.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>os<span class="ansi-blue-fg">.</span>listdir<span class="ansi-blue-fg">(</span>OUTPUT_PATH<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;os&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

